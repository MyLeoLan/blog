<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LeoLan&#39;s Blog</title>
  <subtitle>有时候正是不报期望的人做出了人们不敢期望之事！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.leolan.top/"/>
  <updated>2017-04-10T01:54:46.439Z</updated>
  <id>https://www.leolan.top/</id>
  
  <author>
    <name>LeoLan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux备份恢复</title>
    <link href="https://www.leolan.top/posts/32881/"/>
    <id>https://www.leolan.top/posts/32881/</id>
    <published>2017-04-08T17:39:56.000Z</published>
    <updated>2017-04-10T01:54:46.439Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="文件备份恢复"><a href="#文件备份恢复" class="headerlink" title="文件备份恢复"></a>文件备份恢复</h1><hr>
<h1 id="Linux系统的备份恢复"><a href="#Linux系统的备份恢复" class="headerlink" title="Linux系统的备份恢复"></a>Linux系统的备份恢复</h1><h2 id="tar命令"><a href="#tar命令" class="headerlink" title="tar命令"></a>tar命令</h2><h3 id="备份整个系统"><a href="#备份整个系统" class="headerlink" title="备份整个系统"></a>备份整个系统</h3><p>注意根目录下要有充足的可用空间用于备份。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /</div><div class="line"><span class="selector-id">#tar</span>.gz格式</div><div class="line">tar cvpzf system_backup<span class="selector-class">.tar</span><span class="selector-class">.gz</span> / --exclude=/proc --exclude=/lost+found --exclude=/system_backup<span class="selector-class">.tar</span><span class="selector-class">.gz</span> --exclude=/mnt --exclude=/sys</div><div class="line"></div><div class="line"><span class="selector-id">#tar</span>.bz2格式</div><div class="line">tar cvpjf system_backup<span class="selector-class">.tar</span><span class="selector-class">.bz2</span> / --exclude=/proc --exclude=/lost+found --exclude=/system_backup<span class="selector-class">.tar</span><span class="selector-class">.bz2</span> --exclude=/mnt --exclude=/sys</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="恢复系统"><a href="#恢复系统" class="headerlink" title="恢复系统"></a>恢复系统</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /</div><div class="line"><span class="comment">#上传文件到根目录下</span></div><div class="line">tar xvpfz system_backup.tar.gz -C /</div><div class="line">或</div><div class="line">tar xvpfj system_backup.tar.bz2 -C /</div><div class="line"></div><div class="line"><span class="comment">#创建备份时排除的目录</span></div><div class="line">mkdir <span class="keyword">proc</span><span class="title"></span></div><div class="line">mkdir lost+found<span class="title"></span></div><div class="line">mkdir mnt<span class="title"></span></div><div class="line">mkdir sys</div></pre></td></tr></table></figure>
<ul>
<li>/proc 权限：文件所有者：root群组：root 所有者：读取 执行 群组：读取 执行 其它：读取 执行</li>
<li>/lost+found 权限：文件所有者：root群组：root 所有者：读取 写入 执行 群组：读取 执行 其它：读取 执行</li>
<li>/mnt 权限：文件所有者：root群组：root 所有者：读取 写入 执行 群组：读取 执行 其它：读取 执行</li>
<li>/sys 权限：文件所有者：root群组：root 所有者：读取 写入 执行 群组：读取 执行 其它：读取 执行</li>
</ul>
<p>恢复完成重启以后，所以的事情都会和你备份的时候一模一样。</p>
<hr>
<h2 id="rsync命令"><a href="#rsync命令" class="headerlink" title="rsync命令"></a>rsync命令</h2><p>注意目标分区的格式最好是NTFS、FAT、EXT之类的格式，避免遇到大于4G的文件无法备份的问题。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#最好有其他分区或外接存储设备，挂载好，df -lh看挂载点。</div><div class="line">#备份</div><div class="line">rsync -Pa <span class="regexp">/ /m</span>edia<span class="regexp">/usb/</span>backup_20170410 --<span class="keyword">exclude</span>=<span class="regexp">/media/</span>* --<span class="keyword">exclude</span>=<span class="regexp">/sys/</span>* --<span class="keyword">exclude</span>=<span class="regexp">/proc/</span>* --<span class="keyword">exclude</span>=<span class="regexp">/mnt/</span>* --<span class="keyword">exclude</span>=<span class="regexp">/tmp/</span>*</div><div class="line"></div><div class="line">#恢复</div><div class="line">rsync -Pa <span class="regexp">/media/u</span>sb<span class="regexp">/backup_20170410 /</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="dd命令"><a href="#dd命令" class="headerlink" title="dd命令"></a>dd命令</h2><p>dd命令属于扇区克隆，目标分区要比备份分区要大，即使没有使用的空间也会被原样克隆下来，会比较慢。<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#备份</span></div><div class="line">df -h   <span class="comment">#查看系统所在分区</span></div><div class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/sda</span>1 <span class="keyword">of</span>=<span class="regexp">/dev/sdb</span>3     <span class="comment">#备份sda1到sdb3中</span></div><div class="line"></div><div class="line"><span class="comment">#恢复</span></div><div class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/sdb</span>3 <span class="keyword">of</span>=<span class="regexp">/dev/sda</span>1     <span class="comment">#恢复sdb3到sdb1中</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="CloneZilla-再生龙"><a href="#CloneZilla-再生龙" class="headerlink" title="CloneZilla(再生龙)"></a>CloneZilla(再生龙)</h2><p>此款软件需要另外下载，支持几乎所有主流系统，可通过U盘启动</p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;文件备份恢复&quot;&gt;&lt;a href=&quot;#文件备份恢复&quot; class=
    
    </summary>
    
      <category term="系统管理" scheme="https://www.leolan.top/categories/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="Linux备份恢复" scheme="https://www.leolan.top/tags/Linux%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>PostgreSQL数据库</title>
    <link href="https://www.leolan.top/posts/53623/"/>
    <id>https://www.leolan.top/posts/53623/</id>
    <published>2017-04-08T17:36:30.000Z</published>
    <updated>2017-04-10T01:54:46.411Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>官网安装教程：<a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="external">https://www.postgresql.org/download/linux/redhat/</a></p>
<p><a href="http://www.cnblogs.com/qiyebao/p/4562557.html" target="_blank" rel="external">http://www.cnblogs.com/qiyebao/p/4562557.html</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerl
    
    </summary>
    
      <category term="数据库" scheme="https://www.leolan.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="PostgreSQL数据库" scheme="https://www.leolan.top/tags/PostgreSQL%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>OpenWRT-LEDE</title>
    <link href="https://www.leolan.top/posts/23851/"/>
    <id>https://www.leolan.top/posts/23851/</id>
    <published>2017-04-08T17:11:27.000Z</published>
    <updated>2017-04-10T01:54:46.440Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="OpenWrt"><a href="#OpenWrt" class="headerlink" title="OpenWrt"></a>OpenWrt</h1><p>官网：<a href="https://openwrt.org" target="_blank" rel="external">https://openwrt.org</a><br>项目地址：:<a href="https://github.com/openwrt/openwrt" target="_blank" rel="external">https://github.com/openwrt/openwrt</a><br>固件：<a href="https://downloads.openwrt.org/chaos_calmer/15.05.1/" target="_blank" rel="external">https://downloads.openwrt.org/chaos_calmer/15.05.1/</a></p>
<hr>
<h1 id="LEDE"><a href="#LEDE" class="headerlink" title="LEDE"></a>LEDE</h1><p>官网：<a href="https://lede-project.org/zh/start" target="_blank" rel="external">https://lede-project.org/zh/start</a><br>项目地址：<a href="https://lede-project.org/docs/guide-developer/the-source-code" target="_blank" rel="external">https://lede-project.org/docs/guide-developer/the-source-code</a><br>固件：<a href="https://downloads.lede-project.org/snapshots/targets" target="_blank" rel="external">https://downloads.lede-project.org/snapshots/targets</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;OpenWrt&quot;&gt;&lt;a href=&quot;#OpenWrt&quot; clas
    
    </summary>
    
      <category term="路由" scheme="https://www.leolan.top/categories/%E8%B7%AF%E7%94%B1/"/>
    
    
      <category term="OpenWRT-LEDE" scheme="https://www.leolan.top/tags/OpenWRT-LEDE/"/>
    
  </entry>
  
  <entry>
    <title>Shell技巧</title>
    <link href="https://www.leolan.top/posts/39984/"/>
    <id>https://www.leolan.top/posts/39984/</id>
    <published>2017-04-08T16:30:44.000Z</published>
    <updated>2017-04-10T01:54:46.411Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="Shell快捷键"><a href="#Shell快捷键" class="headerlink" title="Shell快捷键"></a>Shell快捷键</h1><hr>
<h2 id="编辑命令"><a href="#编辑命令" class="headerlink" title="编辑命令"></a>编辑命令</h2><p>Ctrl + a ：移到命令行首<br>Ctrl + e ：移到命令行尾<br>Ctrl + f ：按字符前移（右向）<br>Ctrl + b ：按字符后移（左向）<br>Alt + f ：按单词前移（右向）<br>Alt + b ：按单词后移（左向）<br>Ctrl + xx：在命令行首和光标之间移动<br>Ctrl + u ：从光标处删除至命令行首<br>Ctrl + k ：从光标处删除至命令行尾<br>Ctrl + w ：从光标处删除至字首<br>Alt + d ：从光标处删除至字尾<br>Ctrl + d ：删除光标处的字符<br>Ctrl + h ：删除光标前的字符<br>Ctrl + y ：粘贴至光标后<br>Alt + c ：从光标处更改为首字母大写的单词<br>Alt + u ：从光标处更改为全部大写的单词<br>Alt + l ：从光标处更改为全部小写的单词<br>Ctrl + t ：交换光标处和之前的字符<br>Alt + t ：交换光标处和之前的单词<br>Alt + Backspace：与 Ctrl + w <del>相同</del>类似，分隔符有些差别 [感谢 rezilla 指正]</p>
<hr>
<h2 id="重新执行命令"><a href="#重新执行命令" class="headerlink" title="重新执行命令"></a>重新执行命令</h2><p>Ctrl + r：逆向搜索命令历史<br>Ctrl + g：从历史搜索模式退出<br>Ctrl + p：历史中的上一条命令<br>Ctrl + n：历史中的下一条命令<br>Alt + .：使用上一条命令的最后一个参数</p>
<hr>
<h2 id="控制命令"><a href="#控制命令" class="headerlink" title="控制命令"></a>控制命令</h2><p>Ctrl + l：清屏<br>Ctrl + o：执行当前命令，并选择上一条命令<br>Ctrl + s：阻止屏幕输出<br>Ctrl + q：允许屏幕输出<br>Ctrl + c：终止命令<br>Ctrl + z：挂起命令<br>Bang (!) 命令</p>
<hr>
<p><strong>!!</strong>：执行上一条命令<br><strong>!blah</strong>：执行最近的以 blah 开头的命令，如 !ls<br><strong>!blah:p</strong>：仅打印输出，而不执行<br><strong>!\$</strong>：上一条命令的最后一个参数，与 Alt + . 相同<br><strong>!\$:p</strong>：打印输出 !$ 的内容<br><strong>!*</strong>：上一条命令的所有参数<br><strong>!*:p</strong>：打印输出 !<em> 的内容<br><strong>^blah</strong>：删除上一条命令中的 blah<br><em>*^blah^foo</em></em>：将上一条命令中的 blah 替换为 foo<br>^blah^foo^：将上一条命令中所有的 blah 都替换为 foo</p>
<hr>
<p>友情提示_：</p>
<ul>
<li>以上介绍的大多数 Bash 快捷键仅当在 emacs 编辑模式时有效，若你将 Bash 配置为 vi 编辑模式，那将遵循 vi 的按键绑定。Bash 默认为 emacs 编辑模式。如果你的 Bash 不在 emacs 编辑模式，可通过 <code>set -o emacs</code> 设置。</li>
<li>^S、^Q、^C、^Z 是由终端设备处理的，可用 stty 命令设置。</li>
</ul>
<p>原文：<a href="https://linuxtoy.org/archives/bash-shortcuts.html" target="_blank" rel="external">https://linuxtoy.org/archives/bash-shortcuts.html</a></p>
<hr>
<h1 id="脚本调试"><a href="#脚本调试" class="headerlink" title="脚本调试"></a>脚本调试</h1><p>参考：<br><a href="http://blog.csdn.net/mupenghaha/article/details/8835956?locationNum=2&amp;fps=1" target="_blank" rel="external">http://blog.csdn.net/mupenghaha/article/details/8835956?locationNum=2&amp;fps=1</a><br><a href="http://blog.csdn.net/Jerry_1126/article/details/52096886?locationNum=3&amp;fps=1" target="_blank" rel="external">http://blog.csdn.net/Jerry_1126/article/details/52096886?locationNum=3&amp;fps=1</a></p>
<hr>
<h1 id="脚本攻略"><a href="#脚本攻略" class="headerlink" title="脚本攻略"></a>脚本攻略</h1><p>参考：<a href="http://man.linuxde.net/shell-script" target="_blank" rel="external">http://man.linuxde.net/shell-script</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;Shell快捷键&quot;&gt;&lt;a href=&quot;#Shell快捷键&quot; cl
    
    </summary>
    
      <category term="Shell" scheme="https://www.leolan.top/categories/Shell/"/>
    
    
      <category term="Shell技巧" scheme="https://www.leolan.top/tags/Shell%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>TFS代码管理</title>
    <link href="https://www.leolan.top/posts/37588/"/>
    <id>https://www.leolan.top/posts/37588/</id>
    <published>2017-04-08T07:09:59.000Z</published>
    <updated>2017-04-10T01:54:46.412Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>TFS（Team Foundation Server）是一种代码管理工具，工作原理类似于SVN。</p>
<p>安装TFS还是比较简单的，在Windows Server服务器环境下安装是很简单的，TFS依赖SQL数据库，一般SQL2014及以上版本都需要.NET 4.5以上的版本。所以最好先安装.NET 4.5，不然一定会报错的。</p>
<hr>
<p><strong>Microsoft .NET Framework 4</strong><br><a href="https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=17718" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=17718</a></p>
<p><strong>Microsoft .NET Framework 4.5</strong><br><a href="https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=30653" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=30653</a></p>
<hr>
<p><strong>SQL 2014 下载</strong><br><a href="https://www.microsoft.com/zh-CN/download/details.aspx?id=42299" target="_blank" rel="external">https://www.microsoft.com/zh-CN/download/details.aspx?id=42299</a><br>选择有Management的64位版本，如：SQLManagementStudio_x64_CHS.exe</p>
<hr>
<p><strong>TFS 2015 下载</strong><br><a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=48260" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/details.aspx?id=48260</a></p>
<p>参考：<a href="http://m.blog.csdn.net/article/details?id=41447989" target="_blank" rel="external">http://m.blog.csdn.net/article/details?id=41447989</a></p>
<p>安装完TFS后按提示简单配置之后就可以使用了，Web管理界面是：<strong>localhost:8080</strong></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;TFS（Team Foundation Server）是一种代码管理工具，
    
    </summary>
    
      <category term="环境搭建" scheme="https://www.leolan.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="TFS代码管理" scheme="https://www.leolan.top/tags/TFS%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>邮件服务器、第三方邮件服务</title>
    <link href="https://www.leolan.top/posts/26298/"/>
    <id>https://www.leolan.top/posts/26298/</id>
    <published>2017-04-08T04:16:50.000Z</published>
    <updated>2017-04-10T01:54:46.413Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h1><h2 id="第三方接管域名"><a href="#第三方接管域名" class="headerlink" title="第三方接管域名"></a>第三方接管域名</h2><p><strong>这种情况适合域名由第三方接管的情况下。</strong><br><img src="http://ofyfogrgx.bkt.clouddn.com/youjianjiexi.png" alt=""><br>目前的设置是这样的，就是MX记录指向<strong>mail.域名</strong>，最后通过A记录指向IP。这种情况下访问<strong>mail.域名</strong>也会跳转到IP:80的网站上。<br>@ ---》MX ---》mail.域名<br>mail ---》A ---》IP</p>
<hr>
<h2 id="域名未被第三方接管"><a href="#域名未被第三方接管" class="headerlink" title="域名未被第三方接管"></a>域名未被第三方接管</h2><p><strong>这种情况(域名在原营运商的DNS下[没有被第三方DNS接管的情况下])</strong>：<br>第三方DNS接管之后，即使没有开启<strong>mail.域名</strong>的解析也会被解析到DNS的主服务器上，导致发送到该邮件地址时导向到了DNS的服务器IP上，找不到邮件服务器的IP，于是变成了退信，无法接收。<br><img src="http://ofyfogrgx.bkt.clouddn.com/%E9%82%AE%E4%BB%B6%E8%A7%A3%E6%9E%902.png" alt=""><br>这种情况下<strong>有@ —》A记录指向了IP</strong>则不需要<strong>mail —》A记录指向了IP</strong>如果域名已经备案过了，可以设置<strong>隐性跳转</strong>（看图红字）；这访问<strong>mail.域名</strong>时就能打开网页版的邮箱。</p>
<p>域名后面的点是自动加的，不同的DNS解析方式不同，有的会自动加点，有的不会，没有影响。</p>
<hr>
<p>TXT记录一般用来做反垃圾邮件，格式有很多种：</p>
<ul>
<li>“v=spf1 include:spf.mail.域名 ~all”</li>
<li>“v=spf1 ip4:邮件服务器的IP ~all”</li>
</ul>
<hr>
<h2 id="域名解析测试验证"><a href="#域名解析测试验证" class="headerlink" title="域名解析测试验证"></a>域名解析测试验证</h2><p>win中用nslookup测试：<a href="http://jingyan.baidu.com/article/ce09321b2bae742bfe858f59.html" target="_blank" rel="external">http://jingyan.baidu.com/article/ce09321b2bae742bfe858f59.html</a><br>只要符合<strong>@ ---》MX ---》mail.域名 ---》A ---》IP</strong>这样的话应该是正确的，能够正常收发邮件。</p>
<p><a href="http://www.cnblogs.com/moonvan/archive/2010/08/24/1807003.html" target="_blank" rel="external">http://www.cnblogs.com/moonvan/archive/2010/08/24/1807003.html</a><br><a href="http://www.docin.com/p-580267583.html" target="_blank" rel="external">http://www.docin.com/p-580267583.html</a></p>
<hr>
<h1 id="邮件服务器的搭建"><a href="#邮件服务器的搭建" class="headerlink" title="邮件服务器的搭建"></a>邮件服务器的搭建</h1><p>一定要注意路由的端口转发有没有开启<br><strong>邮件服务的端口</strong>：<br>SMTP(发):25 　　SSL:465　　TLS:587<br>IMAP(收):143　　SSL:993<br>POP3(收):110　　SSL:995</p>
<hr>
<h1 id="群晖DSM搭建邮件服务器"><a href="#群晖DSM搭建邮件服务器" class="headerlink" title="群晖DSM搭建邮件服务器"></a>群晖DSM搭建邮件服务器</h1><p>群晖里自带了邮件服务器的套件，安装之后简单设置就可以使用了。<br><img src="http://ofyfogrgx.bkt.clouddn.com/1111132435363.png" alt=""><br>主机名（FQDN）:填域名就行，最后的邮件地址就是：<strong>user_name@域名</strong>；如果填的是<strong>mail.域名</strong>，则最后得到的邮件地址是：<strong>user_name@mail.域名</strong></p>
<ul>
<li>IMAP/POP3 功能全部开启。</li>
<li>控制面板中安全性中最好开启<strong>自动封锁</strong>（邮件服务器很容易遭受攻击）</li>
<li>控制面板安全性中默认没有开启防火墙的，如果需要路由的端口转发的话即使不开防火墙也是比较安全的（云服务器默认是开启全部端口，这时就需要防火墙来保护了）。</li>
<li>设置完成后，记得设置端口转发，在win下用<code>telnet “IP” “port”</code>测试是否能通。</li>
</ul>
<p><strong>邮件客户端</strong>：</p>
<ul>
<li>网页版的做好把80端口映射到群晖的80端口，这个访问web版的mail就可以直接使用：<strong>http(s)://IP/mail</strong> 就能访问，登录账号密码就是系统中设置的用户的账户密码（不是用邮件地址登录）</li>
<li>第三方邮件客户端登录时看清是邮件地址还是账户，邮件地址是：<strong>user_name@域名</strong> 用户：user_name 密码：user_passwd<br>地址是：<strong>smtp.域名、imap.域名、pop3.域名</strong>   对应的的端口看你是不是用SSL。</li>
</ul>
<hr>
<h1 id="Windsws-Server搭建邮件服务器"><a href="#Windsws-Server搭建邮件服务器" class="headerlink" title="Windsws_Server搭建邮件服务器"></a>Windsws_Server搭建邮件服务器</h1><p>不建议使用什么破解版的邮件服务器软件（免费版的还是可以的免费版不是破解版），非常不安全。预算充足的话可以考虑收费的服务。</p>
<font color="#A52A2A">看参考，但不要一步一步设置，全部看完再设置。</font><strong>参考</strong>：<br><a href="http://liujb.blog.51cto.com/269257/1784870" target="_blank" rel="external">http://liujb.blog.51cto.com/269257/1784870</a><br><a href="http://www.2cto.com/os/201604/498893.html" target="_blank" rel="external">http://www.2cto.com/os/201604/498893.html</a><br><a href="http://www.mamicode.com/info-detail-1370549.html" target="_blank" rel="external">http://www.mamicode.com/info-detail-1370549.html</a><br><a href="http://www.360doc.com/content/09/0924/12/32573_6370328.shtml" target="_blank" rel="external">http://www.360doc.com/content/09/0924/12/32573_6370328.shtml</a><br><a href="https://msdn.microsoft.com/zh-cn/library/dn292550.aspx" target="_blank" rel="external">https://msdn.microsoft.com/zh-cn/library/dn292550.aspx</a><br><br><br><font color="#A52A2A">截图看本地磁盘的备份文件夹（重要）</font>

<hr>
<h2 id="测试SMTP-包括中继模式）"><a href="#测试SMTP-包括中继模式）" class="headerlink" title="测试SMTP(包括中继模式）"></a>测试SMTP(包括中继模式）</h2><ul>
<li><p>创建一个txt文档，如名为email.txt，内容如下：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">FROM</span>:mail.travelwebsite<span class="variable">@travelwebsite</span>.com     #发件箱必须为你在邮件服务器上设置的那个账户，否则没有权限发送</div><div class="line"><span class="attribute">TO</span>:<span class="number">842632422</span><span class="variable">@qq</span>.com</div><div class="line"><span class="attribute">SUBJECT</span>: Test email from SMTP</div><div class="line">This is a test email sent from my SMTP server</div></pre></td></tr></table></figure>
</li>
<li><p>将email.txt复制到如下路径<strong>c:\inetpub\mailroot\pickup</strong>(SMTP的默认目录)</p>
</li>
</ul>
<p>关于报错：<a href="https://torontoprogrammer.ca/2011/04/fixing-the-cannot-get-iis-pickup-directory-error-in-asp-net/" target="_blank" rel="external">IIS 拾取目录</a></p>
<p>Windows下通过程序实现SMTP发送邮件（本人未测试）：<a href="http://www.jianshu.com/p/5005a8642103" target="_blank" rel="external">http://www.jianshu.com/p/5005a8642103</a></p>
<hr>
<h2 id="Win中免费的邮件系统"><a href="#Win中免费的邮件系统" class="headerlink" title="Win中免费的邮件系统"></a>Win中免费的邮件系统</h2><p><a href="https://www.hmailserver.org/" target="_blank" rel="external">https://www.hmailserver.org/</a><br><a href="https://macallan-mail-solution.en.softonic.com/" target="_blank" rel="external">https://macallan-mail-solution.en.softonic.com/</a><br><a href="http://download.cnet.com/ArGoSoft-Mail-Server-Freeware/3000-2369_4-10038331.html" target="_blank" rel="external">http://download.cnet.com/ArGoSoft-Mail-Server-Freeware/3000-2369_4-10038331.html</a><br><a href="http://www.exchangecn.com/exchange2016" target="_blank" rel="external">http://www.exchangecn.com/exchange2016</a></p>
<hr>
<hr>
<h1 id="Linux搭建邮件服务器"><a href="#Linux搭建邮件服务器" class="headerlink" title="Linux搭建邮件服务器"></a>Linux搭建邮件服务器</h1><p><font color="#A52A2A">待整理(还未完成)：</font><br><a href="http://www.cnblogs.com/llius/p/5076235.html?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">http://www.cnblogs.com/llius/p/5076235.html?utm_source=tuicool&amp;utm_medium=referral</a><br><a href="https://www.freehao123.com/iredmail/" target="_blank" rel="external">https://www.freehao123.com/iredmail/</a><br><a href="http://rfyiamcool.blog.51cto.com/1030776/948744/" target="_blank" rel="external">http://rfyiamcool.blog.51cto.com/1030776/948744/</a><br><a href="http://www.ilanni.com/?cat=936" target="_blank" rel="external">http://www.ilanni.com/?cat=936</a></p>
<p>centos7邮件：<a href="https://www.fancycoding.com/centos7-mail-server-with-dovecot-postfix-ssl/" target="_blank" rel="external">https://www.fancycoding.com/centos7-mail-server-with-dovecot-postfix-ssl/</a></p>
<hr>
<h1 id="第三方邮件服务（企业）"><a href="#第三方邮件服务（企业）" class="headerlink" title="第三方邮件服务（企业）"></a>第三方邮件服务（企业）</h1><h2 id="Office365"><a href="#Office365" class="headerlink" title="Office365"></a>Office365</h2><p>购买了账号后可以填写到自己的邮件服务器中，用作STMP，IMAP，POP3等中继，这样不用设置域名，证书等等，原理就是把自己的服务器转变为客户端一样去链接微软的服务器。</p>
<p>POP设置（接收）<br>服务器名称: outlook.office365.com<br>端口: 995<br>加密方法: TLS</p>
<p>IMAP设置（接收）<br>服务器名称: outlook.office365.com<br>端口: 993<br>加密方法: TLS</p>
<p>SMTP设置（发送）<br>服务器名称: smtp.office365.com<br>端口: 587<br>加密方法: STARTTLS    （也是可以用TLS加密的）</p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;域名解析&quot;&gt;&lt;a href=&quot;#域名解析&quot; class=&quot;hea
    
    </summary>
    
      <category term="环境搭建" scheme="https://www.leolan.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="邮件服务器" scheme="https://www.leolan.top/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>珠海迈科笔记</title>
    <link href="https://www.leolan.top/posts/57404/"/>
    <id>https://www.leolan.top/posts/57404/</id>
    <published>2017-04-08T02:57:23.000Z</published>
    <updated>2017-04-10T01:54:46.411Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>强迫症犯了，陈列在笔记中，于是弄成笔记保存。</p>
<h1 id="MK服务器搭建，常用命令"><a href="#MK服务器搭建，常用命令" class="headerlink" title="MK服务器搭建，常用命令"></a>MK服务器搭建，常用命令</h1><hr>
<h2 id="centos6-X及以下版本"><a href="#centos6-X及以下版本" class="headerlink" title="centos6.X及以下版本"></a>centos6.X及以下版本</h2><p><strong>网卡配置</strong><br><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0</code>      编辑配置文件,添加修改以下内容<br>双网不要配内网网关<br>联通公网：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="attr">DEVICE</span>=eth0</div><div class="line"><span class="attr">BOOTPROTO</span>=static</div><div class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></div><div class="line"><span class="attr">IPADDR</span>=<span class="number">221</span>.X.XXX.<span class="number">114</span></div><div class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.224</span>  </div><div class="line"><span class="attr">GATEWAY</span>=<span class="number">221</span>.X.XXX.<span class="number">97</span></div><div class="line"><span class="attr">DNS1</span>=<span class="number">221</span>.X.XX.<span class="number">88</span></div><div class="line"><span class="attr">DNS2</span>=<span class="number">8.8</span>.<span class="number">8.8</span></div></pre></td></tr></table></figure></p>
<p>内网：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth1</div><div class="line">DEVICE=eth1</div><div class="line">BOOTPROTO=static</div><div class="line">ONBOOT=yes</div><div class="line">IPADDR=<span class="number">192.168</span><span class="number">.0</span><span class="number">.114</span></div><div class="line">NETMASK=<span class="number">255.255</span><span class="number">.252</span><span class="number">.0</span>  </div><div class="line">GATEWAY=<span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">#DNS1=<span class="number">221.</span>X.XX<span class="number">.88</span></div><div class="line">#DNS2=<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>   （公网配了DNS和网关了）</div></pre></td></tr></table></figure></p>
<p>修改DNS也可以<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/resolv.conf</div><div class="line">nameserver <span class="number">221.</span>X.XX<span class="number">.88</span></div><div class="line">nameserver <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></div><div class="line">IPV6INIT=no #禁止IPV6</div></pre></td></tr></table></figure></p>
<p>:wq! #保存退出</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">service ip6tables <span class="keyword">stop</span> <span class="meta">#停止IPV6服务</span></div><div class="line">chkconfig ip6tables <span class="keyword">off</span> <span class="meta">#禁止IPV6开机启动</span></div><div class="line">service yum-updatesd <span class="keyword">stop</span> <span class="meta">#关闭系统自动更新</span></div><div class="line">chkconfig yum-updatesd <span class="keyword">off</span> <span class="meta">#禁止开启启动</span></div><div class="line">service network restart <span class="meta">#重启网络连接</span></div><div class="line">ifconfig <span class="meta">#查看IP地址</span></div></pre></td></tr></table></figure>
<p>设置主机名<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/network (<span class="name">CentOS</span>)</div><div class="line">vi /etc/hosts</div><div class="line">hostname newname    #(<span class="name">newname</span>就是你要改的主机名)</div></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">service network restart  或  /etc/network restart</div><div class="line">yum <span class="keyword">install</span> wget lrzsz -y</div><div class="line">service sshd <span class="keyword">start</span></div><div class="line">chkconfig sshd <span class="keyword">on</span></div><div class="line"><span class="keyword">shutdown</span> -r <span class="keyword">now</span> #重启系统</div></pre></td></tr></table></figure>
<hr>
<h2 id="Ubuntu14-04及以上版本"><a href="#Ubuntu14-04及以上版本" class="headerlink" title="Ubuntu14.04及以上版本"></a>Ubuntu14.04及以上版本</h2><p>新安装的Ubuntu如果没有root用户密码，用<code>sudo passwd root</code>设置root密码。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">apt-get <span class="keyword">install</span> wget lrzsz openssh-<span class="keyword">server</span> vim -y</div><div class="line">/etc/init.d/ssh <span class="keyword">start</span></div></pre></td></tr></table></figure></p>
<p><strong>配置文件etc/ssh/sshd_config</strong><br>将 <strong>/etc/ssh/sshd_confg中PermitRootLogin  no 改为yes</strong>，重新启动ssh服务<code>service sshd restart</code><br>最重要的一点是Ubuntu超级用户root用户被禁用掉了，这就是为什么我们登陆时只能以普通用户登陆，而且switch user时没有root选项。<br>必须使用命令启动root。即输入：sudo  passwd。然后输入密码即可启动root。</p>
<p>网卡地址配置<br>Ubuntu的网络配置文件是：<code>/etc/network/interfaces</code></p>
<p>1、为网卡配置静态IP地址<br><code>sudo vi /etc/network/interfaces</code><br>双网不要配内网网关<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">auto</span> lo</div><div class="line">iface lo inet loopback</div><div class="line">#ifconfig看到eth0用作公网</div><div class="line"><span class="attribute">auto</span> eth0   （有的可能是eno0或eno1）</div><div class="line">iface eth0 inet static</div><div class="line"><span class="selector-tag">address</span> <span class="number">221</span><span class="selector-class">.X</span><span class="selector-class">.XXX</span>.<span class="number">114</span></div><div class="line">gateway <span class="number">221</span><span class="selector-class">.X</span><span class="selector-class">.XXX</span>.<span class="number">97</span></div><div class="line">netmask <span class="number">255.255</span>.<span class="number">255.224</span></div><div class="line">dns-nameservers <span class="number">221</span><span class="selector-class">.X</span><span class="selector-class">.XX</span>.<span class="number">88</span></div><div class="line">dns-nameservers <span class="number">8.8</span>.<span class="number">8.8</span></div><div class="line"><span class="attribute">auto</span> eth1</div><div class="line">iface eth1 inet static</div><div class="line"><span class="selector-tag">address</span> <span class="number">192.168</span>.<span class="number">0.254</span></div><div class="line">netmask <span class="number">255.255</span>.<span class="number">252.0</span></div><div class="line"><span class="selector-id">#gateway</span> <span class="number">192.168</span>.<span class="number">0.1</span></div><div class="line">:wq 保存退出</div><div class="line">/etc/init.d/networking restart</div></pre></td></tr></table></figure></p>
<p>2、以DHCP 方式配置网卡<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">auto</span> eth0</div><div class="line">iface eth0 inet dhcp</div></pre></td></tr></table></figure></p>
<p>用<code>/etc/init.d/networking restart</code>命令使网络设置生效</p>
<p>修改DNS服务器<br>法一<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/network/interfaces</div><div class="line">dns-nameservers <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></div></pre></td></tr></table></figure></p>
<p>法二<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi /etc/resolvconf/resolv<span class="selector-class">.conf</span><span class="selector-class">.d</span>/head    #重启后生效，重启不失效</div><div class="line">resolvconf -u</div><div class="line">iptables -A INPUT -<span class="selector-tag">p</span> tcp -<span class="selector-tag">i</span> eth0 --dport <span class="number">22</span> -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>修改主机名<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">vi</span> /etc/<span class="built_in">hostname</span>(Ubuntu)</div><div class="line"><span class="keyword">vi</span> /etc/hosts</div><div class="line"><span class="built_in">hostname</span> newname   #newname就是你要改的主机名</div></pre></td></tr></table></figure></p>
<p><code>/etc/init.d/networking restart</code></p>
<p><code>shutdown -r now</code>   重启系统</p>
<hr>
<h1 id="Ubuntu-系统版本升级（如从16-04升到16-10）"><a href="#Ubuntu-系统版本升级（如从16-04升到16-10）" class="headerlink" title="Ubuntu 系统版本升级（如从16.04升到16.10）"></a>Ubuntu 系统版本升级（如从16.04升到16.10）</h1><p>Canonical 已经提供了一个直接升级的方法，非常快捷容易。适用于：Kubuntu、 Xubuntu、 Lubuntu、 Ubuntu GNOME、 Ubuntu Mate。<br>首先更新一下系统：<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="built_in">get</span> update</div><div class="line">sudo apt-<span class="built_in">get</span> <span class="built_in">dist</span>-upgrade</div></pre></td></tr></table></figure></p>
<p>接下来，需要安装更新管理器的核心：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get <span class="keyword">install</span> <span class="keyword">update</span>-manager-core  </div><div class="line">sudo <span class="keyword">do</span>-<span class="keyword">release</span>-<span class="keyword">upgrade</span> -d  或  sudo <span class="keyword">update</span>-manager -d</div></pre></td></tr></table></figure></p>
<p>注：<strong>d-release-upgrade</strong> 命令是帮助我们寻找最新的稳定版本，而 <strong>-d</strong> 参数意思是包括非稳定版本。</p>
<hr>
<hr>
<h1 id="浙江服务器（20160910）"><a href="#浙江服务器（20160910）" class="headerlink" title="浙江服务器（20160910）"></a>浙江服务器（20160910）</h1><p><strong>现在可能已经变了，仅仅只是当时的情况。</strong></p>
<p>例：<br>192.168.0.99   采集服务器</p>
<p>192.168.0.233  安装有hls和lts</p>
<p>192.168.0.234  安装有lts</p>
<p>192.168.0.236  安装有lts</p>
<p>192.168.0.234或192.168.0.236的转码来源可以来自装有hls的192.168.0.233，也可以直接来自其他服务器，</p>
<p>在3台服务器lts源直接填写其他服务器，转码（来源转H265）任务平均分配到192.168.0.234和192.168.0.236上，每台转7个节目，输出udp://127.0.0.1:xxxx/TVxxx   但是，192.168.0.234和192.168.0.236上的输出不能填写udp://127.0.0.1:xxxx/TVxxx 而应该是udp://192.168.0.233:xxxx/TVxxx(必须输出到装有hls模块的机子上，然后在192.168.0.233上才能获取的到)<br>此时在192.168.0.233上才能把3台服务器转出来的作为节目推送出去，同时也能作为源输入进行转H264</p>
<hr>
<hr>
<h1 id="zibibx监控（自定义的文件配置）"><a href="#zibibx监控（自定义的文件配置）" class="headerlink" title="zibibx监控（自定义的文件配置）"></a>zibibx监控（自定义的文件配置）</h1><h2 id="转码节目的监控"><a href="#转码节目的监控" class="headerlink" title="转码节目的监控"></a>转码节目的监控</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd <span class="regexp">/opt/</span>starview<span class="regexp">/cdn/</span>lts<span class="regexp">/cfg/</span>channels<span class="regexp">/</span></div></pre></td></tr></table></figure>
<p>会根据这个目录下的文件来查找进程，如果有没有这个进程就报警（这些文件是由lts模块下发时生成的）</p>
<hr>
<h2 id="采集卡监控"><a href="#采集卡监控" class="headerlink" title="采集卡监控"></a>采集卡监控</h2><p>具体监控那些卡在<strong>/media/caiji</strong> 文件里写明</p>
<hr>
<hr>
<h1 id="采集服务器搭建"><a href="#采集服务器搭建" class="headerlink" title="采集服务器搭建"></a>采集服务器搭建</h1><h2 id="MuMuDVB安装"><a href="#MuMuDVB安装" class="headerlink" title="MuMuDVB安装"></a>MuMuDVB安装</h2><p>MuMuDVB安装:</p>
<ol>
<li><p>安装libdvbcsa库：<br><code>svn co svn://svn.videolan.org/libdvbcsa/trunk libdvbcsa</code><br>或者：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">wget http:<span class="comment">//download.videolan.org/pub/videolan/libdvbcsa/1.1.0/libdvbcsa-1.1.0.tar.gz</span></div><div class="line">tar -xvf libdvbcsa-<span class="number">1.1</span>.<span class="number">0</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line">cd libdvbcsa-<span class="number">1.1</span>.<span class="number">0</span></div><div class="line">./bootstrap</div><div class="line">./configure --prefix=/usr</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure>
</li>
<li><p>mumudvb安装：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">git clone gi<span class="variable">t:</span>//github.<span class="keyword">com</span>/braice/MuMuDVB.git</div><div class="line"><span class="keyword">cd</span> MuMuDVB</div><div class="line">apt-<span class="built_in">get</span> install autoconf</div><div class="line">autoreconf -i -<span class="keyword">f</span></div><div class="line">./configure --prefix=/usr --enable-cam-support --enable-scam-support</div><div class="line"><span class="keyword">make</span></div><div class="line"><span class="keyword">make</span> install</div></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="采集卡安装驱动"><a href="#采集卡安装驱动" class="headerlink" title="采集卡安装驱动"></a>采集卡安装驱动</h2><p>1.安装驱动及mumudvb所需的包：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">apt</span>-<span class="meta">get</span> install git <span class="keyword">subversion </span>make gcc libtool gettext dvb-apps unzip -y</div></pre></td></tr></table></figure></p>
<p>2.驱动安装：<br>首先去tbsdtv官网下载相应的linux版本驱动，网址：<br><a href="http://tbsdtv.com/download" target="_blank" rel="external">http://tbsdtv.com/download</a><br>现在用到的两款分别为：<br>TBS6985 DVB-S2 Quad Tuner PCIe Card [不用管卡是什么型号]<br>TBS6285 DVB-C  Quad Tuner PCIe Card</p>
<p>下载相应驱动,然后执行以下命令(以下载到的驱动文件名为tbs-linux-drivers_v140210.zip为例)：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">unzip tbs-linux-drivers_v160126.zip -d ./tbs-linux-drivers_v160126</div><div class="line">cd tbs-linux-drivers_v160126</div><div class="line">tar xjvf linux-tbs-drivers.tar.bz2</div><div class="line">cd linux-tbs-drivers</div><div class="line"></div><div class="line">find . -type d -<span class="keyword">exec</span> <span class="keyword">chmod</span> u+wx <span class="string">'&#123;&#125;'</span> \;</div><div class="line">find . -name <span class="string">"*.sh"</span> -o -name <span class="string">"*.pl"</span> -<span class="keyword">exec</span> <span class="keyword">chmod</span> u+<span class="keyword">x</span> <span class="string">'&#123;&#125;'</span> \;</div><div class="line">./v4l/tbs-x86_64.sh</div><div class="line"></div><div class="line"><span class="comment">#[注：如果是TBS6285 DVBC的卡， 则需要另外执行命令： ./v4l/tbs-dvbc-x86_64.sh]</span></div><div class="line"></div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>重启电脑(必须重启驱动才能识别)：<br><code>shutdown -r now</code></p>
<p>然后执行：<code>dmesg | grep frontend</code></p>
<p>如果出现如下打印，则证明安装成功：<br><strong>如果是TBS6985 DVB-S2 Quad Tuner PCIe Card卡</strong>:<br>[    7.561200] DVB: registering adapter 0 frontend 0 (TurboSight TBS 6985 DVBS/S2 frontend)…<br>[    8.121858] DVB: registering adapter 1 frontend 0 (TurboSight TBS 6985 DVBS/S2 frontend)…<br><strong>如果是TBS6285 DVB-C Quad Tuner PCIe Card卡</strong>:<br>[   10.852763] DVB: registering adapter 0 frontend 0 (TurboSight TBS 62x1 DVBC frontend)…<br>[   13.178521] DVB: registering adapter 1 frontend 0 (TurboSight TBS 62x1 DVBC frontend)…<br>[<br>注:<br>如果不能看到如上打印, 则可执行以下命令：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /<span class="class"><span class="keyword">lib</span>/<span class="title">modules</span>/(内核版本)/<span class="title">kernel</span>/<span class="title">drivers</span>/</span></div><div class="line"></div><div class="line">mv media media.bak</div></pre></td></tr></table></figure>
<p>本机的内核版本号，可执行命令:<code>uname -r</code><br>获取，如为:  3.13.0-48-generic, 则执行的语句为：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /<span class="class"><span class="keyword">lib</span>/<span class="title">modules</span>/3.13.0-48-<span class="title">generic</span>/<span class="title">kernel</span>/<span class="title">drivers</span>/</span></div><div class="line">mv media media.bak]]</div><div class="line"></div><div class="line">make install</div><div class="line">shutdown -r now</div></pre></td></tr></table></figure></p>
<p>重新启动之后，再用上面的<code>dmesg | grep frontend</code>命令确认是否有正确的打印信息。</p>
<hr>
<h1 id="PowerVu安装"><a href="#PowerVu安装" class="headerlink" title="PowerVu安装"></a>PowerVu安装</h1><p>地址：<a href="http://ofyfogrgx.bkt.clouddn.com/PowerVu%E5%AE%89%E8%A3%85.zip" target="_blank" rel="external">PowerVu安装.zip</a>   密码：1087。。。 </p>
<hr>
<hr>
<h1 id="转码服务器搭建"><a href="#转码服务器搭建" class="headerlink" title="转码服务器搭建"></a>转码服务器搭建</h1><h2 id="显卡GPU驱动"><a href="#显卡GPU驱动" class="headerlink" title="显卡GPU驱动"></a>显卡GPU驱动</h2><h3 id="简版（自己整理）"><a href="#简版（自己整理）" class="headerlink" title="简版（自己整理）"></a>简版（自己整理）</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">cd /etc/modprobe.d/</div><div class="line">vim disable-nouveau.conf</div><div class="line"></div><div class="line">blacklist nouveau</div><div class="line">options nouveau modeset=<span class="number">0</span></div><div class="line"></div><div class="line">dracut --force</div><div class="line">cd /root</div><div class="line">chmod <span class="number">0777</span> ./cuda_7<span class="number">.5</span><span class="number">.18</span>_linux.run</div><div class="line">chmod <span class="number">0777</span> ./NVIDIA-Linux-x86_64<span class="number">-352.63</span>.run</div><div class="line">vim /etc/inittab     #改<span class="number">5</span>为<span class="number">3</span></div><div class="line"></div><div class="line">reboot</div><div class="line"></div><div class="line">./cuda_7<span class="number">.5</span><span class="number">.18</span>_linux.run             #（依赖库包）【当前目录为/root】</div><div class="line">./NVIDIA-Linux-x86_64<span class="number">-352.63</span>.run    #（最后有一个询问是否要安装X界面的，不用的可以不安装）</div></pre></td></tr></table></figure>
<hr>
<h3 id="详细版"><a href="#详细版" class="headerlink" title="详细版"></a>详细版</h3><h4 id="下载最新的nvidia官网驱动"><a href="#下载最新的nvidia官网驱动" class="headerlink" title="下载最新的nvidia官网驱动"></a>下载最新的nvidia官网驱动</h4><h4 id="禁用开源nouveau驱动"><a href="#禁用开源nouveau驱动" class="headerlink" title="禁用开源nouveau驱动:"></a>禁用开源nouveau驱动:</h4><p>在/etc/modprobe.d 下创建名为disable-nouveau.conf的文件， 内容为：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">blacklist</span> nouveau</div><div class="line"><span class="attribute"><span class="nomarkup">options</span></span> nouveau modeset=0</div></pre></td></tr></table></figure></p>
<p><strong>ubuntu执行</strong>: <code>sudo update-initramfs -u</code> 使其生效。</p>
<p><strong>centos执行</strong>: <code>sudo dracut --force</code>      使其生效。</p>
<h4 id="ubuntu配置kernel以text模式启动："><a href="#ubuntu配置kernel以text模式启动：" class="headerlink" title="ubuntu配置kernel以text模式启动："></a>ubuntu配置kernel以text模式启动：</h4><p>修改/etc/default/grub文件：<br>将<strong>GRUB_CMDLINE_LINUX_DEFAULT=”quiet splash”</strong>行改为：<strong>GRUB_CMDLINE_LINUX_DEFAULT=”text”</strong><br>将<strong>GRUB_CMDLINE_LINUX=””</strong>行改为：<strong>GRUB_CMDLINE_LINUX=”rdblacklist=nouveau nouveau.modeset=0”</strong><br>执行: <code>sudo update-grub</code> 使其生效    </p>
<h4 id="centos配置kernel以text模式启动："><a href="#centos配置kernel以text模式启动：" class="headerlink" title="centos配置kernel以text模式启动："></a>centos配置kernel以text模式启动：</h4><p>修改/etc/inittab 将最后一行“<strong>id:5:initdefault:</strong>”修改成“<strong>id:3:initdefault:</strong>”（不包含引号）</p>
<h4 id="重启电脑，在text模式下，-终端中执行安装文件"><a href="#重启电脑，在text模式下，-终端中执行安装文件" class="headerlink" title="重启电脑，在text模式下， 终端中执行安装文件"></a>重启电脑，在text模式下， 终端中执行安装文件</h4><p><strong>centos</strong>:<code>sudo yum install gcc kernel-devel-$(uname -r) kernel-headers-$(uname -r)</code><br>（在XShell中直接通过<strong>chmod 777 </strong>将以下两个文件设为最高权限。通过<strong>./</strong>命令将两个脚本分别执行）</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install kernel-devel<span class="selector-class">.x86_64</span> -y</div><div class="line">sudo ./cuda_7.<span class="number">5.18</span>_linux<span class="selector-class">.run</span></div><div class="line">sudo ./NVIDIA-Linux-x86_64-<span class="number">352.21</span>.run</div></pre></td></tr></table></figure>
<p>安装过程中交互的地方一直选择继续(Y)或者默认参数即可.</p>
<p><code>lspci |grep VGA</code>  查看显卡数量</p>
<h4 id="ubuntu-安装完成之后"><a href="#ubuntu-安装完成之后" class="headerlink" title="(ubuntu) 安装完成之后"></a>(ubuntu) 安装完成之后</h4><p>还原/etc/default/grub文件中的<strong>GRUB_CMDLINE_LINUX_DEFAULT</strong>行， 再执行<code>update-grub</code>，使重启后用图形模式进入系统 。</p>
<h4 id="centos-安装完成之后"><a href="#centos-安装完成之后" class="headerlink" title="(centos) 安装完成之后"></a>(centos) 安装完成之后</h4><p>修改/etc/inittab 将最后一行“<strong>id:3:initdefault:</strong>”修改成“<strong>id:5:initdefault:</strong>”（不包含引号），重启进入图形模式。</p>
<h4 id="检验："><a href="#检验：" class="headerlink" title="检验："></a>检验：</h4><p><code>nvidia-smi</code></p>
<hr>
<h1 id="内核升级和安装OTT"><a href="#内核升级和安装OTT" class="headerlink" title="内核升级和安装OTT"></a>内核升级和安装OTT</h1><h2 id="Linux内核升级"><a href="#Linux内核升级" class="headerlink" title="Linux内核升级"></a>Linux内核升级</h2><p>先安装显卡驱动再安装OTT（重要）<br>貌似Linux内核版本要高于3.0才能安装显卡驱动</p>
<p>内核升级：【内核版本 <a href="https://www.kernel.org/】" target="_blank" rel="external">https://www.kernel.org/】</a><br>参考<a href="http://blog.csdn.net/taiyang1987912/article/details/42744019" target="_blank" rel="external">http://blog.csdn.net/taiyang1987912/article/details/42744019</a><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">yum install ncurses-devel -y</div><div class="line">yum install hmaccalc zlib-devel binutils-devel elfutils-libelf-devel -y</div><div class="line">wget  https:<span class="comment">//www.kernel.org/pub/linux/kernel/v3.x/linux-3.10.28.tar.xz     </span></div><div class="line">tar -xf linux-<span class="number">3.10</span>.<span class="number">28</span><span class="selector-class">.tar</span><span class="selector-class">.xz</span></div><div class="line">mv linux-<span class="number">3.10</span>.<span class="number">28</span> /usr/src/</div><div class="line">cd /usr/src/linux-<span class="number">3.10</span>.<span class="number">28</span>/</div><div class="line">cp /boot/config-<span class="number">2.6</span>.<span class="number">32</span>-<span class="number">573</span><span class="selector-class">.el6</span><span class="selector-class">.x86_64</span> <span class="selector-class">.config</span></div><div class="line">sh -c <span class="string">'yes "" | make oldconfig'</span></div><div class="line">make oldconfig</div></pre></td></tr></table></figure></p>
<p>cpu核数 <code>cat /proc/cpuinfo| grep &quot;processor&quot;| wc -l</code>   下面-j后面的48是cpu核数（指定编译核数）<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">make</span> -j48 bzImage</div><div class="line"><span class="built_in">make</span> -j48 modules</div><div class="line"><span class="built_in">make</span> -j48 modules_install</div><div class="line"><span class="built_in">make</span> install</div></pre></td></tr></table></figure></p>
<p><code>vi /etc/grub.conf</code><br> 【看新安装的内核在第几段，一般是在第一段，从0开始数看title CentOS (3.10.28) 在第一段为default=0，第二段为default=1】<br>例如:<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#boot=/dev/sdb</div><div class="line"><span class="section">default</span>=<span class="number">0</span></div><div class="line">timeout=<span class="number">5</span></div><div class="line">splashimage=(hd0,<span class="number">0</span>)/grub/splash.xpm.gz</div><div class="line">hiddenmenu</div><div class="line">title CentOS (<span class="number">3.10</span><span class="number">.28</span>)</div><div class="line">        root (hd0,<span class="number">0</span>)</div><div class="line">        kernel /vmlinuz<span class="number">-3.10</span><span class="number">.28</span> ro root=UUID=<span class="number">28</span>fbaad8<span class="number">-35</span>a6<span class="number">-4348</span>-b1e0-bf204537f8b0 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF<span class="number">-8</span> rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</div><div class="line">        initrd /initramfs<span class="number">-3.10</span><span class="number">.28</span>.img</div><div class="line">title CentOS (<span class="number">2.6</span><span class="number">.32</span><span class="number">-642.3</span><span class="number">.1</span>.el6.x86_64)</div><div class="line">        root (hd0,<span class="number">0</span>)</div><div class="line">        kernel /vmlinuz<span class="number">-2.6</span><span class="number">.32</span><span class="number">-642.3</span><span class="number">.1</span>.el6.x86_64 ro root=UUID=<span class="number">28</span>fbaad8<span class="number">-35</span>a6<span class="number">-4348</span>-b1e0-bf204537f8b0 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF<span class="number">-8</span> rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</div><div class="line">        initrd /initramfs<span class="number">-2.6</span><span class="number">.32</span><span class="number">-642.3</span><span class="number">.1</span>.el6.x86_64.img</div><div class="line">title CentOS <span class="number">6</span> (<span class="number">2.6</span><span class="number">.32</span><span class="number">-573.</span>el6.x86_64)</div><div class="line">        root (hd0,<span class="number">0</span>)</div><div class="line">        kernel /vmlinuz<span class="number">-2.6</span><span class="number">.32</span><span class="number">-573.</span>el6.x86_64 ro root=UUID=<span class="number">28</span>fbaad8<span class="number">-35</span>a6<span class="number">-4348</span>-b1e0-bf204537f8b0 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF<span class="number">-8</span> rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</div><div class="line">        initrd /initramfs<span class="number">-2.6</span><span class="number">.32</span><span class="number">-573.</span>el6.x86_64.img</div></pre></td></tr></table></figure></p>
<p>改好后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">uname -r    #查看内核版本</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="安装OTT"><a href="#安装OTT" class="headerlink" title="安装OTT"></a>安装OTT</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/</div><div class="line">rm -rf emailhtml/ nginx/ rh/ starview/</div><div class="line"></div><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/upgrade/</div><div class="line">tar -Pzxvf common_tools.tar.gz</div><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/starview/tools/install/</div><div class="line">./install.<span class="keyword">sh</span></div><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/starview/cdn/</div><div class="line">./get_host_info</div><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/starview/boss/cms/bin/</div><div class="line">./shutdown.<span class="keyword">sh</span></div><div class="line">./startup.<span class="keyword">sh</span></div><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/starview/cdn/hls/bin/</div><div class="line">./shutdown.<span class="keyword">sh</span></div><div class="line">./startup.<span class="keyword">sh</span></div><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/starview/cdn/lts/bin/</div><div class="line">./shutdown.<span class="keyword">sh</span></div><div class="line">./startup.<span class="keyword">sh</span></div></pre></td></tr></table></figure>
<hr>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;强迫症犯了，陈列在笔记中，于是弄成笔记保存。&lt;/p&gt;
&lt;h1 id=&quot;MK
    
    </summary>
    
      <category term="杂项" scheme="https://www.leolan.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="珠海迈科笔记" scheme="https://www.leolan.top/tags/%E7%8F%A0%E6%B5%B7%E8%BF%88%E7%A7%91%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Rsync</title>
    <link href="https://www.leolan.top/posts/55326/"/>
    <id>https://www.leolan.top/posts/55326/</id>
    <published>2017-03-18T15:35:41.000Z</published>
    <updated>2017-03-20T09:50:40.158Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="搭建同步环境"><a href="#搭建同步环境" class="headerlink" title="搭建同步环境"></a>搭建同步环境</h1><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>下载链接：<br>服务端：<a href="http://ofyfogrgx.bkt.clouddn.com/image/20170318/234212383.exe" target="_blank" rel="external">http://ofyfogrgx.bkt.clouddn.com/image/20170318/234212383.exe</a><br>客户端：<a href="http://ofyfogrgx.bkt.clouddn.com/image/20170318/234502534.exe" target="_blank" rel="external">http://ofyfogrgx.bkt.clouddn.com/image/20170318/234502534.exe</a></p>
<p>Windows上安装比较简单，直接安装服务端，设置账户密码时不要更改（更改后会认证失败），安装服务端后修改安装目录下的rsyncd.conf文件，增加：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">uid</span> = <span class="number">0</span></div><div class="line"><span class="attr">gid</span> = <span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>安装客户端后要用绝对路径运行，增加了环境变量才能直接运行。</p>
<p>配置参考(配置文件不建议用上面的，在win中会导致各种问题，用默认的即可，排除文件可以参考)：<br><a href="http://www.jb51.net/article/59034.htm" target="_blank" rel="external">在Windows中配置Rsync同步文件的方法</a><br><a href="http://blog.csdn.net/lenovouser/article/details/48626371" target="_blank" rel="external">使用cwRsync实现windows下文件定时同步</a><br><a href="http://tech.huweishen.com/gongju/1617.html" target="_blank" rel="external">文件同步工具CwRsync的使用方法及常用命令详解</a></p>
<hr>
<h2 id="同步代码"><a href="#同步代码" class="headerlink" title="同步代码"></a>同步代码</h2><p><strong>参数说明</strong><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">-<span class="ruby">v, --verbose 详细模式输出</span></div><div class="line">-<span class="ruby">q, --quiet 精简输出模式</span></div><div class="line">-<span class="ruby">c, --checksum 打开校验开关，强制对文件传输进行校验</span></div><div class="line">-<span class="ruby">a, --archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD</span></div><div class="line">-<span class="ruby">r, --recursive 对子目录以递归模式处理</span></div><div class="line">-<span class="ruby">R, --relative 使用相对路径信息</span></div><div class="line">-<span class="ruby">b, --backup 创建备份，也就是对于目的已经存在有同样的文件名时，将老的文件重新命名为~filename。可以使用--suffix选项来指定不同的备份文件前缀。</span></div><div class="line">-<span class="ruby">-backup-dir 将备份文件(如~filename)存放在在目录下。</span></div><div class="line">-<span class="ruby">suffix=SUFFIX 定义备份文件前缀</span></div><div class="line">-<span class="ruby">u, --update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件。(不覆盖更新的文件)</span></div><div class="line">-<span class="ruby">l, --links 保留软链结</span></div><div class="line">-<span class="ruby">L, --copy-links 想对待常规文件一样处理软链结</span></div><div class="line">-<span class="ruby">-copy-unsafe-links 仅仅拷贝指向SRC路径目录树以外的链结</span></div><div class="line">-<span class="ruby">-safe-links 忽略指向SRC路径目录树以外的链结</span></div><div class="line">-<span class="ruby">H, --hard-links 保留硬链结</span></div><div class="line">-<span class="ruby">p, --perms 保持文件权限</span></div><div class="line">-<span class="ruby">o, --owner 保持文件属主信息</span></div><div class="line">-<span class="ruby">g, --group 保持文件属组信息</span></div><div class="line">-<span class="ruby">D, --devices 保持设备文件信息</span></div><div class="line">-<span class="ruby">t, --times 保持文件时间信息</span></div><div class="line">-<span class="ruby">S, --sparse 对稀疏文件进行特殊处理以节省DST的空间</span></div><div class="line">-<span class="ruby">n, --dry-run现实哪些文件将被传输</span></div><div class="line">-<span class="ruby">W, --whole-file 拷贝文件，不进行增量检测</span></div><div class="line">-<span class="ruby">x, --one-file-system 不要跨越文件系统边界</span></div><div class="line">-<span class="ruby">B, --block-size=SIZE 检验算法使用的块尺寸，默认是<span class="number">700</span>字节</span></div><div class="line">-<span class="ruby">e, --rsh=COMMAND 指定使用rsh、ssh方式进行数据同步</span></div><div class="line">-<span class="ruby">-rsync-path=PATH 指定远程服务器上的rsync命令所在路径信息</span></div><div class="line">-<span class="ruby">C, --cvs-exclude 使用和CVS一样的方法自动忽略文件，用来排除那些不希望传输的文件</span></div><div class="line">-<span class="ruby">-existing 仅仅更新那些已经存在于DST的文件，而不备份那些新创建的文件</span></div><div class="line">-<span class="ruby">-delete 删除那些DST中SRC没有的文件,与服务端保持一致</span></div><div class="line">-<span class="ruby">-delete-excluded 同样删除接收端那些被该选项指定排除的文件</span></div><div class="line">-<span class="ruby">-delete-after 传输结束以后再删除</span></div><div class="line">-<span class="ruby">-ignore-errors 及时出现IO错误也进行删除</span></div><div class="line">-<span class="ruby">-max-delete=NUM 最多删除NUM个文件</span></div><div class="line">-<span class="ruby">-partial 保留那些因故没有完全传输的文件，以是加快随后的再次传输</span></div><div class="line">-<span class="ruby">-force 强制删除目录，即使不为空</span></div><div class="line">-<span class="ruby">-numeric-ids 不将数字的用户和组ID匹配为用户名和组名</span></div><div class="line">-<span class="ruby">-timeout=TIME IP超时时间，单位为秒</span></div><div class="line">-<span class="ruby">I, --ignore-times 不跳过那些有同样的时间和长度的文件</span></div><div class="line">-<span class="ruby">-size-only 当决定是否要备份文件时，仅仅察看文件大小而不考虑文件时间</span></div><div class="line">-<span class="ruby">-modify-window=NUM 决定文件是否时间相同时使用的时间戳窗口，默认为<span class="number">0</span></span></div><div class="line">-<span class="ruby">T --temp-dir=DIR 在DIR中创建临时文件</span></div><div class="line">-<span class="ruby">-compare-dest=DIR 同样比较DIR中的文件来决定是否需要备份</span></div><div class="line">-<span class="ruby">P 等同于 --partial</span></div><div class="line">-<span class="ruby">-progress 显示备份过程</span></div><div class="line">-<span class="ruby">z, --compress 对备份的文件在传输时进行压缩处理</span></div><div class="line">-<span class="ruby">-exclude=PATTERN 指定排除不需要传输的文件模式</span></div><div class="line">-<span class="ruby">-<span class="keyword">include</span>=PATTERN 指定不排除而需要传输的文件模式</span></div><div class="line">-<span class="ruby">-exclude-from=FILE 排除FILE中指定模式的文件</span></div><div class="line">-<span class="ruby">-<span class="keyword">include</span>-from=FILE 不排除FILE指定模式匹配的文件</span></div><div class="line">-<span class="ruby">-version 打印版本信息</span></div><div class="line">-<span class="ruby">-address 绑定到特定的地址</span></div><div class="line">-<span class="ruby">-config=FILE 指定其他的配置文件，不使用默认的rsyncd.conf文件</span></div><div class="line">-<span class="ruby">-port=PORT 指定其他的rsync服务端口</span></div><div class="line">-<span class="ruby">-blocking-io 对远程shell使用阻塞IO</span></div><div class="line">-<span class="ruby">stats 给出某些文件的传输状态</span></div><div class="line">-<span class="ruby">-progress 在传输时现实传输过程</span></div><div class="line">-<span class="ruby">-log-format=formAT 指定日志文件格式</span></div><div class="line">-<span class="ruby">-password-file=FILE 从FILE中得到密码</span></div><div class="line">-<span class="ruby">-bwlimit=KBPS 限制I/O带宽，KBytes per second</span></div><div class="line">-<span class="ruby">h, --help 显示帮助信息</span></div></pre></td></tr></table></figure></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rsync -auvz --delete SvcCWRSYNC<span class="variable">@172</span>.<span class="number">16.16</span>.<span class="number">80</span><span class="symbol">:</span><span class="symbol">:api</span> /cygdrive/c/Project</div><div class="line">rsync -auvz --delete SvcCWRSYNC<span class="variable">@172</span>.<span class="number">16.16</span>.<span class="number">80</span><span class="symbol">:</span><span class="symbol">:api2</span> /cygdrive/c/Project/APIS_Mobile</div></pre></td></tr></table></figure>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;搭建同步环境&quot;&gt;&lt;a href=&quot;#搭建同步环境&quot; class=
    
    </summary>
    
      <category term="环境搭建" scheme="https://www.leolan.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="Rsync" scheme="https://www.leolan.top/tags/Rsync/"/>
    
  </entry>
  
  <entry>
    <title>cmd_bat脚本</title>
    <link href="https://www.leolan.top/posts/58627/"/>
    <id>https://www.leolan.top/posts/58627/</id>
    <published>2017-03-18T14:31:02.000Z</published>
    <updated>2017-03-31T03:55:09.813Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="bat-cmd常用命令"><a href="#bat-cmd常用命令" class="headerlink" title="bat_cmd常用命令"></a>bat_cmd常用命令</h1><p><strong>::</strong>　　　注释<br><strong>md</strong>　　　创建目录<br><strong>xcopy</strong>　　　xcopy要用绝对路径才能在脚本里运行，遇到目录会提示，要指定参数，具体参数看帮助<code>xcopy /?</code><br><strong>rd /s /q</strong>　　　删除目录<br>如果要删除一个目录下的所有文件，用del命令是无法删除目录的，可以先<strong>rd</strong>后<strong>md</strong>。<br>同样<strong>移动文件夹</strong>时<strong>move</strong>只能移动文件，而不能移动文件夹；可以先<strong>xcopy</strong>然后<strong>rd</strong>。</p>
<p><strong>puase</strong>　　　结尾加上这个，不用<strong>goto exit</strong>则会等待用户按任意键后才会退出脚本。</p>
<hr>
<h1 id="关于时间的获取-格式：20170318-："><a href="#关于时间的获取-格式：20170318-：" class="headerlink" title="关于时间的获取(格式：20170318)："></a><font color="#0000EE">关于时间的获取</font>(格式：20170318)：</h1><p>win7中：<code>%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%</code><br>win_server：<code>%date:~10,4%%date:~4,2%%date:~7,2%</code></p>
<hr>
<h1 id="电源管理-具体参数看：shutdown-："><a href="#电源管理-具体参数看：shutdown-：" class="headerlink" title="电源管理(具体参数看：shutdown /?)："></a><font color="#0000EE">电源管理</font>(具体参数看：shutdown /?)：</h1><p>在5：30分自动关机：<code>at 05:30 shutdown -s -f</code><br>在XXX分钟后重启：<code>shutdown -r -t 60</code></p>
<hr>
<h1 id="forfiles命令（针对文件的操作命令）："><a href="#forfiles命令（针对文件的操作命令）：" class="headerlink" title="forfiles命令（针对文件的操作命令）："></a><font color="#0000EE">forfiles</font>命令（针对文件的操作命令）：</h1><p>/p 指定的路径<br>/s 包括子目录<br>/m 查找的文件名掩码<br>/d 指定日期,有绝对日期和相对日期, 此处-7指当前日期 的7天前<br>/c 运行的命令行   表示为每个文件执行的命令。命令字符串应该用双引号括起来。默认命令是 “cmd /c echo @file”。下列变量可以用在命令字符串中:</p>
<ul>
<li>@file    - 返回文件名。</li>
<li>@fname   - 返回不带扩展名的文件名。</li>
<li>@ext     - 只返回文件的扩展。</li>
<li>@path    - 返回文件的完整路径。</li>
<li>@relpath - 返回文件的相对路径。</li>
<li>@isdir   - 如果文件类型是目录，返回 “TRUE”；如果是文件，返回 “FALSE”。</li>
<li>@fsize   - 以字节为单位返回文件大小。</li>
<li>@fdate   - 返回文件上一次修改的日期。</li>
<li>@ftime   - 返回文件上一次修改的时间。</li>
</ul>
<p><strong>示例</strong><br>要列出驱动器 C: 上的所有批处理文件，请键入：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /m</span>*.bat <span class="regexp">/c"cmd /</span>c echo @<span class="keyword">file</span> is a batch <span class="keyword">file</span><span class="string">"</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上的所有目录，请键入：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /</span>m*.* <span class="regexp">/c"cmd /</span>c <span class="keyword">if</span> <span class="meta">@isdir</span>==<span class="literal">true</span> echo <span class="meta">@file</span> is a directory<span class="string">"</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上存在时间多于 100 天的所有文件，请键入：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /m</span>*.* <span class="regexp">/dt-100 /</span>c<span class="string">"cmd /c echo @file :date &gt;= 100 days"</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上 1993 年 1 月 1 日以前创建的所有文件，而且对于日期早于 1993 年 1 月 1 日的文件显示“file is quite old!”，请键入：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /m</span>*.* <span class="regexp">/dt-01011993 /</span>c<span class="string">"cmd /c echo @file is quite old!"</span></div></pre></td></tr></table></figure></p>
<p>要按列格式列出驱动器 C: 上所有文件的扩展名，请键入：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /</span>m*.* <span class="regexp">/c "cmd /</span>c echo extension of <span class="meta">@file</span> is <span class="number">0x09</span><span class="meta">@ext</span>0x09<span class="string">" With:</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上的所有批处理文件，请键入：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /m</span> *.bat <span class="regexp">/c "cmd /</span>c echo @<span class="keyword">file</span> is a batch <span class="keyword">file</span><span class="string">"</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上的所有目录，请键入：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /</span>m *.* <span class="regexp">/c "cmd /</span>c <span class="keyword">if</span> <span class="meta">@isdir</span>==<span class="literal">true</span> echo <span class="meta">@file</span> is a directory<span class="string">"</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上存在时间多于 100 天的所有文件，请键入：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /m</span> *.* <span class="regexp">/d t-100 /</span>c <span class="string">"cmd /c echo @file :date &gt;= 100 days"</span></div></pre></td></tr></table></figure></p>
<p>要列出驱动器 C: 上 1993 年 1 月 1 日以前创建的所有文件，而且对于日期早于 1993 年 1 月 1 日的文件显示“file is quite old!”，请键入：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /m</span> *.* <span class="regexp">/d t-01011993 /</span>c <span class="string">"cmd /c echo @file is quite old!"</span></div></pre></td></tr></table></figure></p>
<p>要按列格式列出驱动器 C: 上所有文件的扩展名，请键入：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forfiles <span class="regexp">/p c:/</span> <span class="regexp">/s /</span>m*.* <span class="regexp">/c "cmd /</span>c echo extension of <span class="meta">@file</span> is <span class="number">0x09</span><span class="meta">@ext</span>0x09<span class="string">"</span></div></pre></td></tr></table></figure></p>
<hr>
<h1 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a><font color="#0000EE">for循环</font></h1><p>for /?<br>FOR 变量参照的替换已被增强。您现在可以使用下列<br>选项语法:</p>
<pre><code> ~I         - 删除任何引号(&quot;)，扩充 %I
 %~fI        - 将 %I 扩充到一个完全合格的路径名
 %~dI        - 仅将 %I 扩充到一个驱动器号
 %~pI        - 仅将 %I 扩充到一个路径
%~nI        - 仅将 %I 扩充到一个文件名
 %~xI        - 仅将 %I 扩充到一个文件扩展名
 %~sI        - 扩充的路径只含有短名
 %~aI        - 将 %I 扩充到文件的文件属性
 %~tI        - 将 %I 扩充到文件的日期/时间
 %~zI        - 将 %I 扩充到文件的大小
 %~$PATH:I   - 查找列在路径环境变量的目录，并将 %I 扩充
               到找到的第一个完全合格的名称。如果环境变量名
               未被定义，或者没有找到文件，此组合键会扩充到
               空字符串
</code></pre><p>可以组合修饰符来得到多重结果:</p>
<pre><code>%~dpI       - 仅将 %I 扩充到一个驱动器号和路径
%~nxI       - 仅将 %I 扩充到一个文件名和扩展名
%~fsI       - 仅将 %I 扩充到一个带有短名的完整路径名
%~dp$PATH:i - 查找列在路径环境变量的目录，并将 %I 扩充
              到找到的第一个驱动器号和路径。 
%~ftzaI     - 将 %I 扩充到类似输出线路的 DIR
</code></pre><h2 id="删除D-Logs下的空目录"><a href="#删除D-Logs下的空目录" class="headerlink" title="删除D:\Logs下的空目录"></a>删除D:\Logs下的空目录</h2><figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> /f "delims=" <span class="variable">%%a</span> <span class="keyword">in</span> ('<span class="built_in">dir</span> D:\Logs /b /ad /s ^|sort /r' ) <span class="keyword">do</span> <span class="built_in">rd</span> /q "<span class="variable">%%a</span>" <span class="number">2</span>&gt;<span class="built_in">nul</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="示例脚本1"><a href="#示例脚本1" class="headerlink" title="示例脚本1"></a>示例脚本1</h2><p>这个脚本是复制备份文件到指定目录（目录以20170318这种格式创建），并递归查找7天以上的旧内容并删除。<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@<span class="built_in">echo</span> off</div><div class="line"><span class="built_in">echo</span>  ----------------------------------------------------------- &gt;&gt;SQL_bat.<span class="built_in">log</span></div><div class="line"><span class="built_in">echo</span> SQL Databases backup start %<span class="built_in">Date</span>% - %<span class="built_in">time</span>% &gt;&gt;SQL_bat.<span class="built_in">log</span></div><div class="line"></div><div class="line">::<span class="built_in">set</span> yymmdd=%<span class="built_in">DATE</span>:~<span class="number">0</span>,<span class="number">4</span>%%<span class="built_in">DATE</span>:~<span class="number">5</span>,<span class="number">2</span>%%<span class="built_in">DATE</span>:~<span class="number">8</span>,<span class="number">2</span>%</div><div class="line"><span class="built_in">set</span> yymmdd=%<span class="built_in">date</span>:~<span class="number">10</span>,<span class="number">4</span>%%<span class="built_in">date</span>:~<span class="number">4</span>,<span class="number">2</span>%%<span class="built_in">date</span>:~<span class="number">7</span>,<span class="number">2</span>%</div><div class="line">md F:\DB_Buckup\%yymmdd%</div><div class="line">C:\Windows\System32\xcopy.exe C:\DBBackUp_Plan\* F:\DB_Buckup\%yymmdd% /s /e</div><div class="line">C:\Windows\System32\xcopy.exe /e /i C:\DBBackUp_Plan\* F:\DB_Buckup\%yymmdd%</div><div class="line">rd /s /q C:\DBBackUp_Plan</div><div class="line"></div><div class="line">::下面这段是搜索<span class="number">7</span>天以上旧内容并删除</div><div class="line"><span class="built_in">set</span> file_dir=<span class="string">"F:\DB_Buckup"</span></div><div class="line"><span class="built_in">set</span> bak_dat=<span class="number">7</span></div><div class="line">forfiles /p %file_dir% /S /M *.* /D -%bak_dat% /C <span class="string">"cmd /c echo del@relpath file… &amp; echo. &amp; del /s /q @file"</span> &gt;&gt;SQL_bat.<span class="built_in">log</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> SQL Databases backup <span class="built_in">stop</span> %<span class="built_in">Date</span>% - %<span class="built_in">time</span>% &gt;&gt;SQL_bat.<span class="built_in">log</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span>  ----------------------------------------------------------- &gt;&gt;SQL_bat.<span class="built_in">log</span></div><div class="line"><span class="built_in">goto</span> <span class="keyword">exit</span></div><div class="line">:<span class="keyword">exit</span></div></pre></td></tr></table></figure></p>
<hr>
<h1 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h1><h2 id="远程执行程序、脚本"><a href="#远程执行程序、脚本" class="headerlink" title="远程执行程序、脚本"></a>远程执行程序、脚本</h2><p>下载PsExec：<a href="https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx" target="_blank" rel="external">https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx</a><br><strong>下载页面有相关的使用说明</strong><br>解压文件后把psexec放到你需要的位置，如果没有添加环境变量就要用绝对路径去执行。</p>
<p><font color="#EE9A00">常见用法</font><br><strong>语法</strong>：<code>psexec 远程主机名/IP -u 用户名 -p 密码 [参数] [被执行的程序]</code><br>只在局域网内应用成功，外网没有测试过，用IP可能会连接不了远程主机，可能是防火墙的问题，可以改用主机名，在cmd里输入hostname查看主机名。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">psexec \\hostname -u Administrator -<span class="selector-tag">p</span> mypassword -<span class="selector-tag">i</span> <span class="string">"D:\123.bat"</span></div><div class="line">psexec \\hostname -u Administrator -<span class="selector-tag">p</span> mypassword -c <span class="string">"D:\123.bat"</span></div></pre></td></tr></table></figure>
<p><strong>参数</strong>：<br>-i　　是执行远程相应位置的脚本。<br>-c　　是复制本地脚本到远程执行。</p>
<p>参考：<br><a href="http://blog.csdn.net/miss_easy/article/details/47780797" target="_blank" rel="external">http://blog.csdn.net/miss_easy/article/details/47780797</a><br><a href="http://blog.sina.com.cn/s/blog_4e46983d0101ovkw.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_4e46983d0101ovkw.html</a></p>
<hr>
<h1 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h1><p>备份SqlServer数据库：<a href="http://www.jb51.net/article/61423.htm" target="_blank" rel="external">SqlServer备份数据库的4种方式介绍</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;bat-cmd常用命令&quot;&gt;&lt;a href=&quot;#bat-cmd常用
    
    </summary>
    
      <category term="Dev" scheme="https://www.leolan.top/categories/Dev/"/>
    
    
      <category term="bat脚本" scheme="https://www.leolan.top/tags/bat%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ</title>
    <link href="https://www.leolan.top/posts/33708/"/>
    <id>https://www.leolan.top/posts/33708/</id>
    <published>2017-02-28T05:44:51.000Z</published>
    <updated>2017-03-07T07:24:33.836Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Centos"><a href="#Centos" class="headerlink" title="Centos"></a>Centos</h2><p>安装RabbitMQ还比较繁琐，目前先这样，之后有时间再做改动。如果报缺少某些库，看最底下，初始环境不同。</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装依赖包和环境</span></div><div class="line">yum -y install unixODBC unixODBC-devel java libxslt xmlto</div><div class="line"></div><div class="line"><span class="comment">#安装Make（版本4以上）</span></div><div class="line">http:<span class="regexp">//</span>ftp.gnu.org/gnu/make/make<span class="number">-4.2</span>.tar.gz   <span class="number">4</span>以上</div><div class="line">tar -zxvf make<span class="number">-4.2</span>.tar.gz</div><div class="line">cd make<span class="number">-4.2</span></div><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div><div class="line"></div><div class="line">mv /usr/bin/make /usr/bin/make.bak</div><div class="line">vim /etc/profile</div><div class="line">export PATH=$PATH:/usr/local/bin/make</div><div class="line">source /etc/profile</div><div class="line"></div><div class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></div><div class="line"><span class="comment">#安装simplejson</span></div><div class="line">yum install ptyhon -y</div><div class="line">wget https:<span class="regexp">//</span>pypi.python.org/packages/<span class="number">40</span>/ad/<span class="number">52</span>c1f3a562df3b210e8f165e1aa243a178c454ead65476a39fa3ce1847b6/simplejson<span class="number">-3.10</span><span class="number">.0</span>.tar.gz<span class="comment">#md5=426a9631d22851a7a970b1a677368b15</span></div><div class="line">tar zxvf simplejson<span class="number">-3.10</span><span class="number">.0</span>.tar.gz</div><div class="line">cd simplejson<span class="number">-3.10</span><span class="number">.0</span></div><div class="line">python setup.py build</div><div class="line">python setup.py install</div><div class="line"></div><div class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></div><div class="line"><span class="comment">#安装erlang</span></div><div class="line">wget http:<span class="regexp">//</span>www.erlang.org/download/otp_src_19<span class="number">.2</span>.tar.gz</div><div class="line">tar -zxvf otp_src_19<span class="number">.2</span>.tar.gz</div><div class="line">cd otp_src_19<span class="number">.2</span></div><div class="line">./configure --without-javac</div><div class="line">make</div><div class="line">make install</div><div class="line"></div><div class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></div><div class="line"><span class="comment">#安装rabbitmq</span></div><div class="line">wget http:<span class="regexp">//</span>www.rabbitmq.com/releases/rabbitmq-server/v3<span class="number">.6</span><span class="number">.6</span>/rabbitmq-server<span class="number">-3.6</span><span class="number">.6</span>.tar.xz</div><div class="line">tar -vxf rabbitmq-server<span class="number">-3.6</span><span class="number">.6</span>.tar.xz</div><div class="line">cd rabbitmq-server<span class="number">-3.6</span><span class="number">.6</span></div><div class="line">/usr/local/bin/make TARGET_DIR=/usr/local/rabbitmq SBIN_DIR=/usr/local/rabbitmq/sbin MAN_DIR=/usr/local/rabbitmq/man DOC_INSTALL_DIR=/usr/local/rabbitmq/doc install</div><div class="line"></div><div class="line"><span class="comment">#配置</span></div><div class="line">mkdir /etc/rabbitmq</div><div class="line">cp ./deps/rabbit/docs/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</div><div class="line"></div><div class="line"><span class="comment">#启动插件</span></div><div class="line">/usr/local/lib/erlang/lib/rabbitmq_server<span class="number">-0.0</span><span class="number">.0</span>/sbin/rabbitmq-plugins enable rabbitmq_management</div><div class="line">/usr/local/lib/erlang/lib/rabbitmq_server<span class="number">-0.0</span><span class="number">.0</span>/sbin/rabbitmq-plugins enable rabbitmq_mqtt</div><div class="line"></div><div class="line"><span class="comment">#启动</span></div><div class="line">/usr/local/lib/erlang/lib/rabbitmq_server<span class="number">-0.0</span><span class="number">.0</span>/sbin/rabbitmq-server &amp;</div><div class="line"></div><div class="line"><span class="comment">#放行端口</span></div><div class="line">vim /etc/sysconfig/iptables</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="number">15672</span> -j ACCEPT</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#浏览器打开</span></div><div class="line">http:<span class="regexp">//</span>localhost:<span class="number">15672</span>   guest  guest</div><div class="line"></div><div class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></div></pre></td></tr></table></figure>
<hr>
<p>安装elixir环境的简单方法<br><a href="https://segmentfault.com/a/1190000000741218" target="_blank" rel="external">https://segmentfault.com/a/1190000000741218</a><br><a href="https://github.com/elixir-lang/elixir/archive/v1.4.2.tar.gz" target="_blank" rel="external">https://github.com/elixir-lang/elixir/archive/v1.4.2.tar.gz</a></p>
<p>配置参考：<br><a href="http://blog.csdn.net/historyasamirror/article/details/6827870" target="_blank" rel="external">http://blog.csdn.net/historyasamirror/article/details/6827870</a><br><a href="http://blog.csdn.net/feng4656/article/details/17371005" target="_blank" rel="external">http://blog.csdn.net/feng4656/article/details/17371005</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerl
    
    </summary>
    
      <category term="环境搭建" scheme="https://www.leolan.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="RabbitMQ" scheme="https://www.leolan.top/tags/RabbitMQ/"/>
    
  </entry>
  
  <entry>
    <title>Redis</title>
    <link href="https://www.leolan.top/posts/27273/"/>
    <id>https://www.leolan.top/posts/27273/</id>
    <published>2017-02-27T08:51:58.000Z</published>
    <updated>2017-02-27T09:37:48.108Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Centos"><a href="#Centos" class="headerlink" title="Centos"></a>Centos</h2><p>要有基本编译环境。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">yum install <span class="keyword">tcl</span> gcc -<span class="keyword">y</span></div><div class="line"></div><div class="line">wget http://download.redis.io/releases/redis-<span class="number">2.8</span>.<span class="number">9</span>.tar.gz</div><div class="line">tar xzf redis-<span class="number">2.8</span>.<span class="number">9</span>.tar.gz</div><div class="line"><span class="keyword">cd</span> redis-<span class="number">2.8</span>.<span class="number">9</span></div><div class="line"><span class="keyword">make</span></div><div class="line"><span class="keyword">make</span> test</div><div class="line"><span class="keyword">make</span> install</div></pre></td></tr></table></figure></p>
<p>测试通过后安装，安装后会自动把redis-server,redis-cli,redis-benchmark,redis-check-aof,redis-check-dump复制到<strong>/usr/local/bin</strong>目录下。</p>
<p>编辑redis.conf文件,<code>vim redis.conf</code>修改daemonize no改成yes。</p>
<p>复制redis.conf到/etc目录下<code>cp redis.conf /etc</code></p>
<p>编辑服务管理文件<code>vim /etc/init.d/redis</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">###########################</span></div><div class="line"><span class="comment">#chkconfig: 2345 10 90</span></div><div class="line"><span class="comment">#description: Start and Stop redis</span></div><div class="line">PATH=/usr/<span class="built_in">local</span>/bin:/sbin:/usr/bin:/bin</div><div class="line">   </div><div class="line">REDISPORT=6379</div><div class="line">EXEC=/usr/<span class="built_in">local</span>/bin/redis-server</div><div class="line">REDIS_CLI=/usr/<span class="built_in">local</span>/bin/redis-cli</div><div class="line">   </div><div class="line">PIDFILE=/var/run/redis.pid</div><div class="line">CONF=<span class="string">"/etc/redis.conf"</span></div><div class="line">   </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">    start)</div><div class="line">        <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$PIDFILE</span> ]</div><div class="line">        <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"<span class="variable">$PIDFILE</span> exists, process is already running or crashed"</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Starting Redis server..."</span></div><div class="line">                <span class="variable">$EXEC</span> <span class="variable">$CONF</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">        <span class="keyword">if</span> [ <span class="string">"$?"</span>=<span class="string">"0"</span> ] </div><div class="line">        <span class="keyword">then</span></div><div class="line">              <span class="built_in">echo</span> <span class="string">"Redis is running..."</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">        ;;</div><div class="line">    stop)</div><div class="line">        <span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="variable">$PIDFILE</span> ]</div><div class="line">        <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"<span class="variable">$PIDFILE</span> does not exist, process is not running"</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">                PID=$(cat <span class="variable">$PIDFILE</span>)</div><div class="line">                <span class="built_in">echo</span> <span class="string">"Stopping ..."</span></div><div class="line">                <span class="variable">$REDIS_CLI</span> -p <span class="variable">$REDISPORT</span> SHUTDOWN</div><div class="line">                <span class="keyword">while</span> [ -x <span class="variable">$&#123;PIDFILE&#125;</span> ]</div><div class="line">               <span class="keyword">do</span></div><div class="line">                    <span class="built_in">echo</span> <span class="string">"Waiting for Redis to shutdown ..."</span></div><div class="line">                    sleep 1</div><div class="line">                <span class="keyword">done</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Redis stopped"</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">        ;;</div><div class="line">   restart|force-reload)</div><div class="line">        <span class="variable">$&#123;0&#125;</span> stop</div><div class="line">        <span class="variable">$&#123;0&#125;</span> start</div><div class="line">        ;;</div><div class="line">  *)</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Usage: /etc/init.d/redis &#123;start|stop|restart|force-reload&#125;"</span> &gt;&amp;2</div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">esac</span></div><div class="line"><span class="comment">##############################</span></div></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#修改权限</span></div><div class="line">chmod +x /etc/init.d/redis</div><div class="line"></div><div class="line"><span class="meta">#设置开机自动启动服务</span></div><div class="line">chkconfig redis on</div><div class="line"> </div><div class="line"><span class="meta">#启动服务：</span></div><div class="line">service redis start</div><div class="line"></div><div class="line"><span class="meta">#停止服务：</span></div><div class="line">service redis stop</div><div class="line"></div><div class="line"><span class="meta">#检查Redis是否正在工作</span></div><div class="line">redis-cli</div></pre></td></tr></table></figure>
<p>配置防火墙打开对应的端口：<code>vi /etc/sysconfig/iptables</code><br><code>-A INPUT -m state --state NEW -m tcp -p tcp --dport 6379 -j ACCEPT</code></p>
<p>重启防火墙<code>service iptables restart</code></p>
<hr>
<h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">apt-get <span class="keyword">update</span> </div><div class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> redis-<span class="keyword">server</span></div><div class="line"></div><div class="line">#检查Redis是否正在工作</div><div class="line">redis-cli</div></pre></td></tr></table></figure>
<hr>
<h1 id="Redis常用命令"><a href="#Redis常用命令" class="headerlink" title="Redis常用命令"></a>Redis常用命令</h1><p>参考：<br><a href="http://www.centoscn.com/image-text/config/2015/0728/5928.html" target="_blank" rel="external">http://www.centoscn.com/image-text/config/2015/0728/5928.html</a><br><a href="http://doc.redisfans.com/" target="_blank" rel="external">http://doc.redisfans.com/</a></p>
<hr>
<h1 id="Redis快速入门"><a href="#Redis快速入门" class="headerlink" title="Redis快速入门"></a>Redis快速入门</h1><p><a href="http://www.yiibai.com/redis/redis_quick_guide.html" target="_blank" rel="external">http://www.yiibai.com/redis/redis_quick_guide.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerl
    
    </summary>
    
      <category term="环境搭建" scheme="https://www.leolan.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="Redis" scheme="https://www.leolan.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Nginx</title>
    <link href="https://www.leolan.top/posts/9355/"/>
    <id>https://www.leolan.top/posts/9355/</id>
    <published>2017-02-25T10:15:37.000Z</published>
    <updated>2017-03-09T07:39:18.177Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h1><p>参考：<a href="https://wizardforcel.gitbooks.io/nginx-doc/content/Text/1.3_install.html" target="_blank" rel="external">https://wizardforcel.gitbooks.io/nginx-doc/content/Text/1.3_install.html</a><br><a href="https://wizardforcel.gitbooks.io/nginx-doc/content/Text/6.html" target="_blank" rel="external">https://wizardforcel.gitbooks.io/nginx-doc/content/Text/6.html</a></p>
<hr>
<h1 id="Nginx负载均衡"><a href="#Nginx负载均衡" class="headerlink" title="Nginx负载均衡"></a>Nginx负载均衡</h1><p>Nginx负载均衡适用于小规模的集群，负载均衡的本质是所有客户端都从服务器A入口，最后被分流到B,C,D,E…服务器，出口也是经过服务器A，这样在同一个机房内只需要一个公网IP即可实现分流，但服务器A的压力及带宽是关键部分。（对于大集群可以用DNS分流）</p>
<hr>
<h1 id="Nginx反向代理"><a href="#Nginx反向代理" class="headerlink" title="Nginx反向代理"></a>Nginx反向代理</h1><p>Nginx反向代理是所有客户端都从服务器A入口，最后被分流到B,C,D,E…服务器，之后的连接是和各自的B,C,D,E…服务器的连接，这样每台服务器都要有公网IP可跨机房，也减少了服务器A的压力。</p>
<hr>
<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><h2 id="upstream模块常用参数"><a href="#upstream模块常用参数" class="headerlink" title="upstream模块常用参数"></a>upstream模块常用参数</h2><p>1、<strong>轮询（默认）</strong><br>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。<br>2、<strong>weight</strong><br>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。<br>3、<strong>ip_hash</strong><br>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。<br>4、<strong>fair（第三方）</strong><br>按后端服务器的响应时间来分配请求，响应时间短的优先分配。<br>5、<strong>url_hash（第三方）</strong><br>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>server 192.168.0.100:80</td>
<td>负载均衡后端RealServer的IP或者域名，端口不写的话默认为80。高并发场景用域名，再通过DNS进行负载均衡</td>
</tr>
<tr>
<td>weight=5</td>
<td>权重，默认为1，权重越大接收的请求越多</td>
</tr>
<tr>
<td>max_fails=2</td>
<td>失败超过指定次数会暂停或请求转往其它服务器（最大尝试的失败次数），默认为1,0表示禁止失败尝试</td>
</tr>
<tr>
<td>fail_timeout=10s</td>
<td>失败超过指定次数后暂停时间，失败超时时间，默认是10秒，通常3s左右比较合适</td>
</tr>
<tr>
<td>backup</td>
<td>热备配置，前段RealServer出现问题后会自动上线backup服务器，其它服务器超时或down时才会请求backup服务器</td>
</tr>
<tr>
<td>down</td>
<td>标志服务器不可用（负载过重或者不参与负载），这个参数通常配合IP_HASH使用</td>
</tr>
</tbody>
</table>
<p>例：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">http &#123;    </div><div class="line">    </div><div class="line">    upstream  www.test1.com &#123;</div><div class="line">          ip_hash<span class="comment">;</span></div><div class="line">          server   <span class="number">172.16</span><span class="meta">.125</span><span class="meta">.76</span>:<span class="number">8066</span> weight=<span class="number">10</span><span class="comment">;</span></div><div class="line">          server   <span class="number">172.16</span><span class="meta">.125</span><span class="meta">.76</span>:<span class="number">8077</span> <span class="meta">down</span><span class="comment">;</span></div><div class="line">          server   <span class="number">172.16</span><span class="meta">.0</span><span class="meta">.18</span>:<span class="number">8066</span> max_fails=<span class="number">3</span> fail_timeout=30s<span class="comment">;</span></div><div class="line">          server   <span class="number">172.16</span><span class="meta">.0</span><span class="meta">.18</span>:<span class="number">8077</span> backup<span class="comment">;</span></div><div class="line">     &#125;</div><div class="line">      </div><div class="line">     upstream  www.test2.com &#123;</div><div class="line">          server   <span class="number">172.16</span><span class="meta">.0</span><span class="meta">.21</span>:<span class="number">8066</span><span class="comment">;</span></div><div class="line">          server   <span class="number">192.168</span><span class="meta">.76</span><span class="meta">.98</span>:<span class="number">8066</span><span class="comment">;         </span></div><div class="line">     &#125;</div><div class="line"></div><div class="line"></div><div class="line">     server &#123;</div><div class="line">        listen       <span class="number">80</span><span class="comment">;</span></div><div class="line">        server_name  www.test1.com<span class="comment">;        </span></div><div class="line">       </div><div class="line">        location /&#123;</div><div class="line">           proxy_pass        http://www.test1.com<span class="comment">;</span></div><div class="line">           proxy_set_header   Host             $host<span class="comment">;</span></div><div class="line">           proxy_set_header   X-Real-<span class="built_in">IP</span>        $remote_addr<span class="comment">;</span></div><div class="line">           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for<span class="comment">;</span></div><div class="line">        &#125;      </div><div class="line">     &#125;  </div><div class="line">     </div><div class="line">     server &#123;</div><div class="line">        listen       <span class="number">80</span><span class="comment">;</span></div><div class="line">        server_name  www.test2.com<span class="comment">;        </span></div><div class="line">       </div><div class="line">        location /&#123;</div><div class="line">           proxy_pass        http://www.test2.com<span class="comment">;</span></div><div class="line">           proxy_set_header   Host             $host<span class="comment">;</span></div><div class="line">           proxy_set_header   X-Real-<span class="built_in">IP</span>        $remote_addr<span class="comment">;</span></div><div class="line">           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for<span class="comment">;</span></div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="配置部分"><a href="#配置部分" class="headerlink" title="配置部分"></a>配置部分</h1><p>一般Nginx的配置文件会分成两部分，这样方便管理。<br>全局配置：<strong>/etc/nginx/nginx.conf</strong><br>Server配置：<strong>/etc/nginx/conf.d/default.conf</strong></p>
<p>简单的Nginx负载均衡和反向代理：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">upstream</span> linuxleolan&#123;</div><div class="line"><span class="comment">#server后用ip,不要用localhost和127.0.0.1，这两个地址测试不了。</span></div><div class="line">                <span class="attribute">server</span> <span class="number">123.207.92.209</span>;</div><div class="line">                <span class="attribute">server</span> <span class="number">123.207.92.245</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  localhost;           <span class="comment">#localhost或www.xxx.com(域名指向此服务器)</span></div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">proxy_pass</span> http://linuxidcleolan;   <span class="comment">#调用upstream里设定的变量</span></div><div class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;          <span class="comment">#缓存开关</span></div><div class="line">        </div><div class="line">        <span class="comment">#以下三行是获得前端IP，反向代理设置。</span></div><div class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>参考资料：<br><a href="http://www.ilanni.com/?p=7631" target="_blank" rel="external">http://www.ilanni.com/?p=7631</a><br><a href="http://www.cnblogs.com/jacktang/p/3669115.html" target="_blank" rel="external">http://www.cnblogs.com/jacktang/p/3669115.html</a><br><a href="http://www.linuxidc.com/Linux/2016-04/130350.htm" target="_blank" rel="external">http://www.linuxidc.com/Linux/2016-04/130350.htm</a><br><a href="http://www.cnblogs.com/mecity/archive/2011/06/20/2085529.html" target="_blank" rel="external">http://www.cnblogs.com/mecity/archive/2011/06/20/2085529.html</a><br><a href="https://wizardforcel.gitbooks.io/nginx-doc/content/Text/7.4_loadbalance.html" target="_blank" rel="external">https://wizardforcel.gitbooks.io/nginx-doc/content/Text/7.4_loadbalance.html</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;Nginx安装&quot;&gt;&lt;a href=&quot;#Nginx安装&quot; clas
    
    </summary>
    
      <category term="web服务器" scheme="https://www.leolan.top/categories/web%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="Nginx" scheme="https://www.leolan.top/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Excel表格合并</title>
    <link href="https://www.leolan.top/posts/48831/"/>
    <id>https://www.leolan.top/posts/48831/</id>
    <published>2017-01-13T01:52:27.000Z</published>
    <updated>2017-02-27T08:47:33.049Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="（先看我）宏处理步骤"><a href="#（先看我）宏处理步骤" class="headerlink" title="（先看我）宏处理步骤"></a>（先看我）宏处理步骤</h1><p>把多个要合并的excel表都放在同一个文件夹里面，并在这个文件夹里面新建一个excel。</p>
<p>打开新建的excel表，并右键单击sheet1，找到“查看代码”，单击进去。进去之后就看到了宏计算界面。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170113/103623152.png" alt="mark"></p>
<p>然后我们把下面这些宏计算的代码复制进去，然后找到工具栏上面的<strong>“运行”</strong>下的<strong>“运行子过程/用户窗体”</strong>就可以执行代码了。</p>
<hr>
<h2 id="合并多个表格（表格内的Sheet会自动拆分新建sheet）到1个表格的多个Sheet中"><a href="#合并多个表格（表格内的Sheet会自动拆分新建sheet）到1个表格的多个Sheet中" class="headerlink" title="合并多个表格（表格内的Sheet会自动拆分新建sheet）到1个表格的多个Sheet中"></a>合并多个表格（表格内的Sheet会自动拆分新建sheet）到1个表格的多个Sheet中</h2><p>Excel会复制工作表的名称并自动根据检测结果附加(2)、(3)等数字编号。工作簿中与其他工作表相关的任何公式也会自动更新的新的名称。</p>
<p>宏合并代码：<br><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Sub</span> CombineWorkbooks()</div><div class="line">    <span class="keyword">Dim</span> FilesToOpen</div><div class="line">    <span class="keyword">Dim</span> x As Integer</div><div class="line"></div><div class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> ErrHandler</div><div class="line">    Application.ScreenUpdating = <span class="literal">False</span></div><div class="line"></div><div class="line">    FilesToOpen = Application.GetOpenFilename(FileFilter: = <span class="string">"MicroSoft Excel文件(*.xls),*.xls"</span>,MultiSelect: = <span class="literal">True</span>,Title: = <span class="string">"要合并的文件"</span>)</div><div class="line"></div><div class="line">    <span class="keyword">If</span> <span class="built_in">TypeName</span>(FilesToOpen) = <span class="string">"Boolean"</span> <span class="keyword">then</span></div><div class="line">        <span class="built_in">MsgBox</span> <span class="string">"没有选中文件"</span></div><div class="line">        <span class="keyword">Goto</span> ExitHandler</div><div class="line">    <span class="keyword">end</span> <span class="keyword">if</span></div><div class="line"></div><div class="line">    x = <span class="number">1</span></div><div class="line">    <span class="keyword">While</span> x &lt;= <span class="built_in">UBound</span>(filestoopen)</div><div class="line">        Workbooks.Open fileName: = filestoopen(x)</div><div class="line">        Sheets().Move After: = ThisWorkbook.Sheets (ThisWorkbook.Sheets.Count)</div><div class="line">        x = x + <span class="number">1</span></div><div class="line">    <span class="keyword">Wend</span></div><div class="line">ExitHandler:</div><div class="line">    Application.ScreenUpdating = <span class="literal">True</span></div><div class="line">    <span class="keyword">Exit</span> <span class="keyword">Sub</span></div><div class="line">ErrHandler:</div><div class="line">    <span class="built_in">MsgBox</span> <span class="built_in">Err</span>.Description</div><div class="line">    <span class="keyword">Resume</span> ExitHandler</div><div class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></div></pre></td></tr></table></figure></p>
<p>运行后弹出选择表格的窗口，选个要合并的表格就能合并了，再删除第一个空的Sheet表，保存选择“是”（不启用宏，不保存宏信息）</p>
<hr>
<h2 id="合并多个表格（表格内的多个Sheet也会合并在同一个Sheet中）到1个表格的1个Sheet中"><a href="#合并多个表格（表格内的多个Sheet也会合并在同一个Sheet中）到1个表格的1个Sheet中" class="headerlink" title="合并多个表格（表格内的多个Sheet也会合并在同一个Sheet中）到1个表格的1个Sheet中"></a>合并多个表格（表格内的多个Sheet也会合并在同一个Sheet中）到1个表格的1个Sheet中</h2><p>宏合并代码：<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Sub</span> 合并当前目录下所有工作簿的全部工作表()</div><div class="line"><span class="keyword">Dim</span> MyPath, MyName, AWbName</div><div class="line"><span class="keyword">Dim</span> Wb <span class="keyword">As</span> Workbook, WbN <span class="keyword">As</span> <span class="built_in">String</span></div><div class="line"><span class="keyword">Dim</span> G <span class="keyword">As</span> <span class="built_in">Long</span></div><div class="line"><span class="keyword">Dim</span> Num <span class="keyword">As</span> <span class="built_in">Long</span></div><div class="line"><span class="keyword">Dim</span> BOX <span class="keyword">As</span> <span class="built_in">String</span></div><div class="line">Application.ScreenUpdating = <span class="literal">False</span></div><div class="line">MyPath = ActiveWorkbook.Path</div><div class="line">MyName = Dir(MyPath &amp; <span class="string">"\"</span> &amp; <span class="string">"*.xls"</span>)</div><div class="line">AWbName = ActiveWorkbook.Name</div><div class="line">Num = <span class="number">0</span></div><div class="line"><span class="keyword">Do</span> <span class="keyword">While</span> MyName &lt;&gt; <span class="string">""</span></div><div class="line"><span class="keyword">If</span> MyName &lt;&gt; AWbName <span class="keyword">Then</span></div><div class="line"><span class="keyword">Set</span> Wb = Workbooks.Open(MyPath &amp; <span class="string">"\"</span> &amp; MyName)</div><div class="line">Num = Num + <span class="number">1</span></div><div class="line"><span class="keyword">With</span> Workbooks(<span class="number">1</span>).ActiveSheet</div><div class="line">.Cells(.Range(<span class="string">"B65536"</span>).<span class="keyword">End</span>(xlUp).Row + <span class="number">2</span>, <span class="number">1</span>) = Left(MyName, Len(MyName) - <span class="number">4</span>)</div><div class="line"><span class="keyword">For</span> G = <span class="number">1</span> <span class="keyword">To</span> Sheets.Count</div><div class="line">Wb.Sheets(G).UsedRange.Copy .Cells(.Range(<span class="string">"B65536"</span>).<span class="keyword">End</span>(xlUp).Row + <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"><span class="keyword">Next</span></div><div class="line">WbN = WbN &amp; Chr(<span class="number">13</span>) &amp; Wb.Name</div><div class="line">Wb.Close <span class="literal">False</span></div><div class="line"><span class="keyword">End</span> <span class="keyword">With</span></div><div class="line"><span class="keyword">End</span> <span class="keyword">If</span></div><div class="line">MyName = Dir</div><div class="line"><span class="keyword">Loop</span></div><div class="line">Range(<span class="string">"B1"</span>).<span class="keyword">Select</span></div><div class="line">Application.ScreenUpdating = <span class="literal">True</span></div><div class="line">MsgBox <span class="string">"共合并了"</span> &amp; Num &amp; <span class="string">"个工作薄下的全部工作表。如下："</span> &amp; Chr(<span class="number">13</span>) &amp; WbN, vbInformation, <span class="string">"提示"</span></div><div class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="合并单个表格内的多个Sheet到本表格的1个新Sheet中"><a href="#合并单个表格内的多个Sheet到本表格的1个新Sheet中" class="headerlink" title="合并单个表格内的多个Sheet到本表格的1个新Sheet中"></a>合并单个表格内的多个Sheet到本表格的1个新Sheet中</h2><p>宏合并代码：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Sub 合并当前工作簿下的所有工作表()</div><div class="line">Application.ScreenUpdating = <span class="keyword">False</span></div><div class="line"><span class="keyword">For</span> j = <span class="number">1</span> To Sheets.<span class="keyword">Count</span></div><div class="line">   <span class="keyword">If</span> Sheets(j).Name &lt;&gt; ActiveSheet.Name Then</div><div class="line">       X = <span class="keyword">Range</span>(<span class="string">"A65536"</span>).<span class="keyword">End</span>(xlUp).<span class="keyword">Row</span> + <span class="number">1</span></div><div class="line">       Sheets(j).UsedRange.Copy <span class="keyword">Cells</span>(X, <span class="number">1</span>)</div><div class="line">   <span class="keyword">End</span> <span class="keyword">If</span></div><div class="line"><span class="keyword">Next</span></div><div class="line"><span class="keyword">Range</span>(<span class="string">"B1"</span>).<span class="keyword">Select</span></div><div class="line">Application.ScreenUpdating = <span class="keyword">True</span></div><div class="line">MsgBox <span class="string">"当前工作簿下的全部工作表已经合并完毕！"</span>, vbInformation, <span class="string">"提示"</span></div><div class="line"><span class="keyword">End</span> Sub</div></pre></td></tr></table></figure></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;（先看我）宏处理步骤&quot;&gt;&lt;a href=&quot;#（先看我）宏处理步骤
    
    </summary>
    
      <category term="办公软件" scheme="https://www.leolan.top/categories/%E5%8A%9E%E5%85%AC%E8%BD%AF%E4%BB%B6/"/>
    
    
      <category term="Excel表格合并" scheme="https://www.leolan.top/tags/Excel%E8%A1%A8%E6%A0%BC%E5%90%88%E5%B9%B6/"/>
    
  </entry>
  
  <entry>
    <title>fail2ban 防爆力破解</title>
    <link href="https://www.leolan.top/posts/32284/"/>
    <id>https://www.leolan.top/posts/32284/</id>
    <published>2017-01-12T06:48:46.000Z</published>
    <updated>2017-02-27T08:47:33.065Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>fail2ban 是 Linux 上的一个著名的入侵保护的开源框架，它会监控多个系统的日志文件（例如：/var/log/auth.log 或者 /var/log/secure）并根据检测到的任何可疑的行为自动触发不同的防御动作。事实上，fail2ban 在防御对SSH服务器的暴力密码破解上非常有用。同时也能用于ftp防暴力破解。</p>
<p>官网：<a href="http://www.fail2ban.org" target="_blank" rel="external">http://www.fail2ban.org</a></p>
<hr>
<h1 id="安装Fail2ban"><a href="#安装Fail2ban" class="headerlink" title="安装Fail2ban"></a>安装Fail2ban</h1><p>CentOS 或 RHEL上安装fail2ban,首先设置<a href="https://linux.cn/article-2324-1.html" target="_blank" rel="external">EPEL</a>仓库，然后运行以下命令。<br><code>sudo yum install fail2ban</code></p>
<p>在ubuntu，Debian 或 Linux Mint上安装fail2ban：<br><code>sudo apt-get install fail2ban</code></p>
<hr>
<h1 id="配置Fail2ban"><a href="#配置Fail2ban" class="headerlink" title="配置Fail2ban"></a>配置Fail2ban</h1><p>需要编辑其配置文件 /etc/fail2ban/jail.conf。 在配置文件的“[DEFAULT]”区，你可以在此定义所有受监控的服务的默认参数，另外在特定服务的配置部分，你可以为每个服务（例如SSH，Apache等）设置特定的配置来覆盖默认的参数配置。</p>
<p>在针对服务的监狱区（在[DEFAULT]区后面的地方），你需要定义一个[ssh-iptables]区，这里用来定义SSH相关的监狱配置。真正的禁止IP地址的操作是通过iptables完成的。</p>
<p>下面是一个包含“ssh-iptables”监狱配置的/etc/fail2ban/jail.conf的文件样例。当然根据你的需要，你也可以指定其他的应用监狱。<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/fail2ban/jail.<span class="keyword">local</span></div></pre></td></tr></table></figure></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="section">[DEFAULT]</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="attr">bantime</span> = <span class="number">86400</span>   # 客户端主机被禁止的时长（秒）</div><div class="line"><span class="attr">maxretry</span> = <span class="number">5</span>      # 客户端主机被禁止前允许失败的次数 </div><div class="line"><span class="attr">findtime</span> = <span class="number">600</span>    # 查找失败次数的时长（秒）</div><div class="line"><span class="attr">ignoreip</span> = <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">172.31</span>.<span class="number">0.0</span>/<span class="number">24</span> <span class="number">10.10</span>.<span class="number">0.0</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span></div><div class="line"><span class="comment"># 以空格分隔的列表，可以是 IP 地址、CIDR 前缀或者 DNS 主机名</span></div><div class="line"><span class="comment"># 用于指定哪些地址可以忽略 fail2ban 防御</span></div><div class="line"></div><div class="line"><span class="attr">mta</span> = sendmail    # 邮件通知</div><div class="line"><span class="section"></span></div><div class="line">[ssh-iptables]</div><div class="line"><span class="attr">enabled</span> = <span class="literal">true</span></div><div class="line"><span class="attr">filter</span> = sshd</div><div class="line"><span class="attr">action</span> = iptables[name=SSH, port=ssh, protocol=tcp]</div><div class="line"><span class="attr">sendmail-whois[name</span>=SSH, dest=your@email.com, sender=fail2ban@email.com]</div><div class="line"></div><div class="line"><span class="attr">logpath</span> = /var/log/auth.log   # Debian 系的发行版 </div><div class="line"><span class="attr">logpath</span> = /var/log/secure     # Red Hat 系的发行版</div><div class="line"><span class="attr">maxretry</span> = <span class="number">3</span>                  # ssh 服务的最大尝试次数</div></pre></td></tr></table></figure>
<p>根据上述配置，fail2ban会自动禁止在最近10分钟内有超过3次访问尝试失败的任意IP地址。一旦被禁，这个IP地址将会在24小时内一直被禁止访问 SSH 服务。这个事件也会通过sendemail发送邮件通知。</p>
<p>一旦配置文件准备就绪，按照以下方式重启fail2ban服务。</p>
<p>在 Debian, Ubuntu 或 CentOS/RHEL 6:<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service fail2ban <span class="built_in">restart</span></div></pre></td></tr></table></figure></p>
<p>在 Fedora 或 CentOS/RHEL 7:<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl <span class="built_in">restart</span> fail2ban</div></pre></td></tr></table></figure></p>
<p>验证fail2ban成功运行，使用参数’ping’来运行fail2ban-client 命令。 如果fail2ban服务正常运行，你可以看到“pong（嘭）”作为响应。<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fail2ban-client ping</div><div class="line">提示</div><div class="line"><span class="built_in">Server</span> replied: pong</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="测试-fail2ban"><a href="#测试-fail2ban" class="headerlink" title="测试 fail2ban"></a>测试 fail2ban</h1><p>测试fail2ban是否能正常工作，尝试通过使用错误的密码来用SSH连接到服务器模拟一个暴力破解攻击。与此同时，监控 /var/log/fail2ban.log，该文件记录在fail2ban中发生的任何敏感事件。<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo tail -f /var/<span class="built_in">log</span>/fail2ban.<span class="built_in">log</span></div><div class="line"><span class="comment">#具体日志的位置要看配置文件定义</span></div></pre></td></tr></table></figure></p>
<hr>
<h1 id="检查状态、解禁IP地址"><a href="#检查状态、解禁IP地址" class="headerlink" title="检查状态、解禁IP地址"></a>检查状态、解禁IP地址</h1><p>由于fail2ban的“ssh-iptables”监狱使用iptables来阻塞问题IP地址，你可以通过以下方式来检测当前iptables来验证禁止规则。<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables <span class="comment">--list -n</span></div></pre></td></tr></table></figure></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot <span class="keyword">opt</span> <span class="keyword">source</span>               destination</div><div class="line">fail2ban-SSH  tcp  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           tcp <span class="keyword">dp</span><span class="variable">t:22</span></div><div class="line"> </div><div class="line">Chain FORWARD (policy ACCEPT)</div><div class="line">target     prot <span class="keyword">opt</span> <span class="keyword">source</span>               destination</div><div class="line"> </div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot <span class="keyword">opt</span> <span class="keyword">source</span>               destination</div><div class="line"> </div><div class="line">Chain fail2ban-SSH (<span class="number">1</span> references)</div><div class="line">target     prot <span class="keyword">opt</span> <span class="keyword">source</span>               destination</div><div class="line">DROP       <span class="keyword">all</span>  --  <span class="number">192.168</span>.<span class="number">1.8</span>          <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span></div><div class="line">RETURN     <span class="keyword">all</span>  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span></div></pre></td></tr></table></figure>
<p>想要<strong>从fail2ban中解锁某个IP地址</strong>，你可以使用iptables命令：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">iptables</span> <span class="selector-tag">-D</span> <span class="selector-tag">fail2ban-SSH</span> <span class="selector-tag">-s</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.8</span> <span class="selector-tag">-j</span> <span class="selector-tag">DROP</span></div></pre></td></tr></table></figure></p>
<p>可以使用上述的iptables命令手动地检验和管理fail2ban的IP阻塞列表，但实际上有一个适当的方法就是使用fail2ban-client命令行工具。这个命令不仅允许你对”ssh-iptables”监狱进行管理，同时也是一个标准的命令行接口，可以管理其他类型的fail2ban监狱。</p>
<p>为了<strong>检验fail2ban状态</strong>（会显示出当前活动的监狱列表）：<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fail2ban-<span class="keyword">client</span> status</div></pre></td></tr></table></figure></p>
<p>为了<strong>检验一个特定监狱的状态</strong>（例如ssh-iptables):<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fail2ban-<span class="keyword">client</span> status ssh-iptables</div></pre></td></tr></table></figure></p>
<p><strong>解锁特定的IP地址</strong>：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">fail2ban-client</span> <span class="selector-tag">set</span> <span class="selector-tag">ssh-iptables</span> <span class="selector-tag">unbanip</span> 192<span class="selector-class">.168</span><span class="selector-class">.xxx</span><span class="selector-class">.xxx</span></div></pre></td></tr></table></figure></p>
<p><strong>注意</strong>:如果你停止了Fail2ban 服务，那么所有的IP地址都会被解锁。当你重启 Fail2ban，它会从/etc/log/secure(或 /var/log/auth.log)中找到异常的IP地址列表，如果这些异常地址的发生时间仍然在禁止时间内，那么Fail2ban会重新将这些IP地址禁止。</p>
<hr>
<h1 id="Fail2ban-自动启动"><a href="#Fail2ban-自动启动" class="headerlink" title="Fail2ban 自动启动"></a>Fail2ban 自动启动</h1><p>成功地测试了fail2ban之后，最后一个步骤就是在你的服务器上让其在开机时自动启动。在基于Debian的发行版中，fail2ban已经默认让自动启动生效。在基于Red-Hat的发行版中，按照下面的方式让自动启动生效。</p>
<p>在 CentOS/RHEL 6中:<code>chkconfig fail2ban on</code><br>在 Fedora 或 CentOS/RHEL 7:<code>systemctl enable fail2ban</code></p>
<hr>
<p>原文：<a href="https://linux.cn/article-5067-1.html" target="_blank" rel="external">https://linux.cn/article-5067-1.html</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;fail2ban 是 Linux 上的一个著名的入侵保护的开源框架，它会监
    
    </summary>
    
      <category term="系统管理" scheme="https://www.leolan.top/categories/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="fail2ban 防爆力破解" scheme="https://www.leolan.top/tags/fail2ban-%E9%98%B2%E7%88%86%E5%8A%9B%E7%A0%B4%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>RAID</title>
    <link href="https://www.leolan.top/posts/3959/"/>
    <id>https://www.leolan.top/posts/3959/</id>
    <published>2017-01-06T07:21:17.000Z</published>
    <updated>2017-02-27T08:47:33.064Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="RAID简介"><a href="#RAID简介" class="headerlink" title="RAID简介"></a>RAID简介</h1><p>RAID 的意思是廉价磁盘冗余阵列（Redundant Array of Inexpensive Disks），但现在它被称为独立磁盘冗余阵列（Redundant Array of Independent Drives）。早先一个容量很小的磁盘都是非常昂贵的，但是现在我们可以很便宜的买到一个更大的磁盘。Raid 是一系列放在一起，成为一个逻辑卷的磁盘集合。</p>
<p>RAID 包含一组或者一个集合甚至一个阵列。使用一组磁盘结合驱动器组成 RAID 阵列或 RAID 集。将至少两个磁盘连接到一个 RAID 控制器，而成为一个逻辑卷，也可以将多个驱动器放在一个组中。一组磁盘只能使用一个 RAID 级别。使用 RAID 可以提高服务器的性能。不同 RAID 的级别，性能会有所不同。它通过容错和高可用性来保存我们的数据。</p>
<p><strong>软件 RAID 和硬件 RAID</strong></p>
<p>软件 RAID 的性能较低，因为其使用主机的资源。 需要加载 RAID 软件以从软件 RAID 卷中读取数据。在加载 RAID 软件前，操作系统需要引导起来才能加载 RAID 软件。在软件 RAID 中无需物理硬件。零成本投资。</p>
<p>硬件 RAID 的性能较高。他们采用 PCI Express 卡物理地提供有专用的 RAID 控制器。它不会使用主机资源。他们有 NVRAM 用于缓存的读取和写入。缓存用于 RAID 重建时，即使出现电源故障，它会使用后备的电池电源保持缓存。对于大规模使用是非常昂贵的投资。</p>
<p>硬件 RAID 卡如下所示：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/162145611.png" alt="mark"></p>
<hr>
<h1 id="RAID级别"><a href="#RAID级别" class="headerlink" title="RAID级别"></a>RAID级别</h1><h2 id="重要的-RAID-概念"><a href="#重要的-RAID-概念" class="headerlink" title="重要的 RAID 概念"></a>重要的 RAID 概念</h2><ul>
<li><strong>校验方式</strong>：用在 RAID 重建中从校验所保存的信息中重新生成丢失的内容。 RAID 5，RAID 6 基于校验。</li>
<li><strong>条带化</strong>：是将切片数据随机存储到多个磁盘。它不会在单个磁盘中保存完整的数据。如果我们使用2个磁盘，则每个磁盘存储我们的一半数据。</li>
<li><strong>镜像</strong>：被用于 RAID 1 和 RAID 10。镜像会自动备份数据。在 RAID 1 中，它会保存相同的内容到其他盘上。</li>
<li><strong>热备份</strong>：只是我们的服务器上的一个备用驱动器，它可以自动更换发生故障的驱动器。在我们的阵列中，如果任何一个驱动器损坏，热备份驱动器会自动用于重建 RAID。</li>
<li><strong>块</strong>：是 RAID 控制器每次读写数据时的最小单位，最小 4KB。通过定义块大小，我们可以增加 I/O 性能。</li>
</ul>
<p>RAID有不同的级别。在这里列出在真实环境下的使用最多的 RAID 级别。其他级别的阵列参考：<a href="http://baike.baidu.com/link?url=-Oj6p9Kk0y5M7yNzaGrxRIECftLqNj5MqUg6qOZ4krc0RqxJhEZu61E1LCgjJORlpf6oV8qbnMQM4HIvL4MLLz80J-nCnAPse7xJI3wvdPuRHy5Gm9RTZ4CXpoKRl7AjSjU-ie9p4dgBF9ZpFdSB2f0-n9YDpFMlX2kzNntXViO" target="_blank" rel="external">磁盘阵列</a></p>
<p>RAID0 = 条带化　　　<strong>提高读写性能</strong><br>RAID1 = 镜像　　　　<strong>提高读写性能、冗余性</strong><br>RAID5 = 单磁盘分布式奇偶校验　　　<strong>提高读写性能、冗余性(允许1块硬盘发生故障)</strong><br>RAID6 = 双磁盘分布式奇偶校验　　　<strong>提高读写性能、冗余性(运行2块硬盘发生故障)</strong><br>RAID10 = 镜像 + 条带。（嵌套RAID）<br><strong>RAID 在大多数 Linux 发行版上使用名为 mdadm 的软件包进行管理。</strong></p>
<hr>
<h2 id="RAID-0-条带化"><a href="#RAID-0-条带化" class="headerlink" title="RAID 0  条带化"></a>RAID 0  条带化</h2><p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/163022108.png" alt="mark"></p>
<ul>
<li>高性能。</li>
<li>RAID 0 中容量零损失。</li>
<li>零容错。</li>
<li>写和读有很高的性能。</li>
<li><strong>最少两块硬盘</strong></li>
</ul>
<p>条带化有很好的性能。在 RAID 0（条带化）中数据将使用切片的方式被写入到磁盘。一半的内容放在一个磁盘上，另一半内容将被写入到另一个磁盘。</p>
<p>假设我们有2个磁盘驱动器，每次写入数据都是分两半写入两个磁盘的注：实际上不可能按字节切片，是按数据块切片的。</p>
<p>在这种情况下，如果驱动器中的任何一个发生故障，就会丢失数据，因为一个盘中只有一半的数据，不能用于重建 RAID。不过，当比较写入速度和性能时，RAID 0 是非常好的。创建 RAID 0（条带化）至少需要2个磁盘。如果你的数据是非常宝贵的，那么不要使用此 RAID 级别。</p>
<hr>
<h2 id="RAID-1-镜像化"><a href="#RAID-1-镜像化" class="headerlink" title="RAID 1  镜像化"></a>RAID 1  镜像化</h2><p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/163031427.png" alt="mark"></p>
<ul>
<li>良好的性能。</li>
<li>总容量丢失一半可用空间。</li>
<li>完全容错。</li>
<li>重建会更快。</li>
<li>写性能变慢。</li>
<li>读性能变好。</li>
<li>能用于操作系统和小规模的数据库。</li>
<li><strong>最少两块硬盘</strong></li>
</ul>
<p>镜像也有不错的性能。镜像可以对我们的数据做一份相同的副本。假设我们有两个2TB的硬盘驱动器，我们总共有4TB，但在镜像中，但是放在 RAID 控制器后面的驱动器形成了一个逻辑驱动器，我们只能看到这个逻辑驱动器有2TB。</p>
<p>当我们保存数据时，它将同时写入这两个2TB驱动器中。创建 RAID 1（镜像化）最少需要两个驱动器。如果发生磁盘故障，我们可以通过更换一个新的磁盘恢复 RAID 。如果在 RAID 1 中任何一个磁盘发生故障，我们可以从另一个磁盘中获取相同的数据，因为另外的磁盘中也有相同的数据。所以是零数据丢失。</p>
<hr>
<h2 id="RAID-5-分布式奇偶校验"><a href="#RAID-5-分布式奇偶校验" class="headerlink" title="RAID 5  分布式奇偶校验"></a>RAID 5  分布式奇偶校验</h2><p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/163053419.png" alt="mark"></p>
<ul>
<li>性能卓越</li>
<li>读速度将非常好。</li>
<li>写速度处于平均水准，如果我们不使用硬件 RAID 控制器，写速度缓慢。</li>
<li>从所有驱动器的奇偶校验信息中重建。</li>
<li>完全容错。</li>
<li>1个磁盘空间将用于奇偶校验。</li>
<li>可以被用在文件服务器，Web服务器，非常重要的备份中。</li>
<li><strong>最少三块硬盘</strong></li>
</ul>
<p>RAID 5 多用于企业级。 RAID 5 的以分布式奇偶校验的方式工作。奇偶校验信息将被用于重建数据。它从剩下的正常驱动器上的信息来重建。在驱动器发生故障时，这可以保护我们的数据。</p>
<p>假设我们有4个驱动器，如果一个驱动器发生故障而后我们更换发生故障的驱动器后，我们可以从奇偶校验中重建数据到更换的驱动器上。奇偶校验信息存储在所有的4个驱动器上，如果我们有4个 1TB 的驱动器。奇偶校验信息将被存储在每个驱动器的256G中，而其它768GB是用户自己使用的。单个驱动器故障后，RAID 5 依旧正常工作，如果驱动器损坏个数超过1个会导致数据的丢失。</p>
<hr>
<h2 id="RAID-6-双分布式奇偶校验磁盘"><a href="#RAID-6-双分布式奇偶校验磁盘" class="headerlink" title="RAID 6 双分布式奇偶校验磁盘"></a>RAID 6 双分布式奇偶校验磁盘</h2><p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/163103166.png" alt="mark"></p>
<ul>
<li>性能不佳。</li>
<li>读的性能很好。</li>
<li>如果我们不使用硬件 RAID 控制器写的性能会很差。</li>
<li>从两个奇偶校验驱动器上重建。</li>
<li>完全容错。</li>
<li>2个磁盘空间将用于奇偶校验。</li>
<li>可用于大型阵列。</li>
<li>用于备份和视频流中，用于大规模。</li>
<li><strong>最少四块硬盘</strong></li>
</ul>
<p>RAID 6 和 RAID 5 相似但它有两个分布式奇偶校验。大多用在大数量的阵列中。我们最少需要4个驱动器，即使有2个驱动器发生故障，我们依然可以更换新的驱动器后重建数据。</p>
<p>它比 RAID 5 慢，因为它将数据同时写到4个驱动器上。当我们使用硬件 RAID 控制器时速度就处于平均水准。如果我们有6个的1TB驱动器，4个驱动器将用于数据保存，2个驱动器将用于校验。</p>
<hr>
<h2 id="RAID-10-镜像-条带"><a href="#RAID-10-镜像-条带" class="headerlink" title="RAID 10  镜像+条带"></a>RAID 10  镜像+条带</h2><p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/163111922.png" alt="mark"><br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/163122495.png" alt="mark"></p>
<ul>
<li>良好的读写性能。</li>
<li>总容量一半用于容错。</li>
<li>从副本数据中快速重建。</li>
<li>由于其高性能和高可用性，常被用于数据库的存储中。</li>
<li><strong>最少四块硬盘</strong></li>
</ul>
<p>RAID 10 可以被称为1 + 0或0 +1。它将做<strong>镜像+条带</strong>两个工作。<br>在 RAID 10 中首先做镜像然后做条带。<br>在 RAID 01 上首先做条带，然后做镜像。<br><strong>RAID 10 比 01 好。</strong></p>
<p>假设，我们有4个驱动器。当我逻辑卷上写数据时，它会使用镜像和条带的方式将数据保存到4个驱动器上。</p>
<p>如果我在 RAID 10 上写入数据“TECMINT”，数据将使用如下方式保存。首先将“T”同时写入两个磁盘，“E”也将同时写入另外两个磁盘，所有数据都写入两块磁盘。这样可以将每个数据复制到另外的磁盘。</p>
<p>同时它将使用 RAID 0 方式写入数据，遵循将“T”写入第一组盘，“E”写入第二组盘。再次将“C”写入第一组盘，“M”到第二组盘。</p>
<hr>
<hr>
<h1 id="RAID-容量计算器"><a href="#RAID-容量计算器" class="headerlink" title="RAID 容量计算器"></a>RAID 容量计算器</h1><p><strong>这里引用了群晖官方的RAID计算器。</strong></p>
<center><br>    <h2><font color="#F75000"><a href="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/173559041.html" target="_blank" rel="external nofollow">RAID 容量计算器</a></font></h2><br></center>

<hr>
<hr>
<h1 id="管理RAID"><a href="#管理RAID" class="headerlink" title="管理RAID"></a>管理RAID</h1><hr>
<h2 id="mdadm"><a href="#mdadm" class="headerlink" title="mdadm"></a>mdadm</h2><h3 id="安装mdadm"><a href="#安装mdadm" class="headerlink" title="安装mdadm"></a>安装mdadm</h3><p>Linux系统基本都带有 mdadm 软件包。没有的话先安装<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> mdadm -y</div><div class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> mdadm</div></pre></td></tr></table></figure></p>
<hr>
<p>下面盗几张图，自己没有截图啦。</p>
<h4 id="新建分区"><a href="#新建分区" class="headerlink" title="新建分区"></a>新建分区</h4><p>创建RAID0 需要两块硬盘，拿/dev/sdb 和/dev/sdc 来实验。<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fdisk <span class="regexp">/dev/</span>sdb        <span class="comment">#对sdb 进行分区</span></div></pre></td></tr></table></figure></p>
<p>输入”m”, 获取帮助，输入”p”, 查看分区前磁盘状态。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170112/113446699.png" alt="mark"><br>输入”n” 新建分区，将整个磁盘都划分成一个分区，然后输入”p” 查看分区情况。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170112/113554117.png" alt="mark"></p>
<hr>
<h4 id="修改分区类型"><a href="#修改分区类型" class="headerlink" title="修改分区类型"></a>修改分区类型</h4><p>默认新建分区的类型是Linux，代号83，需要将其修改为raid 类型。输入”t” ，然后输入”L” </p>
<p>列出所有的文件格式，这里我们选择”fd Linux raid auto”, 输入”fd”，然后再输入”p” 查看分区情况，分区格式已经变成了Linux raid autodetect。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170112/113637514.png" alt="mark"><br>输入”w” 保存分区。<br>使用同样方法对/dev/sdc 进行分区操作。</p>
<hr>
<h4 id="同步分区情况"><a href="#同步分区情况" class="headerlink" title="同步分区情况"></a>同步分区情况</h4><p>使用<code>partprobe</code> 命令同步分区情况。</p>
<p>查看现在的状态<code>fdisk -l /dev/sdb /dev/sdc</code></p>
<h4 id="用sdb和sdc创建RAID-0："><a href="#用sdb和sdc创建RAID-0：" class="headerlink" title="用sdb和sdc创建RAID 0："></a>用sdb和sdc创建RAID 0：</h4><figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mdadm -C /<span class="built_in">dev</span>/md0 -a yes -l <span class="number">0</span> -n <span class="number">2</span> /<span class="built_in">dev</span>/sdb /<span class="built_in">dev</span> sdc</div><div class="line">或</div><div class="line">mdadm -C /<span class="built_in">dev</span>/md0 -ayes -l0 -n2 /<span class="built_in">dev</span>/sd[b,c]<span class="number">1</span></div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-C，--create</td>
<td>创建阵列</td>
</tr>
<tr>
<td>-a，--auto</td>
<td>同意创建设备，如不加此参数时必须先使用mknod 命令来创建一个RAID设备，不过推荐使用-a yes参数一次性创建</td>
</tr>
<tr>
<td>-l，--level</td>
<td>阵列模式，支持的阵列模式有 linear, raid0, raid1, raid4, raid5, raid6, raid10, multipath, faulty, container</td>
</tr>
<tr>
<td>-n，--raid-devices</td>
<td>阵列中活动磁盘的数目，该数目加上备用磁盘的数目应该等于阵列中总的磁盘数目</td>
</tr>
<tr>
<td>/dev/md0　</td>
<td>阵列的设备名称</td>
</tr>
<tr>
<td>/dev/sd{b,c}1　</td>
<td>参与创建阵列的磁盘名称</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="创建RAID-配置文件-etc-mdadm-conf"><a href="#创建RAID-配置文件-etc-mdadm-conf" class="headerlink" title="创建RAID 配置文件/etc/mdadm.conf"></a>创建RAID 配置文件/etc/mdadm.conf</h4><p>RAID 的配置文件为<strong>/etc/mdadm.conf</strong>，默认是不存在的，需要手工创建。</p>
<p>该配置文件的主要作用是系统启动的时候能够自动加载软RAID，同时也方便日后管理。但不是必须的，<strong>推荐对该文件进行配置</strong>。</p>
<p>我们这里需要创建这个文件，测试中发现，如果没有这个文件，则reboot 后，已经创建好的md0 会自动变成md127。</p>
<p>/etc/mdadm.conf 文件内容包括：<br>由<strong>DEVICE</strong> 选项指定用于软RAID的所有设备。<br><strong>ARRAY</strong> 选项所指定阵列的设备名、RAID级别、阵列中活动设备的数目以及设备的UUID号。</p>
<p><strong>创建/etc/mdadm.conf</strong><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">echo DEVICE /dev/sd&#123;b,c&#125;<span class="number">1</span> <span class="meta">&gt;&gt; </span>/etc/mdadm.conf</div><div class="line">mdadm –Ds <span class="meta">&gt;&gt; </span>/etc/mdadm.conf</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>当前生成的/etc/mdadm.conf 文件内容并不符合所规定的格式，所以也是不生效的，这时需要手工修改该文件内容为如下格式：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /etc/mdadm.conf</span></div><div class="line"></div><div class="line">DEVICE <span class="regexp">/dev/</span>sdb1 <span class="regexp">/dev/</span>sdc1</div><div class="line"></div><div class="line">ARRAY <span class="regexp">/dev/m</span>d0 level=raid0 num-devices=<span class="number">2</span> UUID=<span class="number">5160</span>ea40:cb2b44f1:c650d2ef:<span class="number">0</span>db09fd0</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="格式化磁盘阵列"><a href="#格式化磁盘阵列" class="headerlink" title="格式化磁盘阵列"></a>格式化磁盘阵列</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkfs<span class="selector-class">.ext4</span> /dev/md0</div></pre></td></tr></table></figure>
<h4 id="建立挂载点并挂载"><a href="#建立挂载点并挂载" class="headerlink" title="建立挂载点并挂载"></a>建立挂载点并挂载</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /raid0</div><div class="line">mount <span class="meta-keyword">/dev/</span>md0 <span class="meta-keyword">/raid0/</span></div></pre></td></tr></table></figure>
<hr>
<h4 id="写入-etc-fstab"><a href="#写入-etc-fstab" class="headerlink" title="写入/etc/fstab"></a>写入/etc/fstab</h4><p>为了下次开机还能正常使用我们的RAID设备，需要将挂载的信息写入/etc/fstab 文件中。然后reboot 测试开机是否自动挂载，raid0 创建完毕。</p>
<hr>
<p>参考资料：<br><a href="http://www.centoscn.com/image-text/config/2015/0213/4713.html" target="_blank" rel="external">http://www.centoscn.com/image-text/config/2015/0213/4713.html</a><br><a href="http://www.cnblogs.com/mchina/p/linux-centos-disk-array-software_raid.html" target="_blank" rel="external">http://www.cnblogs.com/mchina/p/linux-centos-disk-array-software_raid.html</a></p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;RAID简介&quot;&gt;&lt;a href=&quot;#RAID简介&quot; class=
    
    </summary>
    
      <category term="系统管理" scheme="https://www.leolan.top/categories/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="RAID" scheme="https://www.leolan.top/tags/RAID/"/>
    
  </entry>
  
  <entry>
    <title>Btrfs文件系统</title>
    <link href="https://www.leolan.top/posts/9108/"/>
    <id>https://www.leolan.top/posts/9108/</id>
    <published>2017-01-06T02:23:06.000Z</published>
    <updated>2017-02-27T08:47:33.056Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="Btrfs简介"><a href="#Btrfs简介" class="headerlink" title="Btrfs简介"></a>Btrfs简介</h1><p>Btrfs 是一个 Linux 中的新的写时复制(copy-on-write (COW))的文件系统，目的是实现高级功能的同时着重与容错功能，修复功能以及易于管理。</p>
<p><strong>Btrfs核心特性</strong>：<br>多物理卷支持：btrfs可由多个底层物理卷组成；支持RAID，以联机“添加”、“移除”、“修改”；</p>
<p><strong>写时复制更新机制(CoW)</strong>：复制、更新及替换指针，而非“就地”更新；在文件进行修改的时候，首先将文件复制一份出来，在复制出来的文件上进行修改，修改完成之后，将指向原有文件的指针修改指向到修改完成的文件上，若修改完成的文件出现了错误，则我们可以通过原文件进行修复</p>
<p><strong>数据及元数据校验码</strong>：checksum ,当存储某个文件时，checksum会将数据的源数据和数据的校验码，分别通过文件的属性扩展进行保存，当我们再次读取数据时可以方便的检测数据是否受损，如果文件受损系统可以完成自动修复；</p>
<p><strong>子卷</strong>：sub_volume，在一个卷上创建多个子卷，在每一个子卷上创建文件系统，并挂载使用；</p>
<p><strong>快照</strong>：支持快照的快照；因此可以实现类似增量快照的机制</p>
<p><strong>透明压缩 </strong>：如果我们在存储文件时，进行压缩存储，那么在文件发往btrfs时，会自动的占用时钟周期，完成数据的压缩存放，而用户并不知道，在用户读取文件时，会自动的进行文件的解压缩，可以实现节约磁盘空间。但是压缩和解压缩会占用时钟周期；</p>
<p>Btrfs确实比ext4多了很多功能，快照功能更是很有使用价值，管理也比ext格式要方便一些。</p>
<hr>
<h1 id="创建Btrfs文件系统"><a href="#创建Btrfs文件系统" class="headerlink" title="创建Btrfs文件系统"></a>创建Btrfs文件系统</h1><p>mkfs.btrfs</p>
<ul>
<li><strong>-L ‘LABEL’</strong>：指定文件系统的卷标；</li>
<li><strong>-d [type]</strong>: raid0, raid1, raid5, raid6, raid10, single  指明数据的存放方式，支持RAID机制；</li>
<li><strong>-m [profile]</strong>：raid0, raid1, raid5, raid6, raid10, single, dup 指明元数据的存放方式，是否可跨越多个物理卷，支持RAID机制；</li>
<li><strong>-O [feature]</strong>：在格式化文件系统的时候，是否直接开启文件系统的某些特性；</li>
<li><strong>-O list-all</strong>：列出支持的所有特性；</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fdisk <span class="_">-l</span></div></pre></td></tr></table></figure>
<p>拿这个20G的盘开刀。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/102726838.png" alt="mark"><br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkfs.btrfs -L my20G_date <span class="meta-keyword">/dev/</span>sdae   <span class="meta">#创建btrfs 文件系统</span></div><div class="line"><span class="meta">#也可以多块硬盘mkfs.btrfs -L my20G_date /dev/sdae /dev/sdc 这样就把两块硬盘合并起来管理。</span></div><div class="line"></div><div class="line">blkid <span class="meta-keyword">/dev/</span>sdae                      <span class="meta">#查看设备sdae的属性,可以看到TYPE=<span class="string">"btrfs"</span></span></div><div class="line">btrfs filesystem show                <span class="meta">#查看系统上的所有btrfs文件系统</span></div></pre></td></tr></table></figure></p>
<p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/102942852.png" alt="mark"><br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mkdir /my20G                      <span class="comment">#创建挂载目录</span></div><div class="line">mount <span class="regexp">/dev/sdae /my20G/</span>           <span class="comment">#挂载  </span></div><div class="line">mount | grep /my20G               <span class="comment">#已挂载成功</span></div><div class="line">df -h</div><div class="line"></div><div class="line"><span class="comment">#man btrfs filesystem 可用来查看命令帮助文档</span></div></pre></td></tr></table></figure></p>
<p><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170106/103630400.png" alt="mark"></p>
<hr>
<h1 id="调整btrfs文件系统大小-逻辑边界"><a href="#调整btrfs文件系统大小-逻辑边界" class="headerlink" title="调整btrfs文件系统大小(逻辑边界)"></a>调整btrfs文件系统大小(逻辑边界)</h1><p>btrfs调整大小只要一条命令就行，几乎是瞬间完成的。<br><strong>命令格式</strong>：<code>btrfs filesystem resize &lt;size(单位G,K,M)&gt;或者max &lt;path&gt;</code><br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">btrfs filesystem resize <span class="number">-10</span>G /my20G    <span class="meta">#将分区缩小10G，单位可以是M，K。</span></div><div class="line">df -h                                  <span class="meta">#可以看到已经缩小了10G了</span></div><div class="line"></div><div class="line">btrfs filesystem resize +<span class="number">5000</span>M /my20G  <span class="meta">#将分区扩大5000M，单位可以是M，K。</span></div><div class="line">df -h                                  <span class="meta">#可以看到已经增加了近5G空间</span></div><div class="line"></div><div class="line">btrfs filesystem resize <span class="built_in">max</span> /my20G     <span class="meta">#max，将文件系统大小调整至其物理边界，可用最大的存储空间。</span></div></pre></td></tr></table></figure></p>
<hr>
<h1 id="调整btrfs物理边界大小"><a href="#调整btrfs物理边界大小" class="headerlink" title="调整btrfs物理边界大小"></a>调整btrfs物理边界大小</h1><p>物理边界就属于硬件范畴了，增加或去掉硬盘。<br><strong>命令格式</strong>：<code>btrfs device &lt;add/delete/scan&gt; &lt;dev&gt; &lt;mount_point&gt;</code><br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">btrfs device <span class="keyword">add</span><span class="bash"> /dev/sdd /my20G    <span class="comment">#为btrfs文件系统，增加一块硬盘sdd</span></span></div><div class="line">df -lh                              <span class="comment">#完成后，容量已经扩充了</span></div></pre></td></tr></table></figure></p>
<hr>
<h1 id="透明压缩"><a href="#透明压缩" class="headerlink" title="透明压缩"></a>透明压缩</h1><p>只需在挂载时候，使用-o 并指定压缩方式即可，对用户是透明的，可以选择lzo或zlib两种压缩方式<br><strong>命令格式</strong>：<code>mount -o compress={lzo|zlib} DEVICE MOUNT_POINT</code><br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mount -o compress=lzo <span class="meta-keyword">/dev/</span>sdae /my20G</div><div class="line">mount -o compress=zlib <span class="meta-keyword">/dev/</span>sdae /my20G</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="btrfs文件均衡"><a href="#btrfs文件均衡" class="headerlink" title="btrfs文件均衡"></a>btrfs文件均衡</h1><p><strong>命令格式</strong>：<code>btrfs balance start [OPTIONS] &lt;FILTERS&gt; MOUNT_POINT</code><br>常用选项有：</p>
<ul>
<li><strong>-d</strong>: 指定数据的组织机制</li>
<li><strong>-s</strong>：指定元数据的组织机制</li>
<li><strong>-m</strong>：指定文件系统的组织机制</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">btrfs </span>device <span class="keyword">add </span>/dev/sdd /my20G            #为<span class="keyword">btrfs文件系统，增加一块硬盘sdd</span></div><div class="line"><span class="keyword">btrfs </span>filesystem show                       #查看<span class="keyword">btrf文件系统信息</span></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">balance </span>start /my20G                  #均衡文件</div><div class="line"></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">balance </span>start -mconvert<span class="symbol">=raid5</span> /my20G  #均衡文件，并使用raid5(最少<span class="number">3</span>块硬盘)组织文件系统，RAID模式还要注意每块硬盘的容量大小。</div></pre></td></tr></table></figure>
<hr>
<h1 id="删除btrfs的物理卷"><a href="#删除btrfs的物理卷" class="headerlink" title="删除btrfs的物理卷"></a>删除btrfs的物理卷</h1><p>如果只有一个硬盘的话是无法删除的。<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">btrfs device <span class="keyword">delete</span> /dev/sdd /my20G    <span class="meta">#将sdd设备移除</span></div><div class="line">df -lh /my20G                          <span class="meta">#容量减少了</span></div><div class="line">btrfs filesystem <span class="keyword">show</span> /my20G           <span class="meta">#sdd被删掉了</span></div></pre></td></tr></table></figure></p>
<hr>
<h1 id="ext文件系统和btrfs文件系统互转"><a href="#ext文件系统和btrfs文件系统互转" class="headerlink" title="ext文件系统和btrfs文件系统互转"></a>ext文件系统和btrfs文件系统互转</h1><p><strong>命令格式</strong>：<code>btrfs-convert [-r] Device</code><br><strong>-r</strong>：从btrfs回滚到之前的文件系统,不使用-r 代表从普通文件系统，转化成btrfs文件系统<br>先说说硬盘拆分，架设现在用了3块硬盘组的RAID5，先降级为RAID1才可以拆掉其中一块</p>
<h2 id="拆分硬盘"><a href="#拆分硬盘" class="headerlink" title="拆分硬盘"></a>拆分硬盘</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">btrfs </span><span class="keyword">balance </span>start  -mconvert<span class="symbol">=raid1</span> /my20G</div><div class="line"><span class="keyword">btrfs </span><span class="keyword">balance </span>start  -dconvert<span class="symbol">=raid1</span> /my20G</div><div class="line"><span class="keyword">btrfs </span>device delete /dev/sdd /my20G           #此时移除设备sdd</div></pre></td></tr></table></figure>
<h2 id="从ext4转为Btrfs"><a href="#从ext4转为Btrfs" class="headerlink" title="从ext4转为Btrfs"></a>从ext4转为Btrfs</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#创建ext4分区</span></div><div class="line">fdisk <span class="meta-keyword">/dev/</span>sdd                                <span class="meta">#将sdd重新创建分区sdd1</span></div><div class="line">mkfs.ext4 <span class="meta-keyword">/dev/</span>sdd1                           <span class="meta">#格式化为ext4文件系统</span></div><div class="line">mount <span class="meta-keyword">/dev/</span>sdd1 /mnt                          <span class="meta">#挂载sdd1</span></div><div class="line"></div><div class="line">ls /mnt </div><div class="line">cp <span class="meta-keyword">/etc/</span>fstab /mnt       <span class="meta">#复制文件fstab到 /mnt</span></div><div class="line">ls /mnt </div><div class="line">umount /mnt              <span class="meta">#卸载文件系统，不要在线做文件系统转换</span></div><div class="line">fsck -f <span class="meta-keyword">/dev/</span>sdd1        <span class="meta">#做强制检测</span></div><div class="line"></div><div class="line"><span class="meta">#将ext4装换为Btrfs</span></div><div class="line">btrfs-convert <span class="meta-keyword">/dev/</span>sdd1   </div><div class="line">btrfs filesystem show    <span class="meta">#sdd1已经转化成了btrfs文件系统</span></div><div class="line">mount <span class="meta-keyword">/dev/</span>sdd1 /mnt</div><div class="line">ls /mnt</div><div class="line">cat <span class="meta-keyword">/mnt/</span>fstab           <span class="meta">#之前的文件fstab仍旧可以正常访问</span></div></pre></td></tr></table></figure>
<h2 id="从Btrfs转为ext4"><a href="#从Btrfs转为ext4" class="headerlink" title="从Btrfs转为ext4"></a>从Btrfs转为ext4</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">umount /mnt</div><div class="line">btrfs-convert -r <span class="meta-keyword">/dev/</span>sdd1</div><div class="line">mount <span class="meta-keyword">/dev/</span>sdd1 /mnt</div><div class="line">ls /mnt</div><div class="line">blkid <span class="meta-keyword">/dev/</span>sdd1          <span class="meta">#参考sdd1信息，可见TYPE=<span class="string">"ext4"</span></span></div><div class="line">cat <span class="meta-keyword">/mnt/</span>fstab           <span class="meta">#且原文件仍旧可以正常访问</span></div></pre></td></tr></table></figure>
<hr>
<h1 id="btrfs子卷管理"><a href="#btrfs子卷管理" class="headerlink" title="btrfs子卷管理"></a>btrfs子卷管理</h1><h2 id="创建子卷："><a href="#创建子卷：" class="headerlink" title="创建子卷："></a>创建子卷：</h2><p><strong>命令格式</strong>： <code>btrfs subvolume create /PATH</code>  此路径必须是在btrfs文件系统的挂载目录下<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>create /my20G/<span class="keyword">subvol </span>   #创建子卷，子卷名为<span class="keyword">subvol</span></div><div class="line"></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>create /my20G/<span class="keyword">subvol1 </span>  #再创建子卷，子卷名为<span class="keyword">subvol1</span></div><div class="line"></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>list /my20G             #查看<span class="keyword">btrfs </span>文件系统下的所有子卷信息</div><div class="line"><span class="symbol">ID</span> <span class="number">262</span> gen <span class="number">73</span> top level <span class="number">5</span> path <span class="keyword">subvol </span>  <span class="symbol">#ID</span> <span class="number">262</span> 是子卷<span class="keyword">subvol的ID，可以用该ID来挂载该卷</span></div><div class="line"><span class="symbol">ID</span> <span class="number">263</span> gen <span class="number">74</span> top level <span class="number">5</span> path <span class="keyword">subvol1</span></div></pre></td></tr></table></figure></p>
<h2 id="挂载子卷"><a href="#挂载子卷" class="headerlink" title="挂载子卷"></a>挂载子卷</h2><p><strong>命令格式</strong>：  <code>mount -o subvol=SUBVOLUME  DEVICE /MOUNT_POIN</code><br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mount -o subvol=subvol <span class="meta-keyword">/dev/</span>sdae /mnt  <span class="meta">#将子卷单独挂载到/mnt目录下</span></div><div class="line">ls /mnt                                <span class="meta">#此时是没有任何内容的</span></div></pre></td></tr></table></figure></p>
<h3 id="查看子卷相关信息"><a href="#查看子卷相关信息" class="headerlink" title="查看子卷相关信息"></a>查看子卷相关信息</h3><h4 id="挂载父卷，子卷自动被挂载"><a href="#挂载父卷，子卷自动被挂载" class="headerlink" title="挂载父卷，子卷自动被挂载"></a>挂载父卷，子卷自动被挂载</h4><p><strong>命令格式</strong>：<code>btrfs subvolume show MOUNT_POINT</code><br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">btrfs subvolume show /mnt              <span class="meta">#查看子卷信息</span></div><div class="line">cp <span class="meta-keyword">/var/</span>log/messages /mnt              <span class="meta">#复制messages文件到子卷subvol</span></div><div class="line">ls /mnt</div><div class="line">umount /mnt                            <span class="meta">#卸载子卷subvol</span></div><div class="line">mount <span class="meta-keyword">/dev/</span>sdae /my20G                 <span class="meta">#将这个btrfs文件系统挂载到/my20G目录</span></div><div class="line">ls /my20G</div><div class="line">ls /my20G/subvol                       <span class="meta">#可见子卷subvol的内容是可见的，所以说一旦父卷挂载，子卷就被自动挂载了</span></div></pre></td></tr></table></figure></p>
<h4 id="挂载子卷，父卷不会自动被挂载"><a href="#挂载子卷，父卷不会自动被挂载" class="headerlink" title="挂载子卷，父卷不会自动被挂载"></a>挂载子卷，父卷不会自动被挂载</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">umount /my20G                             <span class="comment">#卸载父卷，</span></div><div class="line">mount -o subvol=subvol /dev/sdae /my20G   <span class="comment">#单独挂载子卷</span></div><div class="line">ls <span class="regexp">/my20G/</span>                                <span class="comment">#此时/my20G下只有子卷的内容，并不会有父卷的内容：如subvol,subvol1目录</span></div></pre></td></tr></table></figure>
<p><strong>注</strong>：由于是子卷，如果父卷已经挂载，则子卷就自动被挂载了<br>反之，如果只挂载子卷，父卷内容是不会自动挂载的，其内容，不可见</p>
<h4 id="分别挂载子卷和父卷（不要先挂载父卷）"><a href="#分别挂载子卷和父卷（不要先挂载父卷）" class="headerlink" title="分别挂载子卷和父卷（不要先挂载父卷）"></a>分别挂载子卷和父卷（不要先挂载父卷）</h4><p>子卷，父卷也可以分别挂载：（可是没必要单独挂载子卷，父卷挂载完成后，子卷也就被自动挂载了)<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">umount /my20G                             <span class="meta">#卸载子卷</span></div><div class="line">mount -o subvol=subvol <span class="meta-keyword">/dev/</span>sdae /mnt     <span class="meta">#挂载子卷到/mnt目录</span></div><div class="line">mount <span class="meta-keyword">/dev/</span>sdae /my20G                    <span class="meta">#挂载父卷到/my20G目录</span></div><div class="line">ls /my20G/                                <span class="meta">#此时父卷挂载成功</span></div><div class="line">ls /mnt                                   <span class="meta">#子卷内容也可单独显示</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="删除子卷"><a href="#删除子卷" class="headerlink" title="删除子卷"></a>删除子卷</h2><p><strong>命令格式</strong>：<code>btrfs subvolume delete /MOUNT_POINT</code><br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>delete /my20G/<span class="keyword">subvol </span>     #删除子卷<span class="keyword">subvol</span></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>list /my20G               #已经没有了子卷<span class="keyword">subvol信息了</span></div></pre></td></tr></table></figure></p>
<h2 id="子卷快照"><a href="#子卷快照" class="headerlink" title="子卷快照"></a>子卷快照</h2><p><strong>命令格式</strong>：<code>btrfs subvolume snapshot /PATH/TO/SUBVOLUME /PATH/TO/SNAPSHOT</code><br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">cp</span> /etc/passwd /my20G/<span class="keyword">subvol1/ </span>                                    #复制passwd文档到子卷<span class="keyword">subvol1内</span></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>snapshot /my20G/<span class="keyword">subvol1/ </span>/my20G/<span class="keyword">subvol1_snapshot </span>  #创建快照<span class="keyword">subvol1_snapshot</span></div><div class="line"><span class="keyword">btrfs </span><span class="keyword">subvolume </span>list /my20G                                        #快照子卷<span class="keyword">subvol1_snapshot创建完成</span></div><div class="line"></div><div class="line"><span class="symbol">echo</span> <span class="string">"TEST FOR SNAPSHOT"</span> &gt;&gt; /my20G/<span class="keyword">subvol1/passwd </span>  #在passwd文档后追加一行 <span class="string">"TEST FOR SNAPSHOT"</span> </div><div class="line"><span class="symbol">tail</span> -<span class="number">1</span> /my20G/<span class="keyword">subvol1/passwd </span>                      #此时子卷中数据更新了</div><div class="line"><span class="symbol">tail</span> -<span class="number">1</span> /my20G/<span class="keyword">subvol1_snapshot/passwd </span>             #此时快照中的passwd并没有更新，末尾没有<span class="string">"TEST FOR SNAPSHOT"</span> 这行。</div></pre></td></tr></table></figure></p>
<p><strong>注</strong>：在子卷创建快照后，对原子卷做的修改操作并不会反映到快照中。</p>
<hr>
<blockquote>
<p>原文：<a href="http://siyuan710.blog.51cto.com/10648912/1699070" target="_blank" rel="external">http://siyuan710.blog.51cto.com/10648912/1699070</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;Btrfs简介&quot;&gt;&lt;a href=&quot;#Btrfs简介&quot; clas
    
    </summary>
    
      <category term="杂项" scheme="https://www.leolan.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="Btrfs文件系统" scheme="https://www.leolan.top/tags/Btrfs%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>黑苹果</title>
    <link href="https://www.leolan.top/posts/3958/"/>
    <id>https://www.leolan.top/posts/3958/</id>
    <published>2017-01-05T08:04:47.000Z</published>
    <updated>2017-02-27T08:47:33.055Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>最近整理资料，早就想写一篇黑苹果了，自从入手了百苹果后就没再折腾黑苹果了，说真的，黑苹果适合那些作死折腾的人，不想折腾的还是某宝找远程安装吧。</p>
<p>最可怕的是那年寒假，在家除了吃饭睡觉就是想办法驱动那个奇葩的ATI HD 4300 显卡，当时没找到什么文章，都是台式机显卡能驱动的，但这款移动版貌似全球无解，我就这样改了又改重启了几百次，真的是几百次哦，简直不忍直视。</p>
<p>以前比较出名是远景论坛(不过竟然被查了，网站关了)，<a href="http://www.feng.com/" target="_blank" rel="external">威锋网</a>到了2017，好像<strong><a href="https://imac.hk/" target="_blank" rel="external">黑苹果乐园</a></strong>是更新比较快的。<br>猫叔博客：<a href="https://www.maoshu.cc" target="_blank" rel="external">https://www.maoshu.cc</a><br>黑苹果需要有丰富的系统知识做支撑，不然遇到困难真的没法解决。</p>
<hr>
<h1 id="虚拟机安装"><a href="#虚拟机安装" class="headerlink" title="虚拟机安装"></a>虚拟机安装</h1><p>在虚拟机中安装Mac操作系统也是可以的，但是显卡会有限制，最大128M显存，自然也就特别特别卡了。安装时一般需要ISO版（见工具包中的：dam2iso）的系统，安装完成后可以用原生引导，也可以更换为ISO版的其他引导。<br>VirtualBox自带有Mac选择，安装时选择就行了；VMware需要下载一个解锁补丁，不同的VM版本补丁不同，搜索就有。安装补丁之后安装系统就能看到Mac选择了。</p>
<hr>
<p>安装系统都是一样的，制作引导需要一点技巧。引导有BootThink、<a href="http://chameleon.osx86.hu/" target="_blank" rel="external">Chameleon(变色龙)</a>、<a href="https://sourceforge.net/projects/cloverefiboot/" target="_blank" rel="external">Clover(四叶草)</a>等好几种。</p>
<p>黑苹果想要完美一些就尽量选择中高端机型，硬件和白苹果类似的最好，当然，太过新颖的机型也可能不支持的。</p>
<hr>
<p><strong>工具打包下载：</strong><a href="http://ofyfogrgx.bkt.clouddn.com/黑苹果安装工具打包.zip" target="_blank" rel="external">http://ofyfogrgx.bkt.clouddn.com/黑苹果安装工具打包.zip</a></p>
<h1 id="Boot-MBR"><a href="#Boot-MBR" class="headerlink" title="Boot+MBR"></a>Boot+MBR</h1><p><strong>适合不支持UEFI的老机子或不打算升级的情况。</strong><br>安装镜像如果是下载原版的要破解剥离引导层(见工具包中的：官方DMG格式提取安装文件)后才能使用，费时费力，建议下载破解好的懒人版之类的。</p>
<p>这种模式选用3种引导中的哪一种都行，不建议选BootThink，貌似不维护了，所以不支持新的系统了。如果是变色龙的话就方便很多。</p>
<hr>
<h2 id="Windows下的准备工作"><a href="#Windows下的准备工作" class="headerlink" title="Windows下的准备工作"></a>Windows下的准备工作</h2><p>先安装JAVA环境，Microsoft .NET Framework 2.0硬盘模式要打开AHCI（在BIOS中开启）</p>
<p>1.用Win7的磁盘管理工具分出一个10G的分区和一个30G的分区（这两个是主分区或逻辑分区都可以），<strong>在新建两个简单卷过程中注意选择“不要格式化”。</strong> 30G分区用来安装Mac系统，10G分区用来写入安装文件，安装完成后10G分区可删除。【硬盘用MRB或GPT分区表都没问题】<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/172251905.png" alt="mark"></p>
<p>2.安装“BootThink或Win版色龙安装器GUI安装</p>
<p>3.安装MacDrive或（win下读写HFS分区），也可以汉化破解，不破解也没关系。</p>
<p>4.运行“硬盘安装助手”，选择下载来的ISO，取消下面的三个选项，选择写入10G的分区中。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/172518781.png" alt="mark"></p>
<p>如果遇到提示无法写入，请将10G分区进行如下操作：快速格式化为NTFS--&gt;磁盘管理工具内删除分区--&gt;新建简单卷（不要格式化）。</p>
<p>写入过程中会显示程序未响应，这是正常现象，不用管它，过一会会提示写入完成。然后打开<strong>分区助手【好用】.exe</strong>看看分区标记是不是AF不是的话改为AF,之后重启开始安装。</p>
<hr>
<h2 id="安装Mac系统"><a href="#安装Mac系统" class="headerlink" title="安装Mac系统"></a>安装Mac系统</h2><p>1.重启后进入BootThink或变色龙，选择“OS X Install DVD“字样的回车。稍后进入安装界面，</p>
<p><strong>安装遇到，白屏 且 鼠标 在屏幕左上角 无限彩色风火轮？</strong><br>可以安装或替换\System\Library\Extensions\FakeSMC.kext或者\Extra\Extensions\FakeSMC.kext为FakeSMC.kext.2.5.zip【解压出来】版的 即可。<br>删掉/System/Library/Caches/com.apple.kext.caches/Startup/全部文件</p>
<p><strong>安装过程遇到五国语言卡死？</strong><br>这个问题比较复杂，我差不多忘记了怎么处理了。</p>
<p>2.选择菜单栏中的<strong>“实用工具”</strong>里的<strong>“磁盘工具”</strong>，在左侧选择30G的分区，点击<strong>“抹掉”</strong>。格式选择“Mac OS 扩展（日志式）”，名称可任意。然后点下面的“抹掉”抹盘完成后关闭磁盘工具，回到安装程序。</p>
<p>3.选择同意许可，安装位置选择刚才抹掉的分区（注意，不要误点下一步）</p>
<p>4.安装过程中可能出现光标消失，滚动条停止，剩余时间不变的状况，这时点一下触摸板上的鼠标左键即可解决，不影响安装。</p>
<p>5.安装完成后提示重启，点击“重新启动”，由于此时没有安装kext，系统会一直停留在菊花旋转界面，需要手动按电源键关机后重启。</p>
<p>6.重启后选择进入另一个系统【就是安装前用的win系统】，删除安装的苹果分区内的<strong>X:/System/Library/CoreServices/SetupAssistant.app/Contents/Resources/DeviceSection.bundle</strong>否则进入系统时会提示找不到键盘而无法进入。</p>
<p>建议此时把Kext Wizard.app等软件放到Mac的分区中或\System\Library\Extensions到时点开就可以安装。</p>
<p>7.重启后用BootThink或变色龙进入Mac系统，选择语言，创建账户密码，注册AppleID可直接跳过，正常情况下设置完成后可进入Mac系统。</p>
<p>如果设置完成后又重新回到首页选择语言、创建账户，并且无限循环，恭喜你，这次安装失败了，再手动重启选择安装文件写入的分区重新安装一遍，并删除那个不能识别键盘的文件。</p>
<hr>
<h2 id="在Mac下安装硬件kext"><a href="#在Mac下安装硬件kext" class="headerlink" title="在Mac下安装硬件kext"></a>在Mac下安装硬件kext</h2><p>此时能进入系统了，如果显卡没有驱动是超级卡的，接着来一步一步驱动各个硬件。<br>进入Mac系统后，双击解压“Kext Wizard.zip”，得到kext安装工具“Kext Wizard”。</p>
<p>1.运行<strong>Kext Wizard</strong>，如过请求检查更新选不检查，选择“Installation”，选择刚才全部的kext，然后选择安装到<strong>System/Library/Extensions</strong>并确认右下角选择的是Mac安装的分区。点击Install，稍后会提示安装完成。如果右下角的没有识别出安装分区，可能是这个版本的<strong>Kext Wizard</strong>不行，换一个版本，不过似乎也不影响，这种只能试试，没个准的。</p>
<p>安装完或手动把Kext复制进了<strong>System/Library/Extensions</strong>的可以运行<strong>磁盘工具修复权限</strong></p>
<hr>
<h2 id="修改设备ID驱动"><a href="#修改设备ID驱动" class="headerlink" title="修改设备ID驱动"></a>修改设备ID驱动</h2><p>某些硬件型号是一样的，但是设备识别码（ID）不同，或者是不同型号共用一个设备ID，这时需要修改设备ID才能驱动了。</p>
<p>以下以Marvell Yukon 88E8042网卡驱动为例<br>1.找到System/Library/Extensions下的IONetworkingFamily.kext，右键点击它选择“显示包内容”，把里面的Contents/PlugIns/AppleYukon2.kext拷贝到桌面。</p>
<p>2.右键桌面上的AppleYukon2.kext，选择显示包内容，找到Contents/Info.plist，双击编辑Info.plist，展开Information Property List下的 IOKitPersonalities</p>
<p>3.找到Yukon开头的第一行，左侧修改为Yukon-88E8042；展开Yukon-88E8042 ，找到IOPCIPrimaryMatch把它右边的内容改成<br>0x435711ab（0x435711ab是在Win下用设备管理器-硬件详细信-硬件ID查得，你的网卡ID可能不是这个，请提前确认）<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/174558145.png" alt="mark"><br>找到Model把它右面的内容改成Marvell Yukon 88E8042 PCI-E  Singleport Copper SA（改为要显示的网卡名字，最好不要有中文）。</p>
<p>4.保存文件，用桌面上的“AppleYukon2.kext”替换System/Library/Extensions/IONetworkingFamily.kext/Contents/PlugIns/AppleYukon2.kext。<br>然后使用磁盘工具修复此分区的权限，重新启动后网卡即可使用。</p>
<p>其他驱动也是类似这样修复的。这里提供一个思路，黑苹果绝对不仅仅是这么简单。</p>
<hr>
<h1 id="UEFI-GPT"><a href="#UEFI-GPT" class="headerlink" title="UEFI+GPT"></a>UEFI+GPT</h1><p>直接用原版镜像安装<br><strong>适合支持UEFI或在线升级的情况。建议用四叶草引导。</strong></p>
<p>制作引导参考：<br><a href="http://bbs.feng.com/read-htm-tid-7534160.html" target="_blank" rel="external">http://bbs.feng.com/read-htm-tid-7534160.html</a><br><a href="https://www.maoshu.cc/993.html" target="_blank" rel="external">https://www.maoshu.cc/993.html</a><br><a href="http://jingyan.baidu.com/article/d5a880eb8bd51113f047cc76.html" target="_blank" rel="external">http://jingyan.baidu.com/article/d5a880eb8bd51113f047cc76.html</a></p>
<p>安装盘按Boot+MBR的方法制作好，制作好引导后直接，启动安装即可，因为是原版镜像，一般安装成功的几率是很高的，基本不会有什么错误。安装好后的各个驱动问题也是按<strong>修改设备ID驱动</strong>的方法解决，也可以自己下载kext文件放进去然后修复。</p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;最近整理资料，早就想写一篇黑苹果了，自从入手了百苹果后就没再折腾黑苹果了，
    
    </summary>
    
      <category term="杂项" scheme="https://www.leolan.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="黑苹果" scheme="https://www.leolan.top/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/"/>
    
  </entry>
  
  <entry>
    <title>不仅仅是一个路由器</title>
    <link href="https://www.leolan.top/posts/106/"/>
    <id>https://www.leolan.top/posts/106/</id>
    <published>2017-01-04T09:20:45.000Z</published>
    <updated>2017-02-27T08:47:33.066Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>说起路由器，回想起以前折腾路由的日子，不对，现在依然在折腾。不过，我折腾过的路由并不多，华为hg255d,newifi,斐讯302B，斐讯K1，斐讯K2，极路由1S，乐携路由，TP-Link某低端机子，AirPort Time Capsule，网件R8000；目前就这些，除了剁手花了近700软妹币买的螃蟹R8000主板，和Time Capsule ，其他都是些低端路由，虽然很折腾人，但也学到了很多东西；写这篇是因为我快不记得刷机步骤了，毕竟忙着忙着就好久没有去折腾了。</p>
<p>太低端的就不说了，只是刷个固件没什么好玩的，能改装的路由才是好路由。折腾路由的原因大多是不想让路由仅仅只是个路由！！！这点很重要，于是有了<strong>去广告，搭梯子，VPN，破解校园网，游戏加速，宽带多拨，各种BT、PT、远程、离线下载，文件共享、远程监控、网络打印机、各种小型服务器搭建</strong>等等。</p>
<hr>
<h1 id="MTK7620系列"><a href="#MTK7620系列" class="headerlink" title="MTK7620系列"></a>MTK7620系列</h1><p>7620系列的路由因为CPU的通用性，成本低等因素，快速的成为厂家首选，16年这一两年内还是中端路由的首选，时长占用量大了就有大神去开发固件。相互移植也变得简单，比较有代表性的固件是：<strong>华硕Padavan，小云newifi如意云，openwrt，Tomato，极路由，潘多拉，DD-WRT，小米miwifi</strong>等等，这些固件都有7620系列的版本。</p>
<p>华硕Padavan固件（支持超多机型）：<br><a href="http://www.right.com.cn/forum/thread-161324-1-1.html" target="_blank" rel="external">http://www.right.com.cn/forum/thread-161324-1-1.html</a><br><a href="http://rt.cn2k.net" target="_blank" rel="external">http://rt.cn2k.net</a><br>极玩固件（自带SS，不能装插件）：<a href="http://www.geewan.com/download.php?id=4" target="_blank" rel="external">http://www.geewan.com/download.php?id=4</a></p>
<p>推荐论坛：<a href="http://www.right.com.cn/forum/forum.php" target="_blank" rel="external">恩山论坛</a></p>
<hr>
<h2 id="newifi-mini"><a href="#newifi-mini" class="headerlink" title="newifi mini"></a>newifi mini</h2><p>官方论坛：<a href="http://bbs.newifi.com/forumall.php" target="_blank" rel="external">http://bbs.newifi.com/forumall.php</a><br><a href="http://www.newbandeng.com/forum.php" target="_blank" rel="external">http://www.newbandeng.com/forum.php</a><br>能找到你想要的。</p>
<p>newifi是个很好刷的路由，我记得官方的就是<strong>不死uboot</strong>（就是那种不管刷什么固件都不影响uboot，不会变砖的路由），直到极路由固件被移植到newifi上后这个神话就被打破了，极路由的固件会覆盖原有的boot导致无法再刷其他路由固件，这种问题貌似只能用<strong>TTL</strong>或<strong>编程器</strong>修复，所以刷极路由固件需谨慎。</p>
<p><strong>刷机</strong>：一般是网线LAN连电脑，电脑设置静态IP，192.168.1.10<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/120913764.png" alt="mark"><br>捅菊花插电源，不要放手，5秒左右两个或3个灯在不停的闪，这时浏览器打开192.168.1.1就可以看到固件选择界面了。</p>
<h3 id="救砖"><a href="#救砖" class="headerlink" title="救砖"></a>救砖</h3><p>我的话是买了2个ROM，还有编程器，用TTL或编程器恢复需要有电烙铁和一定的手工能力，TTL和其他路由方法是一样的，结合tftp一起用。编程器的话选择支持24,25系列的编程器，某宝搜路由编程器一大堆。店家会送驱动软件，没有就自己下载一个。相信能到这个地步的也是敢于作死的。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/122600937.jpg" alt="mark"><br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/121622216.jpg" alt="mark"></p>
<p><a href="http://www.newbandeng.com/thread-10936-1-1.html" target="_blank" rel="external">『零基础玩newifi』【四】TTL 救砖大法详解</a><br><a href="http://www.newbandeng.com/forum.php?mod=viewthread&amp;tid=10893&amp;extra" target="_blank" rel="external">不拆机备份编程器固件</a><br><a href="http://www.newbandeng.com/forum.php?mod=viewthread&amp;tid=10946&amp;extra=" target="_blank" rel="external">不拆机刷编程器固件</a></p>
<hr>
<h2 id="极路由1s"><a href="#极路由1s" class="headerlink" title="极路由1s"></a>极路由1s</h2><p>极路由刷和newifi是差不多的，唯一要注意的就是备份key,不然刷回极路由后没有key是连接不了插件商城的。<br><strong>备份key</strong><br><a href="http://www.hiwifimi.com/archives/114" target="_blank" rel="external">http://www.hiwifimi.com/archives/114</a><br><a href="http://www.right.com.cn/forum/thread-137774-1-1.html" target="_blank" rel="external">http://www.right.com.cn/forum/thread-137774-1-1.html</a><br>不死uboot的breed平台也可以备份key</p>
<p><strong>刷入不死uboot</strong><br><a href="http://bbs.hiwifi.com/forum.php?mod=viewthread&amp;tid=74992&amp;highlight=uboot" target="_blank" rel="external">http://bbs.hiwifi.com/forum.php?mod=viewthread&amp;tid=74992&amp;highlight=uboot</a><br>不死uboot下载：<a href="http://www.right.com.cn/forum/thread-161906-1-1.html" target="_blank" rel="external">http://www.right.com.cn/forum/thread-161906-1-1.html</a><br><a href="http://www.right.com.cn/forum/thread-171116-1-1.html" target="_blank" rel="external">http://www.right.com.cn/forum/thread-171116-1-1.html</a></p>
<hr>
<hr>
<h1 id="网件"><a href="#网件" class="headerlink" title="网件"></a>网件</h1><p>以前不知道网件是好东西，早就向往梅林固件了，大概知道网件有几款能刷梅林固件，在大天朝的长宽网络下，实在无法再忍受这种号称100M光纤，但实际使用只有512k猫一样的感觉，还是恶心的三层NAT，什么DDNS，到了这里还是死在了外面。不过<a href="http://koolshare.cn/portal.php" target="_blank" rel="external">koolshare论坛</a>有大神开发了DDNS穿透，通过一台中继服务器，好像什么DNS都能穿，有空要试试。</p>
<p>网件也可以刷DD，OpenWRT等等，但就界面来说，还是梅林比较漂亮。DD的亮点我还没找到，没怎么用过，Open的话多拨是个自成一派的东西。但是貌似Open的信号是稍微弱一点点的。</p>
<p>配置对比图，不过这里没有R8000，R8000是2USB，3频WiFi，双核1.0GHz<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/145246017.jpg" alt="mark"></p>
<p><strong>备份routerinfo</strong>参考：<br><a href="http://koolshare.cn/forum.php?mod=viewthread&amp;tid=73278&amp;highlight=routerinfo" target="_blank" rel="external">http://koolshare.cn/forum.php?mod=viewthread&amp;tid=73278&amp;highlight=routerinfo</a><br><a href="http://koolshare.cn/thread-44948-1-1.html" target="_blank" rel="external">http://koolshare.cn/thread-44948-1-1.html</a></p>
<hr>
<h2 id="R6700"><a href="#R6700" class="headerlink" title="R6700"></a>R6700</h2><p>R6700刷梅林<br><a href="http://www.acwifi.net/715.html" target="_blank" rel="external">http://www.acwifi.net/715.html</a><br><a href="http://www.good.cc/1242802.html" target="_blank" rel="external">http://www.good.cc/1242802.html</a></p>
<hr>
<h2 id="R8000"><a href="#R8000" class="headerlink" title="R8000"></a>R8000</h2><p>一般的刷固件之前都要先备份一下routerinfo,传统的备份方法是打开路由器ip/debug.htm就可以看到各种信息，或telnet连接路由，输入routerinfo就能出来各种信息。可能是R8000比较新，目前还没有办法备份出来。但是可以通过nvm把固件完整备份出来，不过方法是参照R6400的方法，不知道是不是一样适用（CPU架构不同）</p>
<p>备份方法：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">leolan@R8000<span class="number">-0000</span>:/dev<span class="meta"># cat /proc/mtd    #查看cfe设备</span></div><div class="line"><span class="symbol">dev:</span>    size   erasesize  name</div><div class="line"><span class="symbol">mtd0:</span> <span class="number">00080000</span> <span class="number">00020000</span> <span class="string">"boot"</span></div><div class="line"><span class="symbol">mtd1:</span> <span class="number">00180000</span> <span class="number">00020000</span> <span class="string">"nvram"</span></div><div class="line"><span class="symbol">mtd2:</span> <span class="number">04000000</span> <span class="number">00020000</span> <span class="string">"linux"</span></div><div class="line"><span class="symbol">mtd3:</span> <span class="number">03</span>c4c930 <span class="number">00020000</span> <span class="string">"rootfs"</span></div><div class="line"><span class="symbol">mtd4:</span> <span class="number">00040000</span> <span class="number">00020000</span> <span class="string">"board_data"</span></div><div class="line"><span class="symbol">mtd5:</span> <span class="number">04000000</span> <span class="number">00020000</span> <span class="string">"brcmnand"</span></div><div class="line"></div><div class="line"><span class="meta">#备份相应的区块</span></div><div class="line">dd if=<span class="meta-keyword">/dev/</span>mtd0 of=<span class="meta-keyword">/tmp/</span>cfe.bin     </div><div class="line">dd if=<span class="meta-keyword">/dev/</span>mtd1 of=<span class="meta-keyword">/tmp/</span>nvram.bin</div></pre></td></tr></table></figure></p>
<p>恢复：<br>打开命令窗口，重新Telnet到路由，输入用户名，然后是密码登录路由器，把文件上传到/tmp目录下，接着输入以下命令：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /tmp</div><div class="line">mtd write cfe<span class="selector-class">.bin</span> cfe</div><div class="line">mtd write nvram<span class="selector-class">.bin</span> nvram</div><div class="line">nvram commit</div><div class="line">reboot</div></pre></td></tr></table></figure></p>
<p>路由器会自动重启，完成CFE刷写，重新复位次就可看到效果了。</p>
<hr>
<h3 id="开刷"><a href="#开刷" class="headerlink" title="开刷"></a>开刷</h3><p>不过R8000目前刷没什么困难的。</p>
<p><strong>[固件发布] 【R8000】【20161209】380.63-2-X7.2.1 大爆炸</strong><br><a href="http://koolshare.cn/forum.php?mod=viewthread&amp;tid=73436&amp;highlight=R8000" target="_blank" rel="external">http://koolshare.cn/forum.php?mod=viewthread&amp;tid=73436&amp;highlight=R8000</a><br>我刷的时候梅林版本是第二次发布。</p>
<p><strong>官方刷梅林chk固件直刷 ,刷完英文直接拔电源重启，变中文再恢复出厂设置</strong><br>固件：<a href="http://firmware.koolshare.cn/merlin_8wan_firmware/R8000/Netgear%20R-series%20initial%20files/" target="_blank" rel="external">http://firmware.koolshare.cn/merlin_8wan_firmware/R8000/Netgear%20R-series%20initial%20files/</a></p>
<p><strong>第三方刷梅林trx固件直刷，刷完英文直接拔电源重启，变中文再恢复出厂设置</strong></p>
<p><strong>梅林刷官方OFW直刷，再捅菊花恢复出厂设置</strong><br>固件：<a href="http://firmware.koolshare.cn/merlin_8wan_firmware/R8000/Merlin%20to%20OFW/" target="_blank" rel="external">http://firmware.koolshare.cn/merlin_8wan_firmware/R8000/Merlin%20to%20OFW/</a></p>
<p>因为R8000是3频WiFi，也就是有两个5G芯片，频段是不同的，当然也可以3个WiFi合并为一个，自动分配频段，这样就不会拥挤了。</p>
<p><strong>信号合并SmartConnect优化</strong><br><a href="http://koolshare.cn/thread-73365-1-1.html" target="_blank" rel="external">http://koolshare.cn/thread-73365-1-1.html</a></p>
<hr>
<h2 id="网件路由救砖"><a href="#网件路由救砖" class="headerlink" title="网件路由救砖"></a>网件路由救砖</h2><p>官方救砖教程：<a href="http://club.netgear.cn/Knowledgebase/Document_detail.aspx?Did=873" target="_blank" rel="external">http://club.netgear.cn/Knowledgebase/Document_detail.aspx?Did=873</a><br>也可以使用华硕的固件修复程序：<strong>Firmware_Restoration</strong></p>
<p>官方救砖教程无效的话就要把螃蟹拆开来，上TTL线。<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/151747137.jpg" alt="mark"><br>用SecureCRT或者其他的终端连上去（有时某些终端是不支持一些功能的，比如xshell和putty的功能就互不相同，那就换一个终端）。</p>
<p><strong>开机不断Ctrl+C暂停设备启动，停止后，会停留在CFE命令行模式，您在模式下输入小写的help就可以看到各个命令的使用方法</strong></p>
<p>在shell中输入<strong>tftpd</strong>（R8000的tftpd并不会自动启动，所以那些不用串口线卡时间刷netgear的教程根本没用），然后就直接在本机配ip，网关192.168.1.1，命令行输tftp，binary模式，put一个新固件上去。</p>
<p>其他救砖教程：<br><a href="http://koolshare.cn/thread-42961-1-1.html" target="_blank" rel="external">http://koolshare.cn/thread-42961-1-1.html</a><br><a href="http://koolshare.cn/thread-44948-1-1.html" target="_blank" rel="external">http://koolshare.cn/thread-44948-1-1.html</a><br><a href="http://www.expreview.com/33689-2.html" target="_blank" rel="external">http://www.expreview.com/33689-2.html</a></p>
<hr>
<h1 id="梅林系统"><a href="#梅林系统" class="headerlink" title="梅林系统"></a>梅林系统</h1><p>梅林系统有<a href="http://asuswrt.lostrealm.ca/" target="_blank" rel="external">官方固件</a>和民间固件，官方固件是专门为华硕路由定制的，但是华硕的好多机型和网件的机型配置基本是一致的，可以方便的移植过来。民间固件目前机型比较完善的是<a href="http://firmware.koolshare.cn/" target="_blank" rel="external">koolshare论坛</a>，<a href="http://www.right.com.cn/forum/forum.php" target="_blank" rel="external">恩山论坛</a>，<a href="http://www.anywlan.com/" target="_blank" rel="external">无线论坛</a><br>KS论坛支持的机型是最多的，恩山论坛中低端路由支持贴比较多。</p>
<p><a href="http://koolshare.cn/thread-4602-1-1.html" target="_blank" rel="external">Koolshare固件指南 &amp; FAQ，新人浏览观看</a></p>
<p>梅林固件是这样子的<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/154859008.png" alt="mark"><br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20170105/155001133.png" alt="mark"></p>
<p>插件的使用比较简单，而且也有链接说明，是比较人性化的定制，之后有什么比较好玩的再更新博客！</p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;说起路由器，回想起以前折腾路由的日子，不对，现在依然在折腾。不过，我折腾过
    
    </summary>
    
      <category term="路由" scheme="https://www.leolan.top/categories/%E8%B7%AF%E7%94%B1/"/>
    
    
      <category term="不仅仅是一个路由器" scheme="https://www.leolan.top/tags/%E4%B8%8D%E4%BB%85%E4%BB%85%E6%98%AF%E4%B8%80%E4%B8%AA%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Shell编程入门</title>
    <link href="https://www.leolan.top/posts/40666/"/>
    <id>https://www.leolan.top/posts/40666/</id>
    <published>2016-12-18T03:32:37.000Z</published>
    <updated>2017-02-27T08:47:33.048Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="在实验楼（当然还在其他网站看了很多教程）学习整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ-･∀･-ﾉ-●"><a href="#在实验楼（当然还在其他网站看了很多教程）学习整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ-･∀･-ﾉ-●" class="headerlink" title="在实验楼（当然还在其他网站看了很多教程）学习整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ|･∀･|ﾉ*~●"></a>在实验楼（当然还在其他网站看了很多教程）学习整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ|･∀･|ﾉ*~●</h1><hr>
<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p><strong>grep命令用于打印输出文本中匹配的模式串</strong>，它使用正则表达式作为模式匹配的条件。grep支持三种<strong>正则表达式引擎</strong>，分别用三个参数指定：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-E</td>
<td>POSIX扩展正则表达式，ERE</td>
</tr>
<tr>
<td>-G</td>
<td>POSIX基本正则表达式，BRE</td>
</tr>
<tr>
<td>-P</td>
<td>Perl正则表达式，PCRE</td>
</tr>
</tbody>
</table>
<p>普通参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-b</td>
<td>将二进制文件作为文本来进行匹配</td>
</tr>
<tr>
<td>-c</td>
<td>统计以模式匹配的数目</td>
</tr>
<tr>
<td>-i</td>
<td>忽略大小写</td>
</tr>
<tr>
<td>-n</td>
<td>显示匹配文本所在行的行号</td>
</tr>
<tr>
<td>-v</td>
<td>反选，输出不匹配行的内容</td>
</tr>
<tr>
<td>-r</td>
<td>递归匹配查找</td>
</tr>
<tr>
<td>-A n</td>
<td>n为正整数，表示after的意思，除了列出匹配行之外，还列出后面的n行</td>
</tr>
<tr>
<td>-B n</td>
<td>n为正整数，表示before的意思，除了列出匹配行之外，还列出前面的n行</td>
</tr>
<tr>
<td>--color=auto</td>
<td>将输出中的匹配项设置为自动颜色显示</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注：在大多数发行版中是默认设置了grep的颜色的，你可以通过参数指定或修改<strong>GREP_COLOR</strong>环境变量。</p>
</blockquote>
<h3 id="使用基本正则表达式，BRE"><a href="#使用基本正则表达式，BRE" class="headerlink" title="使用基本正则表达式，BRE"></a>使用基本正则表达式，BRE</h3><p><strong>位置：</strong><br><figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">grep</span> <span class="string">'mail'</span> /etc/group    <span class="comment">#过滤出所有含mail字符串的行</span></div><div class="line"><span class="keyword">grep</span> <span class="string">'^mail'</span> /etc/group   <span class="comment">#过滤出以mail开头的行</span></div><div class="line"></div><div class="line">echo <span class="string">'geek|good'</span> | <span class="keyword">grep</span> <span class="string">'[^o]'</span>    <span class="comment"># 排除字符</span></div><div class="line"><span class="comment">#注意:当^放到[中括号内]为排除字符，否则表示行首。</span></div></pre></td></tr></table></figure></p>
<hr>
<p><strong>数量：</strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># \n是换行符</div><div class="line"># 将匹配以<span class="string">'z'</span>开头以<span class="string">'o'</span>结尾的所有字符串</div><div class="line"><span class="keyword">echo</span> <span class="string">'zero\nzo\nzoo'</span> | <span class="keyword">grep</span> <span class="string">'z.*o'</span></div><div class="line"></div><div class="line"># 将匹配以<span class="string">'z'</span>开头以<span class="string">'o'</span>结尾，中间包含一个任意字符的字符串</div><div class="line"><span class="keyword">echo</span> <span class="string">'zero\nzo\nzoo'</span> | <span class="keyword">grep</span> <span class="string">'z.o'</span></div><div class="line"></div><div class="line"># 将匹配以<span class="string">'z'</span>开头,以任意多个<span class="string">'o'</span>结尾的字符串</div><div class="line"><span class="keyword">echo</span> <span class="string">'zero\nzo\nzoo'</span> | <span class="keyword">grep</span> <span class="string">'zo*'</span></div></pre></td></tr></table></figure></p>
<hr>
<p><strong>选择：</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># grep默认是区分大小写的，这里将匹配所有的小写字母</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[a-z]'</span></div><div class="line"></div><div class="line"><span class="comment"># 将匹配所有的数字</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[0-9]'</span></div><div class="line"></div><div class="line"><span class="comment"># 将匹配所有的数字</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[[:digit:]]'</span></div><div class="line"></div><div class="line"><span class="comment"># 将匹配所有的小写字母</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[[:lower:]]'</span></div><div class="line"></div><div class="line"><span class="comment"># 将匹配所有的大写字母</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[[:upper:]]'</span></div><div class="line"></div><div class="line"><span class="comment"># 将匹配所有的字母和数字，包括0-9,a-z,A-Z</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[[:alnum:]]'</span></div><div class="line"></div><div class="line"><span class="comment"># 将匹配所有的字母</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'1234\nabcd'</span> | grep <span class="string">'[[:alpha:]]'</span></div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>特殊符号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[:alnum:]</td>
<td>代表英文大小写字节及数字，亦即 0-9, A-Z, a-z</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>代表任何英文大小写字节，亦即 A-Z, a-z</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>代表空白键与 [Tab] 按键两者</td>
</tr>
<tr>
<td>[:cntrl:]</td>
<td>代表键盘上面的控制按键，亦即包括 CR, LF, Tab, Del.. 等等</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>代表数字而已，亦即 0-9</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>除了空白字节 (空白键与 [Tab] 按键) 外的其他所有按键</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>代表小写字节，亦即 a-z</td>
</tr>
<tr>
<td>[:print:]</td>
<td>代表任何可以被列印出来的字节</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>代表标点符号 (punctuation symbol)，亦即：” ‘ ? ! ; : # $…</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>代表大写字节，亦即 A-Z</td>
</tr>
<tr>
<td>[:space:]</td>
<td>任何会产生空白的字节，包括空白键, [Tab], CR 等等</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>代表 16 进位的数字类型，因此包括： 0-9, A-F, a-f 的数字与字节</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意：之所以要使用特殊符号，是因为上面的[a-z]不是在所有情况下都管用，这还与主机当前的语系有关，即设置在LANG环境变量的值，zh_CN.UTF-8的话[a-z]，即为所有小写字母，其它语系可能是大小写交替的如，”a A b B…z Z”，[a-z]中就可能包含大写字母。所以在使用[a-z]时请确保当前语系的影响，使用[:lower:]则不会有这个问题。</p>
</blockquote>
<hr>
<h3 id="使用扩展正则表达式，ERE"><a href="#使用扩展正则表达式，ERE" class="headerlink" title="使用扩展正则表达式，ERE"></a>使用扩展正则表达式，ERE</h3><p>要通过grep使用扩展正则表达式需要加上<strong>-E</strong>参数，或使用egrep。</p>
<p><strong>数量:</strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 只匹配<span class="string">"zo"</span></div><div class="line"><span class="keyword">echo</span> <span class="string">'zero\nzo\nzoo'</span> | <span class="keyword">grep</span> -E <span class="string">'zo&#123;1&#125;'</span></div><div class="line"># 匹配以<span class="string">"zo"</span>开头的所有单词</div><div class="line"><span class="keyword">echo</span> <span class="string">'zero\nzo\nzoo'</span> | <span class="keyword">grep</span> -E <span class="string">'zo&#123;1,&#125;'</span></div></pre></td></tr></table></figure></p>
<p>注意：推荐掌握<strong>{n,m}</strong>即可，+,?,*，这几个不太直观，且容易弄混淆。</p>
<hr>
<p><strong>选择:</strong><br><figure class="highlight sml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 匹配<span class="string">"www.baidu.com"</span>和<span class="string">"www.google.com"</span></div><div class="line">echo <span class="symbol">'www</span>.leolan.top\nwww.baidu.com\nwww.google.com' | grep -<span class="type">E</span> <span class="symbol">'www</span>\.(baidu|google)\.com'</div><div class="line"># 或者匹配不包含<span class="string">"baidu"</span>的内容</div><div class="line">echo <span class="symbol">'www</span>.leolan.top\nwww.baidu.com\nwww.google.com' | grep -<span class="type">Ev</span> <span class="symbol">'www</span>\.baidu\.com'</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：因为<strong>.号有特殊含义</strong>，所以需要转义。</p>
</blockquote>
<p>正则表达式和grep命令的内容就介绍这么多，下面两个更强大的工具sed和awk，因为这两个工具的强大，无法包含全部内容，只做基本介绍。</p>
<hr>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><p><strong>sed 流编辑器</strong>;在 man 手册里面的全名为”sed - stream editor for filtering and transforming text “，意即，<strong>用于过滤和转换文本的流编辑器</strong>。</p>
<p>在 Linux/UNIX 的世界里敢称为编辑器的工具，大都非等闲之辈，比如前面的”vi/vim(编辑器之神)”,”emacs(神的编辑器)”,”gedit”这些个编辑器。sed与上述的最大不同之处在于它是一个非交互式的编辑器。</p>
<h3 id="sed-命令基本格式"><a href="#sed-命令基本格式" class="headerlink" title="sed 命令基本格式"></a>sed 命令基本格式</h3><figure class="highlight prolog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sed [参数]... [执行命令] [输入文件]...</div><div class="line"># 形如：</div><div class="line">sed -i <span class="string">'1s/sad/happy/'</span> test # 表示将test文件中第一行的<span class="string">"sad"</span>替换为<span class="string">"happy"</span></div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>安静模式，只打印受影响的行，默认打印输入数据的全部内容</td>
</tr>
<tr>
<td>-e</td>
<td>用于在脚本中添加多个执行命令一次执行，在命令行中执行多个命令通常不需要加该参数</td>
</tr>
<tr>
<td>-f</td>
<td>filename    指定执行filename文件中的命令</td>
</tr>
<tr>
<td>-r</td>
<td>使用扩展正则表达式，默认为标准正则表达式</td>
</tr>
<tr>
<td>-i</td>
<td>将直接修改输入文件内容，而不是打印到标准输出设备</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="sed执行命令格式"><a href="#sed执行命令格式" class="headerlink" title="sed执行命令格式"></a>sed执行命令格式</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[<span class="string">n1</span>][<span class="symbol">,n2</span>]command</div><div class="line">[<span class="string">n1</span>][<span class="symbol">~step</span>]command</div><div class="line"><span class="section"># 其中一些命令可以在后面加上作用范围，形如：</span></div><div class="line">sed -i 's/sad/happy/g' test # g表示全局范围</div><div class="line">sed -i 's/sad/happy/4' test # 4表示指定行中的第四个匹配字符串</div></pre></td></tr></table></figure>
<p>其中n1,n2表示输入内容的行号，它们之间为,逗号则表示从n1到n2行，如果为～波浪号则表示从n1开始以step为步进的所有行；command为执行动作，下面为一些常用动作指令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>s</td>
<td>行内替换</td>
</tr>
<tr>
<td>c</td>
<td>整行替换</td>
</tr>
<tr>
<td>a</td>
<td>插入到指定行的后面</td>
</tr>
<tr>
<td>i</td>
<td>插入到指定行的前面</td>
</tr>
<tr>
<td>p</td>
<td>打印指定行，通常与-n参数配合使用</td>
</tr>
<tr>
<td>d</td>
<td>删除指定行</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="sed操作举例"><a href="#sed操作举例" class="headerlink" title="sed操作举例"></a>sed操作举例</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cp /etc/passwd ~</div><div class="line"></div><div class="line"># 打印<span class="number">2</span><span class="number">-5</span>行</div><div class="line">nl passwd | sed -n '<span class="number">2</span>,<span class="number">5</span>p'</div><div class="line"># 打印奇数行</div><div class="line">nl passwd | sed -n '<span class="number">1</span>~<span class="number">2</span>p'</div></pre></td></tr></table></figure>
<p><strong>行内替换</strong><br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 将输入文本中<span class="string">"shiyanlou"</span> 全局替换为<span class="string">"hehe"</span>,并只打印替换的那一行，注意这里不能省略最后的<span class="string">"p"</span>命令</span></div><div class="line">sed -n <span class="string">'s/shiyanlou/hehe/gp'</span> passwd</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意： 行内替换可以结合正则表达式使用。</p>
</blockquote>
<p><strong>行间替换</strong><br><figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">nl passwd | <span class="keyword">grep</span> <span class="string">"leolan"</span></div><div class="line"><span class="comment"># 删除第21行</span></div><div class="line">sed -n <span class="string">'21c\www.leolan.top'</span> passwd</div></pre></td></tr></table></figure></p>
<p>参考链接：</p>
<ul>
<li><a href="http://coolshell.cn/articles/9104.html" target="_blank" rel="external">sed简明教程</a></li>
<li><a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" rel="external">sed单行脚本快速参考</a></li>
<li><a href="http://www.gnu.org/software/sed/manual/sed.html" target="_blank" rel="external">sed完全手册(英文)</a></li>
</ul>
<hr>
<h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><blockquote>
<p>AWK是一种优良的文本处理工具，Linux及Unix环境中现有的功能最强大的数据处理引擎之一.其名称得自于它的创始人Alfred Aho（阿尔佛雷德·艾侯）、Peter Jay Weinberger（彼得·温伯格）和Brian Wilson Kernighan（布莱恩·柯林汉)姓氏的首个字母.AWK程序设计语言，三位创建者已将它正式定义为“样式扫描和处理语言”。它允许您创建简短的程序，这些程序读取输入文件、为数据排序、处理数据、对输入执行计算以及生成报表，还有无数其他的功能。最简单地说，AWK是一种用于处理文本的编程语言工具。</p>
</blockquote>
<hr>
<h3 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h3><p>awk所有的操作都是基于pattern(模式)—action(动作)对来完成的，如下面的形式：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">pattern</span> &#123;action&#125;</div></pre></td></tr></table></figure></p>
<p>你可以看到就如同很多编程语言一样，它将所有的动作操作用一对<strong>{}</strong>花括号包围起来。其中pattern通常是是表示用于匹配输入的文本的“关系式”或“正则表达式”，action则是表示匹配后将执行的动作。在一个完整awk操作中，这两者可以只有其中一个，如果没有pattern则默认匹配输入的全部文本，如果没有action则默认为打印匹配内容到屏幕。</p>
<p><strong>awk</strong>处理文本的方式，是将文本分割成一些“字段”，然后再对这些字段进行处理，默认情况下，awk以<strong>空格</strong>作为一个字段的分割符，不过这不是固定了，你可以任意指定分隔符，下面将告诉你如何做到这一点。<br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk [-<span class="symbol">F</span> fs] [-v var=value] [-f prog-file | <span class="string">'program text'</span>] [file...]</div></pre></td></tr></table></figure></p>
<p>其中<strong>-F</strong>参数用于预先指定前面提到的字段分隔符（还有其他指定字段的方式） ，-v用于预先为awk程序指定变量，-f参数用于指定awk命令要执行的程序文件，或者在不加-f参数的情况下直接将程序语句放在这里，最后为awk需要处理的文本输入，且可以同时输入多个文本文件。</p>
<hr>
<h3 id="awk操作"><a href="#awk操作" class="headerlink" title="awk操作"></a>awk操作</h3><p><strong>将文本内容打印到终端</strong><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">touch <span class="keyword">test</span>.txt &amp;&amp; echo <span class="string">"I like linux"</span> &gt;&gt; <span class="keyword">test</span>.txt &amp;&amp; echo <span class="string">"www.leolan.top"</span> &gt;&gt; <span class="keyword">test</span>.txt</div><div class="line"></div><div class="line"># <span class="string">"quote&gt;"</span> 不用输入</div><div class="line">awk '&#123;</div><div class="line">&gt; <span class="keyword">print</span></div><div class="line">&gt; &#125;' <span class="keyword">test</span>.txt</div><div class="line"># 或者写成一行</div><div class="line">awk '&#123;<span class="keyword">print</span>&#125;' <span class="keyword">test</span>.txt</div></pre></td></tr></table></figure></p>
<p>说明:在这个操作中省略了<strong>patter</strong>，所以awk会默认匹配输入文本的全部内容，然后在”{}”花括号中执行动作，即print打印所有匹配项，这里是全部文本内容</p>
<hr>
<p><strong>将test.txt的第一行的每个字段单独显示为一行</strong><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">awk '&#123;</div><div class="line">&gt; <span class="keyword">if</span>(NR==1)&#123;</div><div class="line">&gt; <span class="keyword">print</span> <span class="variable">$1</span> <span class="string">"\n"</span> <span class="variable">$2</span> <span class="string">"\n"</span> <span class="variable">$3</span></div><div class="line">&gt; &#125; <span class="keyword">else</span> &#123;</div><div class="line">&gt; <span class="keyword">print</span>&#125;</div><div class="line">&gt; &#125;' <span class="keyword">test</span>.txt</div><div class="line"></div><div class="line"># 或者</div><div class="line">awk '&#123;</div><div class="line">&gt; <span class="keyword">if</span>(NR==1)&#123;</div><div class="line">&gt; OFS=<span class="string">"\n"</span></div><div class="line">&gt; <span class="keyword">print</span> <span class="variable">$1</span>, <span class="variable">$2</span>, <span class="variable">$3</span></div><div class="line">&gt; &#125; <span class="keyword">else</span> &#123;</div><div class="line">&gt; <span class="keyword">print</span>&#125;</div><div class="line">&gt; &#125;' <span class="keyword">test</span>.txt</div></pre></td></tr></table></figure></p>
<p>说明:这里使用了awk语言的分支选择语句if,它的使用和很多高级语言如C/C++语言基本一致，如果你有这些语言的基础，这里将很好理解。另一个你需要注意的是<strong>NR与OFS</strong>，这两个是awk内建的变量，<strong>NR表示当前读入的记录数</strong>，你可以简单的理解为当前处理的行数，<strong>OFS表示输出时的字段分隔符</strong>，默认为<strong>“ “</strong>空格，用OFS将字段分隔符设置为<strong>\n</strong>换行符，所以第一行原本以空格为字段分隔的内容就分别输出到单独一行了。<br>然后是<strong>$N</strong>其中N为相应的字段号，这也是awk的内建变量，它<strong>表示引用相应的字段</strong>，因为第一行只有三个字段，所以只引用到了$3。除此之外另一个这里没有出现的<strong>$0</strong>，它<strong>表示引用当前记录（当前行）的全部内容</strong>。</p>
<hr>
<p><strong>将test的第二行的以点为分段的字段换成以空格为分隔</strong><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">awk -F'.' '&#123;</div><div class="line">&gt; <span class="keyword">if</span>(NR==2)&#123;</div><div class="line">&gt; <span class="keyword">print</span> <span class="variable">$1</span> <span class="string">"\t"</span> <span class="variable">$2</span> <span class="string">"\t"</span> <span class="variable">$3</span></div><div class="line">&gt; &#125;&#125;' <span class="keyword">test</span>.txt</div><div class="line"></div><div class="line"># 或者</div><div class="line">awk '</div><div class="line">&gt; BEGIN&#123;</div><div class="line">&gt; FS=<span class="string">"."</span></div><div class="line">&gt; OFS=<span class="string">"\t"</span>  # 如果写为一行，两个动作语句之间应该以<span class="string">";"</span>号分开  </div><div class="line">&gt; &#125;&#123;</div><div class="line">&gt; <span class="keyword">if</span>(NR==2)&#123;</div><div class="line">&gt; <span class="keyword">print</span> <span class="variable">$1</span>, <span class="variable">$2</span>, <span class="variable">$3</span></div><div class="line">&gt; &#125;&#125;' <span class="keyword">test</span>.txt</div></pre></td></tr></table></figure></p>
<p>说明：这里的<strong>-F</strong>参数，它是用来<strong>预先指定待处理记录的字段分隔符</strong>。除了指定OFS还可以在print 语句中直接打印特殊符号如这里的\t，<strong>print打印的非变量内容都需要用””一对引号包围起来</strong>。第二种方法中实现预先指定变量分隔符的另一种方式，即使用<strong>BEGIN</strong>，就这个表达式指示了，<strong>其后的动作将在所有动作之前执行，这里是FS赋值了新的”.”点号代替默认的” “空格</strong></p>
<hr>
<h3 id="awk常用的内置变量"><a href="#awk常用的内置变量" class="headerlink" title="awk常用的内置变量"></a>awk常用的内置变量</h3><table>
<thead>
<tr>
<th>变量名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>FILENAME</td>
<td>当前输入文件名，若有多个文件，则只表示第一个。如果输入是来自标准输入，则为空字符串</td>
</tr>
<tr>
<td>$0</td>
<td>当前记录的内容</td>
</tr>
<tr>
<td>$N</td>
<td>N表示字段号，最大值为NF变量的值</td>
</tr>
<tr>
<td>FS</td>
<td>字段分隔符，由正则表达式表示，默认为” “空格</td>
</tr>
<tr>
<td>RS</td>
<td>输入记录分隔符，默认为”\n”，即一行为一个记录</td>
</tr>
<tr>
<td>NF</td>
<td>当前记录字段数</td>
</tr>
<tr>
<td>NR</td>
<td>已经读入的记录数</td>
</tr>
<tr>
<td>FNR</td>
<td>当前输入文件的记录数，请注意它与NR的区别</td>
</tr>
<tr>
<td>OFS</td>
<td>输出字段分隔符，默认为” “空格</td>
</tr>
<tr>
<td>ORS</td>
<td>输出记录分隔符，默认为”\n”</td>
</tr>
</tbody>
</table>
<p>参考资料：</p>
<ul>
<li><a href="http://awk.readthedocs.io/en/latest/chapter-one.html" target="_blank" rel="external">awk程序设计语言</a></li>
<li><a href="http://coolshell.cn/articles/9070.html" target="_blank" rel="external">awk简明教程</a></li>
<li><a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="external">awk用户指南(英文)</a></li>
</ul>
<hr>
<hr>
<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><blockquote>
<p>正则表达式，又称正规表示式、正规表示法、正规表达式、规则表达式、常规表示法（英语：Regular Expression，在代码中常简写为 regex、regexp 或 RE），计算机科学的一个概念。正则表达式使用单个字符串来描述、匹配一系列符合某个句法规则的字符串。在很多文本编辑器里，正则表达式通常被用来检索、替换那些符合某个模式的文本。</p>
</blockquote>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>一个正则表达式通常被称为一个模式（pattern），为用来描述或者匹配一系列符合某个句法规则的字符串。</p>
<h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><p><strong>|</strong>竖直分隔符表示选择，例如”boy|girl”可以匹配”boy”或者”girl”</p>
<h3 id="数量限定"><a href="#数量限定" class="headerlink" title="数量限定"></a>数量限定</h3><p>数量限定除了我们举例用的*,还有+加号,?问号,如果在一个模式中不加数量限定符则表示出现一次且仅出现一次：</p>
<ul>
<li><strong>+表示</strong>：前面的字符必须出现至少一次(1次或多次)，例如，”goo+gle”,可以匹配”gooogle”,”goooogle”等；</li>
<li><strong>?表示</strong>：前面的字符最多出现一次(0次或1次)，例如，”colou?r”,可以匹配”color”或者”colour”;</li>
<li><strong>*星号</strong>：代表前面的字符可以不出现，也可以出现一次或者多次（0次、或1次、或多次），例如，“0*42”可以匹配42、042、0042、00042等。</li>
</ul>
<h3 id="范围和优先级"><a href="#范围和优先级" class="headerlink" title="范围和优先级"></a>范围和优先级</h3><p><strong>()圆括号</strong>：可以用来定义模式字符串的范围和优先级，这可以简单的理解为是否将括号内的模式串作为一个整体。例如，”gr(a|e)y”等价于”gray|grey”，（这里体现了优先级，竖直分隔符用于选择a或者e而不是gra和ey），”(grand)?father”匹配father和grandfather（这里体验了范围，<strong>?</strong>将圆括号内容作为一个整体匹配）。</p>
<h3 id="语法-少部分"><a href="#语法-少部分" class="headerlink" title="语法(少部分)"></a>语法(少部分)</h3><p>正则表达式有多种不同的风格，下面列举一些常用的作为 <strong>PCRE 子集</strong>的适用于<strong>perl</strong>和<strong>python</strong>编程语言及<strong>grep</strong>或<strong>egrep</strong>的正则表达式匹配规则</p>
<blockquote>
<p>PCRE（Perl Compatible Regular Expressions中文含义：perl语言兼容正则表达式）是一个用 C 语言编写的正则表达式函数库，由菲利普.海泽(Philip Hazel)编写。PCRE是一个轻量级的函数库，比Boost 之类的正则表达式库小得多。PCRE 十分易用，同时功能也很强大，性能超过了 POSIX 正则表达式库和一些经典的正则表达式库。</p>
</blockquote>
<table>
<thead>
<tr>
<th>字符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>\</td>
<td>将下一个字符标记为一个特殊字符、或一个原义字符。例如，“n”匹配字符“n”。“\n”匹配一个换行符。序列“\”匹配“\”而“(”则匹配“(”。</td>
</tr>
<tr>
<td>^</td>
<td>匹配输入字符串的开始位置。</td>
</tr>
<tr>
<td>$</td>
<td>匹配输入字符串的结束位置。</td>
</tr>
<tr>
<td>{n}</td>
<td>n是一个非负整数。匹配确定的n次。例如，“o{2}”不能匹配“Bob”中的“o”，但是能匹配“food”中的两个o。</td>
</tr>
<tr>
<td>{n,}</td>
<td>n是一个非负整数。至少匹配n次。例如，“o{2,}”不能匹配“Bob”中的“o”，但能匹配“foooood”中的所有o。“o{1,}”等价于“o+”。“o{0,}”则等价于“o*”。</td>
</tr>
<tr>
<td>{n,m}</td>
<td>m和n均为非负整数，其中n&lt;=m。最少匹配n次且最多匹配m次。例如，“o{1,3}”将匹配“fooooood”中的前三个o。“o{0,1}”等价于“o?”。请注意在逗号和两个数之间不能有空格。</td>
</tr>
<tr>
<td>*</td>
<td><strong>匹配前面的子表达式零次或多次。</strong>例如，zo<em>能匹配“z”、“zo”以及“zoo”。</em>等价于{0,}。</td>
</tr>
<tr>
<td>+</td>
<td><strong>匹配前面的子表达式一次或多次。</strong>例如，“zo+”能匹配“zo”以及“zoo”，但不能匹配“z”。+等价于{1,}。</td>
</tr>
<tr>
<td>?</td>
<td><strong>匹配前面的子表达式零次或一次。</strong>例如，“do(es)?”可以匹配“do”或“does”中的“do”。?等价于{0,1}。</td>
</tr>
<tr>
<td>?</td>
<td>当该字符紧跟在任何一个其他限制符（*,+,?，{n}，{n,}，{n,m}）后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串“oooo”，“o+?”将匹配单个“o”，而“o+”将匹配所有“o”。</td>
</tr>
<tr>
<td>.</td>
<td>匹配除“\n”之外的任何单个字符。要匹配包括“\n”在内的任何字符，请使用像“(.｜\n)”的模式。</td>
</tr>
<tr>
<td>(pattern)</td>
<td>匹配pattern并获取这一匹配的子字符串。该子字符串用于向后引用。要匹配圆括号字符，请使用“(”或“)”。</td>
</tr>
<tr>
<td>x｜y</td>
<td>匹配x或y。例如，“z｜food”能匹配“z”或“food”。“(z｜f)ood”则匹配“zood”或“food”。</td>
</tr>
<tr>
<td>[xyz]</td>
<td>字符集合（character class）。匹配所包含的任意一个字符。例如，“[abc]”可以匹配“plain”中的“a”。其中特殊字符仅有反斜线\保持特殊含义，用于转义字符。其它特殊字符如星号、加号、各种括号等均作为普通字符。脱字符^如果出现在首位则表示负值字符集合；如果出现在字符串中间就仅作为普通字符。连字符 - 如果出现在字符串中间表示字符范围描述；如果如果出现在首位则仅作为普通字符。</td>
</tr>
<tr>
<td>[^xyz]</td>
<td>排除型（negate）字符集合。匹配未列出的任意字符。例如，“[^abc]”可以匹配“plain”中的“plin”。</td>
</tr>
<tr>
<td>[a-z]</td>
<td>字符范围。匹配指定范围内的任意字符。例如，“[a-z]”可以匹配“a”到“z”范围内的任意小写字母字符。</td>
</tr>
<tr>
<td>[^a-z]</td>
<td>排除型的字符范围。匹配任何不在指定范围内的任意字符。例如，“[^a-z]”可以匹配任何不在“a”到“z”范围内的任意字符。</td>
</tr>
</tbody>
</table>
<p>参考WiKi：<a href="https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="external">正则表达式</a></p>
<hr>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p>优先级为从上到下从左到右，依次降低：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>\</td>
<td>转义符</td>
</tr>
<tr>
<td>(), (?:), (?=), []</td>
<td>括号和中括号</td>
</tr>
<tr>
<td>*、+、?、{n}、{n,}、{n,m}</td>
<td>限定符</td>
</tr>
<tr>
<td>^、$、\任何元字符</td>
<td>定位点和序列</td>
</tr>
<tr>
<td>｜</td>
<td>　选择</td>
</tr>
</tbody>
</table>
<hr>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;在实验楼（当然还在其他网站看了很多教程）学习整理的一些笔记，目前
    
    </summary>
    
      <category term="Shell" scheme="https://www.leolan.top/categories/Shell/"/>
    
    
      <category term="Shell编程入门" scheme="https://www.leolan.top/tags/Shell%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>Python入门</title>
    <link href="https://www.leolan.top/posts/21062/"/>
    <id>https://www.leolan.top/posts/21062/</id>
    <published>2016-12-18T03:32:15.000Z</published>
    <updated>2017-02-27T08:47:33.047Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1 id="学习廖雪峰老师的博客整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ-･∀･-ﾉ-●"><a href="#学习廖雪峰老师的博客整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ-･∀･-ﾉ-●" class="headerlink" title="学习廖雪峰老师的博客整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ|･∀･|ﾉ*~●"></a>学习廖雪峰老师的博客整理的一些笔记，目前还很凌乱，很惭愧，还没有掌握知识，大脑中还没有一个清晰的思路，之后会不断的学习和完善ﾍ|･∀･|ﾉ*~●</h1><hr>
<h1 id="安装Python"><a href="#安装Python" class="headerlink" title="安装Python"></a>安装Python</h1><p>官网：www.python.org</p>
<h2 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h2><p>系统是OS X 10.8~10.10，那么系统自带的Python版本是2.7。要安装最新的Python 3.5，有两个方法：<br>方法一：从Python官网下载Python 3.5的<a href="https://www.python.org/ftp/python/3.5.0/python-3.5.0-macosx10.6.pkg" target="_blank" rel="external">安装程序</a>，双击运行并安装；<br>方法二：如果安装了Homebrew，直接通过命令<code>brew install python3</code>安装即可。</p>
<hr>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>从Python的官方网站下载Python 3.5对应的<a href="https://www.python.org/ftp/python/3.5.0/python-3.5.0-amd64.exe" target="_blank" rel="external">64位安装程序</a>或<a href="https://www.python.org/ftp/python/3.5.0/python-3.5.0.exe" target="_blank" rel="external">32位安装程序</a><br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/125905986.png" alt="mark"></p>
<p>特别要注意勾上<strong>Add Python 3.5 to PATH</strong>，然后点“Install Now”即可完成安装。<br>不打勾则需要自己设置环境变量。</p>
<hr>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>安装2.X版本<br><code>yum install python -y</code></p>
<p><strong>Ubuntu</strong>自带有</p>
<p>安装3.X版本<br><code>yum install python3 -y</code>    (部分源可以这样安装)<br>源码编译通用：<br>版本选择：<strong><a href="https://www.python.org/ftp/python/" target="_blank" rel="external">https://www.python.org/ftp/python/</a></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> gcc cmake -y        </div><div class="line">apt-<span class="keyword">get</span>  <span class="keyword">install</span> gcc cmake   #一般Ubuntu自带了</div><div class="line">wget <span class="keyword">http</span>://www.python.org/<span class="keyword">ftp</span>/python/<span class="number">3.3</span><span class="number">.0</span>/Python<span class="number">-3.3</span><span class="number">.0</span>.tgz</div><div class="line">tar -zxvf Python<span class="number">-3.3</span><span class="number">.0</span>.tgz</div><div class="line">cd Python<span class="number">-3.3</span><span class="number">.0</span></div></pre></td></tr></table></figure></p>
<p>在编译前先在<strong>/usr/local</strong>建一个文件夹<strong>python3</strong>（作为python的安装路径，以免覆盖老的版本）<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/<span class="keyword">local</span>/python3</div><div class="line">./configure --prefix=/usr/<span class="keyword">local</span>/python3    (指定安装路径，不指定则覆盖老版本)</div><div class="line"><span class="built_in">make</span> &amp;&amp; <span class="built_in">make</span> install</div><div class="line"><span class="meta">#Ubuntu不用进行以下设置，自动添加变量路径了。</span></div></pre></td></tr></table></figure></p>
<p>覆盖老版本(有需要可以这样做，也可以不覆盖，共存)<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mv <span class="regexp">/usr/</span>bin<span class="regexp">/python /u</span>sr<span class="regexp">/bin/</span>python_old</div><div class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/python3/</span>bin<span class="regexp">/python3 /u</span>sr<span class="regexp">/bin/</span>python     <span class="comment">#（建立软连接）</span></div></pre></td></tr></table></figure></p>
<p>此时运行python的是新版本，老版本要使用命令/usr/bin/python_old才能运行。<br>双版本自由切换（增加Python3的用户变量）：<code>vim ~/.bash_profile</code><br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/python3/bin/</span></div><div class="line">source .bash_profile      <span class="comment">#(立刻生效)</span></div></pre></td></tr></table></figure></p>
<p>如果是<code>export PATH=&quot;$var_PATH&quot;</code>  则只在当前shell有效，一旦关闭就失效了。<br>此时可以自由运行Python或Python3<br><code>rm -rf ~/Python*</code><br>OK安装完成。</p>
<hr>
<p>Python解释器：<br><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143161198846783e33de56d4041058c3dfc7e44ee1203000" target="_blank" rel="external">http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143161198846783e33de56d4041058c3dfc7e44ee1203000</a></p>
<hr>
<hr>
<h1 id="python基础"><a href="#python基础" class="headerlink" title="python基础"></a>python基础</h1><h2 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h2><p>Python提供了一个<strong>input()</strong>，可以让用户输入字符串，并存放到一个变量里。<br>当你输入<code>name = input()</code>并按下回车后，Python交互式命令行就在等待你的输入了。这时，你可以输入任意字符，然后按回车后完成输入。<br>输入完成后，不会有任何提示，Python交互式命令行又回到<strong>&gt;&gt;&gt;</strong>状态了。输入name可以直接查看变量内容：<br>例：<code>name = input(&#39;please input your name:&#39;)</code>   (此时输入姓名后是把姓名输入到变量name中，如果再让<strong>n＝name</strong>的话，在&gt;&gt;&gt;状态下输入n，显示的是就是姓名，当然print(‘hello , ‘,name)也行。)<strong>python会把逗号显示为空格</strong>。</p>
<p>print()函数也可以接受多个字符串（单双引号引起来的都是字符串），用逗号“<strong>,</strong>”隔开，就可以连成一串输出：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; print(<span class="string">'The quick brown fox'</span>, <span class="string">'jumps over'</span>, <span class="string">'the lazy dog'</span>)</div></pre></td></tr></table></figure>
<p>The quick brown fox jumps over the lazy dog</p>
<p>print()会依次打印每个字符串，遇到逗号“<strong>,</strong>”会输出一个空格，因此，输出的字符串是这样拼起来的：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/131354039.png" alt="mark"></p>
<hr>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>以<strong>#</strong>开头的语句是注释，可以是任意内容，解释器会忽略掉注释。<br>其他每一行都是一个语句，当语句以<strong>冒号:结尾</strong>时，缩进的语句视为代码块。</p>
<p>缩进有利有弊。好处是强迫你写出格式化且缩进较少的代码，你会倾向于把一段很长的代码拆分成若干函数，从而得到缩进较少的代码。但没有规定缩进是几个空格还是<strong>Tab</strong>。按照约定俗成的管理，应该始终坚持使用4<strong>个空格的缩进</strong>。<br>缩进的另一个好处是强迫你写出缩进较少的代码，<br>缩进的坏处就是“复制－粘贴”功能失效了，这是最坑爹的地方。当你重构代码时，粘贴过去的代码必须重新检查缩进是否正确。此外，IDE很难像格式化Java代码那样格式化Python代码。<br>最后，请务必注意，<strong>Python程序是大小写敏感的</strong>，如果写错了大小写，程序会报错。<br>Python使用缩进来组织代码块，请务必遵守约定俗成的习惯，坚持使用4个空格的缩进。<br>在文本编辑器中，需要设置把Tab自动转换为4个空格，确保不混用Tab和空格。<strong>最少也要加tab键或空格，不然报错</strong>。</p>
<p>科学计数法表示，把10用e替代，1.23x109就是<strong>1.23e9</strong>，或者<strong>12.3e8</strong>，0.000012可以写成<strong>1.2e-5</strong>，等等。整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的（除法难道也是精确的？是的！），而浮点数运算则可能会有四舍五入的误差。</p>
<hr>
<p>字符串是以<strong>单引号’</strong>或<strong>双引号”</strong>括起来的任意文本。<strong>‘’</strong>或<strong>“”</strong>本身只是一种表示方式，不是字符串的一部分，因此，字符串<strong>‘abc’</strong>只有<strong>a，b，c</strong>这3个字符。如果<strong>‘</strong>本身也是一个字符，那就可以用<strong>“”</strong>括起来，比如”I’m OK”包含的字符是<strong>I，’，m，空格，O，K</strong>这6个字符。<br>如果字符串内部既包含’又包含”怎么办？可以用转义字符\来标识，比如：<br><strong>‘I\’m \”OK\”!’</strong></p>
<p>表示的字符串内容是：<br>I’m “OK”!</p>
<p>转义字符<strong>\可以转义很多字符</strong>，比如<strong>\n表示换行</strong>，<strong>\t表示制表符（tab键）</strong>，字符\本身也要转义，所以\表示的字符就是\，可以在Python的交互式命令行用<strong>print()</strong>打印字符串看看：<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="built_in">print</span>(<span class="string">'I\'m ok.'</span>)</div><div class="line">I<span class="string">'m ok.</span></div><div class="line">&gt;&gt;&gt; print('I<span class="string">\'m</span> learning<span class="string">\nPython.')</span></div><div class="line">I<span class="string">'m learning</span></div><div class="line">Python.</div><div class="line">&gt;&gt;&gt; print('<span class="string">\\\n\\')</span></div><div class="line"><span class="string">\</span></div><div class="line"><span class="string">\</span></div></pre></td></tr></table></figure></p>
<p>如果字符串里面有很多字符都需要转义，就需要加很多\，为了简化，Python还允许用r’’表示’’内部的字符串默认不转义，可以自己试试：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'\\\t\\'</span>)</div><div class="line">\       \</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">r'\\\t\\'</span>)</div><div class="line">\\\t\\</div></pre></td></tr></table></figure></p>
<p>如果字符串内部有很多换行，用\n写在一行里不好阅读，为了简化，Python允许用’’’…’’’的格式表示多行内容，可以自己试试：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'''line1</span></div><div class="line"><span class="meta">... </span>line2</div><div class="line"><span class="meta">... </span>line3''')</div><div class="line">line1</div><div class="line">line2</div><div class="line">line3</div></pre></td></tr></table></figure></p>
<p>上面是在交互式命令行内输入，注意在输入多行内容时，提示符由&gt;&gt;&gt;变为…，提示你可以接着上一行输入。如果写成程序，就是：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">'''line1</span></div><div class="line">line2</div><div class="line">line3''')</div></pre></td></tr></table></figure></p>
<p>多行字符串’’’…’’’还可以在前面加上<strong>r</strong>使用，请自行测试。</p>
<hr>
<h2 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h2><p>布尔值和布尔代数的表示完全一致，一个布尔值只有True、False两种值，要么是True，要么是False，在Python中，可以直接用True、False表示布尔值（请注意大小写）<br>布尔值可以用and、or和not运算。<br><strong>and运算</strong>是与运算，只有所有都为True，and运算结果才是True：<br><strong>or运算</strong>是或运算，只要其中有一个为True，or运算结果就是True：<br><strong>not运算</strong>是非运算，它是一个单目运算符，把True变成False，False变成True：<br>布尔值经常用在条件判断中，比如：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">if</span> age &gt;= <span class="number">18</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'adult'</span>)</div><div class="line"><span class="built_in">else</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'teenager'</span>)</div></pre></td></tr></table></figure></p>
<p>空值是Python里一个特殊的值，用None表示。None不能理解为0，因为0是有意义的，而None是一个特殊的空值。<br>此外，Python还提供了列表、字典等多种数据类型，还允许创建自定义数据类型，我们后面会继续讲到。</p>
<p>在Python中，等号=是赋值语句，可以把任意数据类型（整型，浮点，字符串，布尔值，变量等等）赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量<br>这种变量本身类型不固定的语言称之为动态语言，与之对应的是静态语言。静态语言在定义变量时必须指定变量类型，如果赋值的时候类型不匹配，就会报错。例如Java是静态语言，赋值语句如下（// 表示注释）：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int <span class="keyword">a</span> = <span class="number">123</span>;<span class="comment"> // a是整数类型变量</span></div><div class="line"><span class="keyword">a</span> = <span class="string">"ABC"</span>;<span class="comment"> // 错误：不能把字符串赋给整型变量</span></div></pre></td></tr></table></figure></p>
<p>和静态语言相比，动态语言更灵活，就是这个原因。</p>
<hr>
<p>把一个变量a赋值给另一个变量b，这个操作实际上是把变量b指向变量a所指向的数据，例如下面的代码：<br>a = ‘ABC’<br>b = a<br>a = ‘XYZ’<br>print(b)<br>最后一行打印出变量b的内容到底是’ABC’呢还是’XYZ’？如果从数学意义上理解，就会错误地得出b和a相同，也应该是’XYZ’，但实际上b的值是’ABC’，让我们一行一行地执行代码，就可以看到到底发生了什么事：<br>执行a = ‘ABC’，解释器创建了字符串’ABC’和变量a，并把a指向’ABC’：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/135540676.png" alt="mark"><br>执行b = a，解释器创建了变量b，并把b指向a指向的字符串’ABC’：<strong>(b是找到a所指向的地址，再把自己的指向那个地址，然后b就和a没关系了。）</strong><br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/135625547.png" alt="mark"><br>执行a = ‘XYZ’，解释器创建了字符串’XYZ’，并把a的指向改为’XYZ’，但b并没有更改：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/135733123.png" alt="mark"><br>所以，最后打印变量b的结果自然是’ABC’了。</p>
<hr>
<p>常量就是不能变的变量，比如常用的数学常数π就是一个常量。在Python中，通常用全部大写的变量名表示常量：<br>Python根本没有任何机制保证PI不会被改变，所以，用全部大写的变量名表示常量只是一个习惯上的用法，如果你一定要改变变量PI的值，也没人能拦住你。</p>
<p>最后解释一下整数的除法为什么也是精确的。在Python中，有两种除法，一种除法是/：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="number">10</span> / <span class="number">3</span></div><div class="line"><span class="number">3.3333333333333335</span></div></pre></td></tr></table></figure></p>
<p>/除法计算结果是浮点数，即使是两个整数恰好整除，结果也是浮点数：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="number">9</span> / <span class="number">3</span></div><div class="line"><span class="number">3.0</span></div></pre></td></tr></table></figure></p>
<p>还有一种除法是//，称为地板除，两个整数的除法仍然是整数：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="number">10</span> <span class="comment">// 3</span></div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></p>
<p>你没有看错，整数的地板除//永远是整数，即使除不尽。要做精确的除法，使用/就可以。<br>因为//除法只取结果的整数部分，所以Python还提供一个余数运算，可以得到两个整数相除的余数：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="number">10</span> % <span class="number">3</span></div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>无论整数做//除法还是取余数，结果永远是整数，所以，整数运算结果永远是精确的。</p>
<hr>
<h2 id="字符串和编码"><a href="#字符串和编码" class="headerlink" title="字符串和编码"></a>字符串和编码</h2><p>最新的Python 3版本中，字符串是以Unicode编码的，也就是说，Python的字符串支持多语言，例如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; print(<span class="string">'包含中文的str'</span>)</div><div class="line">包含中文的str</div></pre></td></tr></table></figure></p>
<p>对于单个字符的编码，Python提供了ord()函数获取字符的整数表示，chr()函数把编码转换为对应的字符：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; ord(<span class="string">'A'</span>)</div><div class="line"><span class="number">65</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; ord(<span class="string">'中'</span>)</div><div class="line"><span class="number">20013</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; chr(<span class="number">66</span>)</div><div class="line"><span class="string">'B'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; chr(<span class="number">25991</span>)</div><div class="line"><span class="string">'文'</span></div></pre></td></tr></table></figure></p>
<p>如果知道字符的整数编码，还可以用十六进制这么写str：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'\u4e2d\u6587'</span></div><div class="line"><span class="string">'中文'</span></div></pre></td></tr></table></figure></p>
<p>两种写法完全是等价的。<br>由于Python的字符串类型是str，在内存中以Unicode表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把str变为以字节为单位的bytes。<br>Python对bytes类型的数据用带b前缀的单引号或双引号表示：<code>x = b&#39;ABC&#39;</code></p>
<p>要注意区分’ABC’和b’ABC’，前者是str，后者虽然内容显示得和前者一样，但bytes的每个字符都只占用一个字节。<br>以Unicode表示的str通过encode()方法可以编码为指定的bytes，例如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'ABC'</span>.encode(<span class="string">'ascii'</span>)</div><div class="line">b<span class="string">'ABC'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'中文'</span>.encode(<span class="string">'utf-8'</span>)</div><div class="line">b<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'中文'</span>.encode(<span class="string">'ascii'</span>)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span></div><div class="line"><span class="symbol">UnicodeEncodeError:</span> <span class="string">'ascii'</span> codec can<span class="string">'t encode characters in position 0-1: ordinal not in range(128)</span></div></pre></td></tr></table></figure></p>
<p>纯英文的str可以用ASCII编码为bytes，内容是一样的，含有中文的str可以用UTF-8编码为bytes。含有中文的str无法用ASCII编码，因为中文编码的范围超过了ASCII编码的范围，Python会报错。<br>在bytes中，无法显示为ASCII字符的字节，用\x##显示。<br>反过来，如果我们从网络或磁盘上读取了字节流，那么读到的数据就是bytes。要把bytes变为str，就需要用decode()方法：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; b<span class="string">'ABC'</span>.decode(<span class="string">'ascii'</span>)</div><div class="line"><span class="string">'ABC'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; b<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>.decode(<span class="string">'utf-8'</span>)</div><div class="line"><span class="string">'中文'</span></div></pre></td></tr></table></figure></p>
<p>要计算str包含多少个字符，可以用len()函数：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(<span class="string">'ABC'</span>)</div><div class="line"><span class="number">3</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(<span class="string">'中文'</span>)</div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>len()函数计算的是str的字符数，如果换成bytes，len()函数就计算字节数：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(b<span class="string">'ABC'</span>)</div><div class="line"><span class="number">3</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(b<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>)</div><div class="line"><span class="number">6</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(<span class="string">'中文'</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure></p>
<p>可见，1个中文字符经过UTF-8编码后通常会占用3个字节，而1个英文字符只占用1个字节。<br>在操作字符串时，我们经常遇到<strong>str</strong>和<strong>bytes</strong>的互相转换。为了避免乱码问题，应当始终坚持使用UTF-8编码对str和bytes进行转换。<br>由于Python源代码也是一个文本文件，所以，当你的源代码中包含中文的时候，在保存源代码时，就需要务必指定保存为UTF-8编码。当Python解释器读取源代码时，为了让它按UTF-8编码读取，我们通常在文件开头写上这两行：<br><figure class="highlight d"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/env python3</span></div><div class="line"># -*- coding: utf-<span class="number">8</span> -*-</div></pre></td></tr></table></figure></p>
<p>第一行注释是为了告诉Linux/OS X系统，这是一个Python可执行程序，Windows系统会忽略这个注释；<br>第二行注释是为了告诉Python解释器，按照UTF-8编码读取源代码，否则，你在源代码中写的中文输出可能会有乱码。<br>申明了UTF-8编码并不意味着你的.py文件就是UTF-8编码的，必须并且要确保文本编辑器正在使用UTF-8 without BOM编码：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/140952776.png" alt="mark"><br>如果.py文件本身使用UTF-8编码，并且也申明了<code># -*- coding: utf-8 -*-</code>，打开命令提示符测试就可以正常显示中文：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/141100866.png" alt="mark"></p>
<hr>
<h2 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h2><p>最后一个常见的问题是如何输出格式化的字符串。我们经常会输出类似<strong>‘亲爱的xxx你好！你xx月的话费是xx，余额是xx’</strong>之类的字符串，而xxx的内容都是根据变量变化的，所以，需要一种简便的格式化字符串的方式。</p>
<p>在Python中，采用的格式化方式和C语言是一致的，用%实现，举例如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'Hello, %s'</span> % <span class="string">'world'</span></div><div class="line"><span class="string">'Hello, world'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'Hi, %s, you have $%d.'</span> % (<span class="string">'Michael'</span>, <span class="number">1000000</span>)</div><div class="line"><span class="string">'Hi, Michael, you have $1000000.'</span></div></pre></td></tr></table></figure></p>
<p><strong>%运算符</strong>就是用来格式化字符串的。在字符串内部，<strong>%s表示用字符串替换</strong>，<strong>%d表示用整数替换</strong>，有几个%?占位符，后面就跟几个变量或者值，顺序要对应好。如果只有一个<strong>%?</strong>，括号可以省略。</p>
<p>常见的占位符有：</p>
<p>|–|–|<br>|%d|整数|<br>|%f|浮点数|<br>|%s|字符串|<br>|%x|十六进制整数|</p>
<p>其中，格式化整数和浮点数还可以指定是否补0和整数与小数的位数：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; '%<span class="number">2</span>d-%<span class="number">02</span>d' % (<span class="number">3</span>, <span class="number">1</span>)</div><div class="line">' <span class="number">3</span><span class="number">-01</span>'</div><div class="line">&gt;&gt;&gt; '%<span class="number">.2</span>f' % <span class="number">3.1415926</span>        （<span class="number">.2</span>f表示小数点后保留两位）</div><div class="line">'<span class="number">3.14</span>'</div></pre></td></tr></table></figure></p>
<p>如果你不太确定应该用什么，%s永远起作用，它会把任何数据类型转换为字符串：<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="symbol">'Age</span>: %s. Gender: %s' % (<span class="number">25</span>, <span class="literal">True</span>)</div><div class="line"><span class="symbol">'Age</span>: <span class="number">25</span>. Gender: <span class="literal">True</span>'</div></pre></td></tr></table></figure></p>
<p>有些时候，字符串里面的%是一个普通字符怎么办？这个时候就需要转义，用%%来表示一个%：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; <span class="string">'growth rate: %d %%'</span> % <span class="number">7</span></div><div class="line"><span class="string">'growth rate: 7 %'</span></div></pre></td></tr></table></figure></p>
<p>练习<br>小明的成绩从去年的72分提升到了今年的85分，请计算小明成绩提升的百分点，并用字符串格式化显示出’xx.x%’，只保留小数点后1位：<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">s1 = 72</div><div class="line">s2 = 85</div><div class="line">r = 100*(s2/s1-1)</div><div class="line">print('提升了: %.2f' %r)</div></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> x = <span class="keyword">float</span>(input(<span class="string">'请输入上次得分：'</span>))</div><div class="line">    y = <span class="keyword">float</span>(input(<span class="string">'请输入这次得分：'</span>))</div><div class="line">    z = (y-x)/x*<span class="number">100</span></div><div class="line">    <span class="keyword">if</span> z&gt;=<span class="number">0</span>:</div><div class="line">        <span class="keyword">print</span>(<span class="string">'这次进步了：%.1f'</span> %z+<span class="string">'%'</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span>(<span class="string">'这次退步了：%.1f'</span> %-z+<span class="string">'%'</span>)</div><div class="line">except Exception:</div><div class="line">    <span class="keyword">print</span>(<span class="string">'请输入正确的分数！'</span>)</div></pre></td></tr></table></figure>
<hr>
<h2 id="使用list和tuple"><a href="#使用list和tuple" class="headerlink" title="使用list和tuple"></a>使用list和tuple</h2><p>list是一种有序的集合，可以随时添加和删除其中的元素。比如，列出班里所有同学的名字，就可以用一个list表示：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates</div><div class="line">[<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</div></pre></td></tr></table></figure></p>
<p>变量classmates就是一个list。用len()函数可以获得list元素的个数：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(classmates)</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></p>
<p>用索引来访问list中每一个位置的元素，记得索引是从0开始的：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[<span class="number">0</span>]</div><div class="line"><span class="string">'Michael'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[<span class="number">1</span>]</div><div class="line"><span class="string">'Bob'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[<span class="number">2</span>]</div><div class="line"><span class="string">'Tracy'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[<span class="number">3</span>]</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span></div><div class="line"><span class="symbol">IndexError:</span> list index out of range</div></pre></td></tr></table></figure></p>
<p>当索引超出了范围时，Python会报一个IndexError错误，所以，要确保索引不要越界，记得最后一个元素的索引是len(classmates) - 1。<br>如果要取最后一个元素，除了计算索引位置外，还可以用-1做索引，直接获取最后一个元素：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[-<span class="number">1</span>]</div><div class="line"><span class="string">'Tracy'</span></div></pre></td></tr></table></figure></p>
<p>以此类推，可以获取倒数第2个、倒数第3个：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[-<span class="number">2</span>]</div><div class="line"><span class="string">'Bob'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[-<span class="number">3</span>]</div><div class="line"><span class="string">'Michael'</span></div></pre></td></tr></table></figure></p>
<p>list是一个可变的有序表，所以，可以往list中追加元素到末尾：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates.append(<span class="string">'Adam'</span>)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates</div><div class="line">[<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>, <span class="string">'Adam'</span>]</div></pre></td></tr></table></figure></p>
<p>也可以把元素插入到指定的位置，比如索引号为1的位置：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates.insert(<span class="number">1</span>, <span class="string">'Jack'</span>)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates</div><div class="line">[<span class="string">'Michael'</span>, <span class="string">'Jack'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>, <span class="string">'Adam'</span>]</div></pre></td></tr></table></figure></p>
<p>要删除list末尾的元素，用pop()方法：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates.pop()</div><div class="line"><span class="string">'Adam'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates</div><div class="line">[<span class="string">'Michael'</span>, <span class="string">'Jack'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</div></pre></td></tr></table></figure></p>
<p>要删除指定位置的元素，用pop(i)方法，其中i是索引位置：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates.pop(<span class="number">1</span>)</div><div class="line"><span class="string">'Jack'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates</div><div class="line">[<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</div></pre></td></tr></table></figure></p>
<p>要把某个元素替换成别的元素，可以直接赋值给对应的索引位置：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates[<span class="number">1</span>] = <span class="string">'Sarah'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates</div><div class="line">[<span class="string">'Michael'</span>, <span class="string">'Sarah'</span>, <span class="string">'Tracy'</span>]</div></pre></td></tr></table></figure></p>
<p>list里面的元素的数据类型也可以不同，比如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; L = [<span class="string">'Apple'</span>, <span class="number">123</span>, True]</div></pre></td></tr></table></figure></p>
<p>list元素也可以是另一个list，比如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; s = [<span class="string">'python'</span>, <span class="string">'java'</span>, [<span class="string">'asp'</span>, <span class="string">'php'</span>], <span class="string">'scheme'</span>]</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(s)</div><div class="line"><span class="number">4</span></div></pre></td></tr></table></figure></p>
<p>要注意s只有4个元素，其中s[2]又是一个list，如果拆开写就更容易理解了：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; p = [<span class="string">'asp'</span>, <span class="string">'php'</span>]</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; s = [<span class="string">'python'</span>, <span class="string">'java'</span>, p, <span class="string">'scheme'</span>]</div></pre></td></tr></table></figure></p>
<p>要拿到’php’可以写p[1]或者s[2][1]，因此s可以看成是一个二维数组，类似的还有三维、四维……数组，不过很少用到。<br>如果一个list中一个元素也没有，就是一个空的list，它的长度为0：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; L = []</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; len(L)</div><div class="line"><span class="number">0</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h2><p>另一种有序列表叫元组：tuple。tuple和list非常类似，但是tuple一旦初始化就不能修改，比如同样是列出同学的名字：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; classmates = (<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>)</div></pre></td></tr></table></figure></p>
<p>现在，classmates这个tuple不能变了，它也没有append()，insert()这样的方法。其他获取元素的方法和list是一样的，你可以正常地使用classmates[0]，classmates[-1]，但不能赋值成另外的元素。<br>不可变的tuple有什么意义？因为tuple不可变，所以代码更安全。如果可能，能用tuple代替list就尽量用tuple。<br>tuple的陷阱：当你定义一个tuple时，在定义的时候，tuple的元素就必须被确定下来，比如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; t = (<span class="number">1</span>, <span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; t</div><div class="line">(<span class="number">1</span>, <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p>如果要定义一个空的tuple，可以写成()：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; t = ()</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; t</div><div class="line">()</div></pre></td></tr></table></figure></p>
<p>但是，要定义一个只有1个元素的tuple，如果你这么定义：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; t = (<span class="number">1</span>)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; t</div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>定义的不是tuple，是1这个数！这是因为括号()既可以表示tuple，又可以表示数学公式中的小括号，这就产生了歧义，因此，Python规定，这种情况下，按小括号进行计算，计算结果自然是1。<br>所以，只有1个元素的tuple定义时必须加一个逗号,，来消除歧义：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; t = (<span class="number">1</span>,)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; t</div><div class="line">(<span class="number">1</span>,)</div></pre></td></tr></table></figure></p>
<p>Python在显示只有1个元素的tuple时，也会加一个逗号,，以免你误解成数学计算意义上的括号。<br>最后来看一个“可变的”tuple：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; t = ('a', 'b', ['A', 'B'])</div><div class="line">&gt;&gt;&gt; t[<span class="string">2</span>][<span class="symbol">0</span>] = 'X'</div><div class="line">&gt;&gt;&gt; t[<span class="string">2</span>][<span class="symbol">1</span>] = 'Y'</div><div class="line">&gt;&gt;&gt; t</div><div class="line">('a', 'b', ['X', 'Y'])</div></pre></td></tr></table></figure></p>
<p>这个tuple定义的时候有3个元素，分别是’a’，’b’和一个list。不是说tuple一旦定义后就不可变了吗？怎么后来又变了？<br>别急，我们先看看定义的时候tuple包含的3个元素：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/144646287.png" alt="mark"><br>当我们把list的元素’A’和’B’修改为’X’和’Y’后，tuple变为：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/144720550.png" alt="mark"></p>
<p>表面上看，tuple的元素确实变了，但其实变的不是tuple的元素，而是list的元素。tuple一开始指向的list并没有改成别的list，所以，tuple所谓的“不变”是说，tuple的每个元素，指向永远不变。即指向<strong>‘a’</strong>，就不能改成指向<strong>‘b’</strong>，指向一个list，就不能改成指向其他对象，但指向的这个list本身是可变的！<br>理解了“指向不变”后，要创建一个内容也不变的tuple怎么做？那就必须保证tuple的每一个元素本身也不能变。</p>
<p>练习：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="section"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">L = [</div><div class="line"><span class="code">    ['Apple', 'Google', 'Microsoft'],</span></div><div class="line"><span class="code">    ['Java', 'Python', 'Ruby', 'PHP'],</span></div><div class="line"><span class="code">    ['Adam', 'Bart', 'Lisa']</span></div><div class="line">]</div><div class="line"></div><div class="line"><span class="section"># 打印Apple:</span></div><div class="line">print(L[<span class="string">0</span>][<span class="symbol">0</span>])</div><div class="line"><span class="section"># 打印Python:</span></div><div class="line">print(L[<span class="string">1</span>][<span class="symbol">1</span>]) 或 print(L[<span class="string">-2</span>][<span class="symbol">-3</span>])</div><div class="line"><span class="section"># 打印Lisa:</span></div><div class="line">print(L[<span class="string">2</span>][<span class="symbol">2</span>])  或 print(L[<span class="string">-1</span>][<span class="symbol">-1</span>])</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><p>计算机之所以能做很多自动化的任务，因为它可以自己做条件判断。<br>比如，输入用户年龄，根据年龄打印不同的内容，在Python程序中，用if语句实现：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">age = <span class="number">20</span></div><div class="line"><span class="built_in">if</span> age &gt;= <span class="number">18</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'your age is'</span>, age)</div><div class="line">    <span class="built_in">print</span>(<span class="string">'adult'</span>)</div></pre></td></tr></table></figure></p>
<p>根据Python的缩进规则，如果if语句判断是True，就把缩进的两行print语句执行了，否则，什么也不做。<br>也可以给if添加一个else语句，意思是，如果if判断是False，不要执行if的内容，去把else执行了：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">age = <span class="number">3</span></div><div class="line"><span class="built_in">if</span> age &gt;= <span class="number">18</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'your age is'</span>, age)</div><div class="line">    <span class="built_in">print</span>(<span class="string">'adult'</span>)</div><div class="line"><span class="built_in">else</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'your age is'</span>, age)</div><div class="line">    <span class="built_in">print</span>(<span class="string">'teenager'</span>)</div></pre></td></tr></table></figure></p>
<p><strong>注意不要少写了冒号:</strong>。<br>当然上面的判断是很粗略的，完全可以用elif做更细致的判断：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">age = 3</div><div class="line"><span class="keyword">if</span> age &gt;= 18:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'adult'</span>)</div><div class="line"><span class="keyword">elif</span> age &gt;= 6:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'teenager'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'kid'</span>)</div></pre></td></tr></table></figure></p>
<p>elif是else if的缩写，完全可以有多个elif，所以if语句的完整形式就是：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if <span class="params">&lt;条件判断<span class="number">1</span>&gt;</span>:</div><div class="line">    <span class="params">&lt;执行<span class="number">1</span>&gt;</span></div><div class="line">elif <span class="params">&lt;条件判断<span class="number">2</span>&gt;</span>:</div><div class="line">    <span class="params">&lt;执行<span class="number">2</span>&gt;</span></div><div class="line">elif <span class="params">&lt;条件判断<span class="number">3</span>&gt;</span>:</div><div class="line">    <span class="params">&lt;执行<span class="number">3</span>&gt;</span></div><div class="line"><span class="symbol">else:</span></div><div class="line">    <span class="params">&lt;执行<span class="number">4</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>if语句执行有个特点，它是从上往下判断，如果在某个判断上是True，把该判断对应的语句执行后，就忽略掉剩下的elif和else，所以，请测试并解释为什么下面的程序打印的是teenager：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">age = 20</div><div class="line"><span class="keyword">if</span> age &gt;= 6:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'teenager'</span>)</div><div class="line"><span class="keyword">elif</span> age &gt;= 18:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'adult'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'kid'</span>)</div></pre></td></tr></table></figure></p>
<p>if判断条件还可以简写，比如写：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">if</span> x:</div><div class="line">    <span class="built_in">print</span>(<span class="string">'True'</span>)</div></pre></td></tr></table></figure></p>
<p>只要x是非零数值、非空字符串、非空list等，就判断为True，否则为False。<br>再议 input<br>最后看一个有问题的条件判断。很多同学会用input()读取用户的输入，这样可以自己输入，程序运行得更有意思：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">birth = <span class="built_in">input</span>(<span class="string">'birth: '</span>)</div><div class="line"><span class="keyword">if</span> birth &lt; <span class="number">2000</span>:</div><div class="line">    <span class="keyword">print</span>(<span class="string">'00前'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">print</span>(<span class="string">'00后'</span>)</div><div class="line"></div><div class="line"># 输入<span class="number">1982</span>，结果报错</div><div class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, <span class="built_in">line</span> <span class="number">1</span>, in <span class="symbol">&lt;module&gt;</span></div><div class="line">TypeError: unorderable <span class="built_in">type</span><span class="variable">s:</span> str() &gt; <span class="keyword">int</span>()</div></pre></td></tr></table></figure></p>
<p>这是因为<strong>input()返回的数据类型是str</strong>，str不能直接和整数比较，必须先把str转换成整数。Python提供了int()函数来完成这件事情：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">s = <span class="keyword">input</span>(<span class="string">'birth: '</span>)</div><div class="line">birth = <span class="keyword">int</span>(s)</div><div class="line"><span class="keyword">if</span> birth &lt; <span class="number">2000</span>:</div><div class="line">    <span class="keyword">print</span>(<span class="string">'00前'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">print</span>(<span class="string">'00后'</span>)</div></pre></td></tr></table></figure></p>
<p>再次运行，就可以得到正确地结果。但是，如果输入abc呢？又会得到一个错误信息：<br>Traceback (most recent call last):<br>  File “<stdin>“, line 1, in <module><br>ValueError: invalid literal for int() with base 10: ‘abc’</module></stdin></p>
<p>原来int()函数发现一个字符串并不是合法的数字时就会报错，程序就退出了。</p>
<p>练习<br>小明身高1.75，体重80.5kg。请根据BMI公式（体重除以身高的平方）帮小明计算他的BMI指数，并根据BMI指数：<br>  ● 低于18.5：过轻<br>  ● 18.5-25：正常<br>  ● 25-28：过重<br>  ● 28-32：肥胖<br>  ● 高于32：严重肥胖<br>用if-elif判断并打印结果：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="attr">height</span> = <span class="number">1.75</span></div><div class="line"><span class="attr">weight</span> = <span class="number">80.5</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><p>要计算1+2+3，我们可以直接写表达式：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure></p>
<p>要计算1+2+3+…+10，勉强也能写出来。<br>但是，要计算1+2+3+…+10000，直接写表达式就不可能了。<br>为了让计算机能计算成千上万次的重复运算，我们就需要循环语句。<br>Python的循环有两种，一种是for…in循环，依次把list或tuple中的每个元素迭代出来，看例子：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">names = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</div><div class="line"><span class="keyword">for</span> <span class="keyword">name</span> <span class="keyword">in</span> names:</div><div class="line">    print(<span class="keyword">name</span>)</div></pre></td></tr></table></figure></p>
<p>执行这段代码，会依次打印names的每一个元素：<br>Michael<br>Bob<br>Tracy</p>
<p>所以<strong>for x in …</strong>循环就是把每个元素代入变量x，然后执行缩进块的语句。<br>再比如我们想计算1-10的整数之和，可以用一个sum变量做累加：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sum</span> = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]:</div><div class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + x</div><div class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</div></pre></td></tr></table></figure></p>
<p>如果要计算1-100的整数之和，从1写到100有点困难，幸好Python提供一个range()函数，可以生成一个整数序列，再通过list()函数可以转换为list。比如range(5)生成的序列是从0开始小于5的整数：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="type">list</span>(range(<span class="number">5</span>))</div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</div></pre></td></tr></table></figure></p>
<p>range(101)就可以生成0-100的整数序列，计算如下：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sum</span> = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</div><div class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + x</div><div class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</div></pre></td></tr></table></figure></p>
<p>请自行运行上述代码，看看结果是不是当年高斯同学心算出的5050。<br>第二种循环是while循环，只要条件满足，就不断循环，条件不满足时退出循环。比如我们要计算100以内所有奇数之和，可以用while循环实现：<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sum</span> = <span class="number">0</span></div><div class="line"><span class="built_in">n</span> = <span class="number">99</span></div><div class="line">while <span class="built_in">n</span> &gt; <span class="symbol">0:</span></div><div class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + <span class="built_in">n</span></div><div class="line">    <span class="built_in">n</span> = <span class="built_in">n</span> - <span class="number">2</span></div><div class="line">print(<span class="built_in">sum</span>)</div></pre></td></tr></table></figure></p>
<p>在循环内部变量n不断自减，直到变为-1时，不再满足while条件，循环退出。<br>练习<br>请利用循环依次对list中的每个名字打印出Hello, xxx!：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line">L = [<span class="string">'Bart'</span>, <span class="string">'Lisa'</span>, <span class="string">'Adam'</span>]</div><div class="line"><span class="keyword">for</span> L in L:</div><div class="line">    <span class="keyword">print</span>(<span class="string">"hello,%s!"</span> %L)</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="使用dict和set"><a href="#使用dict和set" class="headerlink" title="使用dict和set"></a>使用dict和set</h2><h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><p>Python内置了字典：dict的支持，dict全称dictionary，在其他语言中也称为map，使用键-值（key-value）存储，具有极快的查找速度。<br>查成绩如果用list实现，需要两个list：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">names</span> = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</div><div class="line"><span class="attr">scores</span> = [<span class="number">95</span>, <span class="number">75</span>, <span class="number">85</span>]</div></pre></td></tr></table></figure></p>
<p>给定一个名字，要查找对应的成绩，就先要在names中找到对应的位置，再从scores取出对应的成绩，list越长，耗时越长。<br>如果用dict实现，只需要一个“名字”-“成绩”的对照表，直接根据名字查找成绩，无论这个表有多大，查找速度都不会变慢。用Python写一个dict如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; d = &#123;<span class="string">'Michael'</span>: <span class="number">95</span>, <span class="string">'Bob'</span>: <span class="number">75</span>, <span class="string">'Tracy'</span>: <span class="number">85</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Michael'</span>]</div><div class="line"><span class="number">95</span></div></pre></td></tr></table></figure></p>
<p>假设字典包含了1万个汉字，我们要查某一个字，一个办法是把字典从第一页往后翻，直到找到我们想要的字为止，这种方法就是在list中查找元素的方法，list越大，查找越慢。<br>第二种方法是先在字典的索引表里（比如部首表）查这个字对应的页码，然后直接翻到该页，找到这个字。无论找哪个字，这种查找速度都非常快，不会随着字典大小的增加而变慢。</p>
<p>dict就是第二种实现方式，给定一个名字，比如’Michael’，dict在内部就可以直接计算出Michael对应的存放成绩的“页码”，也就是95这个数字存放的内存地址，直接取出来，所以速度非常快。<br>你可以猜到，这种key-value存储方式，在放进去的时候，必须根据key算出value的存放位置，这样，取的时候才能根据key直接拿到value。</p>
<p>把数据放入dict的方法，除了初始化时指定外，还可以通过key放入：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Adam'</span>] = <span class="number">67</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Adam'</span>]</div><div class="line"><span class="number">67</span></div></pre></td></tr></table></figure></p>
<p>由于一个key只能对应一个value，所以，多次对一个key放入value，后面的值会把前面的值冲掉：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Jack'</span>] = <span class="number">90</span>        dict_name[<span class="string">'key'</span>] = value</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Jack'</span>]</div><div class="line"><span class="number">90</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Jack'</span>] = <span class="number">88</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Jack'</span>]</div><div class="line"><span class="number">88</span></div></pre></td></tr></table></figure></p>
<p>如果key不存在，dict就会报错：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[<span class="string">'Thomas'</span>]</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span></div><div class="line"><span class="symbol">KeyError:</span> <span class="string">'Thomas'</span></div></pre></td></tr></table></figure></p>
<p>要避免key不存在的错误，有两种办法，一是通过in判断key是否存在：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'Thomas'</span> <span class="keyword">in</span> d</div><div class="line"><span class="keyword">False</span></div></pre></td></tr></table></figure></p>
<p>二是通过dict提供的get方法，如果key不存在，可以返回None，或者自己指定的value：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; d.get(<span class="string">'Thomas'</span>)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d.get(<span class="string">'Thomas'</span>, -<span class="number">1</span>)</div><div class="line">-<span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>注意：返回None的时候Python的交互式命令行不显示结果。<br>要删除一个key，用pop(key)方法，对应的value也会从dict中删除：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; d.pop(<span class="string">'Bob'</span>)</div><div class="line"><span class="number">75</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d</div><div class="line">&#123;<span class="string">'Michael'</span>: <span class="number">95</span>, <span class="string">'Tracy'</span>: <span class="number">85</span>&#125;</div></pre></td></tr></table></figure></p>
<p>请务必注意，dict内部存放的顺序和key放入的顺序是没有关系的。<br>和list比较，dict有以下几个特点：</p>
<ul>
<li><ol>
<li>查找和插入的速度极快，不会随着key的增加而变慢；</li>
</ol>
</li>
<li><ol>
<li>需要占用大量的内存，内存浪费多。</li>
</ol>
</li>
</ul>
<p>而list相反：</p>
<ul>
<li><ol>
<li>查找和插入的时间随着元素的增加而增加；</li>
</ol>
</li>
<li><ol>
<li>占用空间小，浪费内存很少。</li>
</ol>
</li>
</ul>
<p>所以，<strong>dict是用空间来换取时间的一种方法</strong>。<br>dict可以用在需要高速查找的很多地方，在Python代码中几乎无处不在，正确使用dict非常重要，需要牢记的第一条就是dict的key必须是不可变对象。<br>这是因为dict根据key来计算value的存储位置，如果每次计算相同的key得出的结果不同，那dict内部就完全混乱了。这个通过key计算位置的算法称为哈希算法（Hash）。<br>要保证hash的正确性，作为key的对象就不能变。在Python中，字符串、整数等都是不可变的，因此，可以放心地作为key。而list是可变的，就不能作为key：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; key = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; d[key] = <span class="string">'a list'</span></div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span></div><div class="line"><span class="symbol">TypeError:</span> unhashable <span class="symbol">type:</span> <span class="string">'list'</span></div></pre></td></tr></table></figure></p>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。<br>要创建一个set，需要提供一个list作为输入集合：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; s = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line">&gt;&gt;&gt; s</div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</div></pre></td></tr></table></figure></p>
<p>注意，传入的参数[1, 2, 3]是一个list，而显示的{1, 2, 3}只是告诉你这个set内部有1，2，3这3个元素，显示的顺序也不表示set是有序的。。<br>重复元素在set中自动被过滤：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; s = set([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>])</div><div class="line">&gt;&gt;&gt; s</div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</div></pre></td></tr></table></figure></p>
<p>通过add(key)方法可以添加元素到set中，可以重复添加，但不会有效果：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; s.add(<span class="number">4</span>)</div><div class="line">&gt;&gt;&gt; s</div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div><div class="line">&gt;&gt;&gt; s.add(<span class="number">4</span>)</div><div class="line">&gt;&gt;&gt; s</div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div></pre></td></tr></table></figure></p>
<p>通过remove(key)方法可以删除元素：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; s.remove(<span class="number">4</span>)</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; s</div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</div></pre></td></tr></table></figure></p>
<p>set可以看成数学意义上的无序和无重复元素的集合，因此，两个set可以做数学意义上的交集、并集等操作：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; s1 = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line">&gt;&gt;&gt; s2 = set([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</div><div class="line">&gt;&gt;&gt; s1 &amp; s2</div><div class="line">&#123;<span class="number">2</span>, <span class="number">3</span>&#125;</div><div class="line">&gt;&gt;&gt; s1 | s2</div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div></pre></td></tr></table></figure></p>
<p>set和dict的唯一区别仅在于没有存储对应的value，但是，set的原理和dict一样，所以，同样不可以放入可变对象，因为无法判断两个可变对象是否相等，也就无法保证set内部“不会有重复元素”。把list放入set，则会报错。</p>
<p>再议不可变对象<br>上面我们讲了，str是不变对象，而list是可变对象。<br>对于可变对象，比如list，对list进行操作，list内部的内容是会变化的，比如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; a = [<span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>]</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; a.sort()</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; a</div><div class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</div></pre></td></tr></table></figure></p>
<p>而对于不可变对象，比如str，对str进行操作呢：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; a = <span class="string">'abc'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; a.replace(<span class="string">'a'</span>, <span class="string">'A'</span>)</div><div class="line"><span class="string">'Abc'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; a</div><div class="line"><span class="string">'abc'</span></div></pre></td></tr></table></figure></p>
<p>虽然字符串有个replace()方法，也确实变出了’Abc’，但变量a最后仍是’abc’，应该怎么理解呢？<br>我们先把代码改成下面这样：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="selector-tag">a</span> = <span class="string">'abc'</span></div><div class="line">&gt;&gt;&gt; <span class="selector-tag">b</span> = <span class="selector-tag">a</span>.replace(<span class="string">'a'</span>, <span class="string">'A'</span>)</div><div class="line">&gt;&gt;&gt; <span class="selector-tag">b</span></div><div class="line"><span class="string">'Abc'</span></div><div class="line">&gt;&gt;&gt; <span class="selector-tag">a</span></div><div class="line"><span class="string">'abc'</span></div></pre></td></tr></table></figure></p>
<p>要始终牢记的是，<strong>a是变量</strong>，而<strong>‘abc’</strong>才是字符串对象！有些时候，我们经常说，对象a的内容是’abc’，但其实是指，a本身是一个变量，它指向的对象的内容才是’abc’：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/150425099.png" alt="mark"></p>
<p>当我们调用<strong>a.replace(‘a’, ‘A’)</strong>时，实际上调用方法<strong>replace</strong>是作用在字符串对象’abc’上的，而这个方法虽然名字叫replace，但却没有改变字符串’abc’的内容。相反，replace方法创建了一个新字符串’Abc’并返回，如果我们用变量b指向该新字符串，就容易理解了，变量a仍指向原有的字符串’abc’，但变量b却指向新字符串’Abc’了：<br><img src="http://ofyfogrgx.bkt.clouddn.com/blog/20161218/150947182.png" alt="mark"></p>
<p>所以，对于不变对象来说，调用对象自身的任意方法，也不会改变该对象自身的内容。相反，这些方法会创建新的对象并返回，这样，就保证了不可变对象本身永远是不可变的。</p>
<p>小结<br>使用key-value存储结构的dict在Python中非常有用，选择不可变对象作为key很重要，最常用的key是字符串。<br>tuple虽然是不变对象，但试试把<strong>(1, 2, 3)</strong>和<strong>(1, [2, 3])</strong>放入dict或set中，并解释结果。</p>
<hr>
<hr>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>我们知道圆的面积计算公式为：<br>S = πr2<br>当代码出现有规律的重复的时候，你就需要当心了，每次写3.14 <em> x </em> x不仅很麻烦，而且，如果要把3.14改成3.14159265359的时候，得全部替换。<br>有了函数，我们就不再每次写s = 3.14 <em> x </em> x，而是写成更有意义的函数调用s = area_of_circle(x)，而函数area_of_circle本身只需要写一次，就可以多次调用。</p>
<hr>
<h2 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h2><p>抽象是数学中非常常见的概念。举个例子：<br>计算数列的和，比如：1 + 2 + 3 + … + 100，写起来十分不方便，于是数学家发明了求和符号∑，可以把1 + 2 + 3 + … + 100记作：</p>
<p>$$\sum\limits_{n = 1}^{100} n $$</p>
<p>这种抽象记法非常强大，因为我们看到 ∑ 就可以理解成求和，而不是还原成低级的加法运算。<br>而且，这种抽象记法是可扩展的，比如：</p>
<p>$$\sum\limits_{n = 1}^{100} n^2+1 $$</p>
<p>还原成加法运算就变成了：<br>(1 x 1 + 1) + (2 x 2 + 1) + (3 x 3 + 1) + … + (100 x 100 + 1)<br>可见，借助抽象，我们才能不关心底层的具体计算过程，而直接在更高的层次上思考问题。<br>写计算机程序也是一样，函数就是最基本的一种代码抽象的方式。</p>
<hr>
<h2 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h2><p>官方文档：<a href="http://docs.python.org/3/library/functions.html#abs" target="_blank" rel="external">http://docs.python.org/3/library/functions.html#abs</a><br>也可以在交互式命令行通过help(abs)查看abs函数的帮助信息。</p>
<p>调用函数的时候，如果传入的参数数量不对，会报TypeError的错误，并且Python会明确地告诉你：abs()有且仅有1个参数，但给出了两个：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="built_in">abs</span>(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, <span class="built_in">line</span> <span class="number">1</span>, in <span class="symbol">&lt;module&gt;</span></div><div class="line">TypeError: <span class="built_in">abs</span>() takes exactly one <span class="keyword">argument</span> (<span class="number">2</span> given)</div></pre></td></tr></table></figure></p>
<p>如果传入的参数数量是对的，但参数类型不能被函数所接受，也会报TypeError的错误，并且给出错误信息：str是错误的参数类型：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; <span class="built_in">abs</span>(<span class="string">'a'</span>)</div><div class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, <span class="built_in">line</span> <span class="number">1</span>, in <span class="symbol">&lt;module&gt;</span></div><div class="line">TypeError: <span class="keyword">bad</span> operand <span class="built_in">type</span> <span class="keyword">for</span> <span class="built_in">abs</span>(): <span class="string">'str'</span></div></pre></td></tr></table></figure></p>
<p>而max函数max()可以接收任意多个参数，并返回最大的那个：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; max(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line"><span class="number">2</span></div><div class="line">&gt;&gt;&gt; max(<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">-5</span>)</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></p>
<hr>
<h3 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h3><p>Python内置的常用函数还包括数据类型转换函数，比如int()函数可以把其他数据类型转换为整数：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; int(<span class="string">'123'</span>)</div><div class="line"><span class="number">123</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; int(<span class="number">12.34</span>)</div><div class="line"><span class="number">12</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; float(<span class="string">'12.34'</span>)</div><div class="line"><span class="number">12.34</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; str(<span class="number">1.23</span>)</div><div class="line"><span class="string">'1.23'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; str(<span class="number">100</span>)</div><div class="line"><span class="string">'100'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; bool(<span class="number">1</span>)</div><div class="line">True</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; bool(<span class="string">''</span>)</div><div class="line">False</div></pre></td></tr></table></figure></p>
<p>函数名其实就是指向一个函数对象的引用，完全可以把函数名赋给一个变量，相当于给这个函数起了一个“别名”：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; a = abs <span class="comment"># 变量a指向abs函数</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; a(-<span class="number">1</span>) <span class="comment"># 所以也可以通过a调用abs函数</span></div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure></p>
<hr>
<h3 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h3><p>定义一个函数要使用def语句，依次写出函数名、括号、括号中的参数和冒号:，然后，在缩进块中编写函数体，函数的返回值用return语句返回。<br>我们以自定义一个求绝对值的my_abs函数为例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_abs</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span> x</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> -x</div></pre></td></tr></table></figure></p>
<p>请注意，函数体内部的语句在执行时，一旦执行到return时，函数就执行完毕，并将结果返回。因此，函数内部通过条件判断和循环可以实现非常复杂的逻辑。</p>
<p>如果没有return语句，函数执行完毕后也会返回结果，只是结果为None。<br>return None可以简写为return。</p>
<p>在Python交互环境中定义函数时，注意Python会出现…的提示。函数定义结束后需要按两次回车重新回到&gt;&gt;&gt;提示符下：</p>
<p>如果你已经把<strong>my_abs()</strong>的函数定义保存为<strong>abstest.py</strong>文件了，那么，可以在该文件的当前目录下启动Python解释器，用<code>from abstest import my_abs</code>来导入my_abs()函数，<strong>注意abstest是文件名（不含.py扩展名）</strong></p>
<hr>
<h3 id="空函数"><a href="#空函数" class="headerlink" title="空函数"></a>空函数</h3><p>如果想定义一个什么事也不做的空函数，可以用pass语句：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">nop</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p>pass语句什么都不做，那有什么用？实际上pass可以用来作为占位符，比如现在还没想好怎么写函数的代码，就可以先放一个pass，让代码能运行起来。<br>pass还可以用在其他语句里，比如：<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> age &gt;= <span class="number">18</span>:</div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p>缺少了pass，代码运行就会有语法错误。</p>
<hr>
<h3 id="参数检查"><a href="#参数检查" class="headerlink" title="参数检查"></a>参数检查</h3><p>调用函数时，如果参数个数不对，Python解释器会自动检查出来，并抛出TypeError：</p>
<p>但是如果参数类型不对，Python解释器就无法帮我们检查。试试my_abs和内置函数abs的差别：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; my_abs(<span class="string">'A'</span>)</div><div class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, <span class="built_in">line</span> <span class="number">1</span>, in <span class="symbol">&lt;module&gt;</span></div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, <span class="built_in">line</span> <span class="number">2</span>, in my_abs</div><div class="line">TypeError: unorderable <span class="built_in">type</span><span class="variable">s:</span> str() &gt;= <span class="keyword">int</span>()</div><div class="line">&gt;&gt;&gt; <span class="built_in">abs</span>(<span class="string">'A'</span>)</div><div class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, <span class="built_in">line</span> <span class="number">1</span>, in <span class="symbol">&lt;module&gt;</span></div><div class="line">TypeError: <span class="keyword">bad</span> operand <span class="built_in">type</span> <span class="keyword">for</span> <span class="built_in">abs</span>(): <span class="string">'str'</span></div></pre></td></tr></table></figure></p>
<p>当传入了不恰当的参数时，内置函数abs会检查出参数错误，而我们定义的my_abs没有参数检查，会导致if语句出错，出错信息和abs不一样。所以，这个函数定义不够完善。<br>让我们修改一下my_abs的定义，对参数类型做检查，只允许整数和浮点数类型的参数。数据类型检查可以用内置函数isinstance()实现：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_abs</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(x, (int, float)):</div><div class="line">        <span class="keyword">raise</span> TypeError(<span class="string">'bad operand type'</span>)</div><div class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span> x</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> -x</div></pre></td></tr></table></figure></p>
<p>添加了参数检查后，如果传入错误的参数类型，函数就可以抛出一个错误：<br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; my_abs(<span class="symbol">'A</span>')</div><div class="line">Traceback (most recent call last):</div><div class="line">  <span class="keyword">File</span> <span class="string">"&lt;stdin&gt;"</span>, <span class="literal">line</span> <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  <span class="keyword">File</span> <span class="string">"&lt;stdin&gt;"</span>, <span class="literal">line</span> <span class="number">3</span>, <span class="keyword">in</span> my_abs</div><div class="line">TypeError: bad operand <span class="keyword">type</span></div></pre></td></tr></table></figure></p>
<p>错误和异常处理将在后续讲到。</p>
<hr>
<h3 id="返回多个值"><a href="#返回多个值" class="headerlink" title="返回多个值"></a>返回多个值</h3><p>比如在游戏中经常需要从一个点移动到另一个点，给出坐标、位移和角度，就可以计算出新的新的坐标：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> math   [导入math包]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(x, y, step, angle=<span class="number">0</span>)</span>:</span></div><div class="line">    nx = x + step * math.cos(angle)</div><div class="line">    ny = y - step * math.sin(angle)</div><div class="line">    <span class="keyword">return</span> nx, ny</div></pre></td></tr></table></figure></p>
<p>import math语句表示导入math包，并允许后续代码引用math包里的sin、cos等函数。<br>然后，我们就可以同时获得返回值：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; x, y = move(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, math.pi / <span class="number">6</span>)</div><div class="line">&gt;&gt;&gt; print(x, y)</div><div class="line"><span class="number">151.96152422706632</span> <span class="number">70.0</span></div><div class="line"></div><div class="line">但其实这只是一种假象，Python函数返回的仍然是单一值：</div><div class="line">&gt;&gt;&gt; r = move(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, math.pi / <span class="number">6</span>)</div><div class="line">&gt;&gt;&gt; print(r)</div><div class="line">(<span class="number">151.96152422706632</span>, <span class="number">70.0</span>)</div></pre></td></tr></table></figure></p>
<p>原来返回值是一个tuple！但是，在语法上，返回一个tuple可以省略括号，而多个变量可以同时接收一个tuple，按位置赋给对应的值，所以，Python的函数返回多值其实就是返回一个tuple，但写起来更方便。</p>
<hr>
<p><strong>小结</strong><br>定义函数时，需要确定函数名和参数个数；<br>如果有必要，可以先对参数的数据类型做检查；<br>函数体内部可以用return随时返回函数结果；<br>函数执行完毕也没有return语句时，自动return None。<br>函数可以同时返回多个值，但其实就是一个tuple。</p>
<p><strong>练习</strong><br>请定义一个函数quadratic(a, b, c)，接收3个参数，返回一元二次方程：<br>ax2 + bx + c = 0<br>的两个解。<br>提示：计算平方根可以调用math.sqrt()函数：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; import math</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; math.sqrt(<span class="number">2</span>)</div><div class="line"><span class="number">1.4142135623730951</span></div></pre></td></tr></table></figure></p>
<p>例：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not ( isinstance(a,(<span class="keyword">int</span>,<span class="keyword">float</span>)) and isinstance(b,(<span class="keyword">int</span>,<span class="keyword">float</span>)) and isinstance(c,(<span class="keyword">int</span>,<span class="keyword">float</span>)) ):</div><div class="line">        raise TypeError('Bad opearand type')</div><div class="line">    <span class="keyword">if</span> a==0:</div><div class="line">        print(<span class="string">"没有输入正确的参数,此方程为一元一次方程."</span>)</div><div class="line">        <span class="keyword">return</span></div><div class="line"></div><div class="line">    dalta = b**2-4*a*c</div><div class="line">    <span class="keyword">if</span> dalta &lt; 0:</div><div class="line">        print(<span class="string">"没有实数解."</span>)</div><div class="line">    <span class="keyword">if</span> dalta ==0:</div><div class="line">        print(<span class="string">"此方程只有一个解."</span>)</div><div class="line">        <span class="keyword">return</span> ( -b/(2*a) )</div><div class="line">    <span class="keyword">if</span> dalta &gt;0:</div><div class="line">        ans1 = ( -b +dalta**0.5 )/( 2*a )</div><div class="line">        ans2 = ( -b -dalta**0.5 )/( 2*a )</div><div class="line">        <span class="keyword">return</span>(ans1,ans2)</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="函数的参数"><a href="#函数的参数" class="headerlink" title="函数的参数"></a>函数的参数</h3><p><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431752945034eb82ac80a3e64b9bb4929b16eeed1eb9000" target="_blank" rel="external">http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431752945034eb82ac80a3e64b9bb4929b16eeed1eb9000</a></p>
<hr>
<h3 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h3><p>在函数内部，可以调用其他函数。如果一个函数在内部调用自身本身，这个函数就是递归函数。<br>举个例子，我们来计算阶乘<strong>n! = 1 x 2 x 3 x … x n</strong>，用函数fact(n)表示，可以看出：<br><code>fact(n) = n! = 1 x 2 x 3 x ... x (n-1) x n = (n-1)! x n = fact(n-1) x n</code><br>所以，fact(n)可以表示为<code>n x fact(n-1)</code>，只有n=1时需要特殊处理。<br>于是，fact(n)用递归的方式写出来就是：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></div><div class="line">    <span class="keyword">if</span> n==<span class="number">1</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> n * fact(n - <span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<p>如果我们计算fact(5)，可以根据函数定义看到计算过程如下：<br>===&gt; fact(5)<br>===&gt; 5 <em> fact(4)<br>===&gt; 5 </em> (4 <em> fact(3))<br>===&gt; 5 </em> (4 <em> (3 </em> fact(2)))<br>===&gt; 5 <em> (4 </em> (3 <em> (2 </em> fact(1))))<br>===&gt; 5 <em> (4 </em> (3 <em> (2 </em> 1)))<br>===&gt; 5 <em> (4 </em> (3 <em> 2))<br>===&gt; 5 </em> (4 <em> 6)<br>===&gt; 5 </em> 24<br>===&gt; 120</p>
<p>上面的fact(n)函数由于<code>return n * fact(n - 1)</code>引入了乘法表达式，所以就不是尾递归了。要改成尾递归方式，需要多一点代码，主要是要把每一步的乘积传入到递归函数中：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></div><div class="line">    <span class="keyword">return</span> fact_iter(n, <span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact_iter</span><span class="params">(num, product)</span>:</span></div><div class="line">    <span class="keyword">if</span> num == <span class="number">1</span>:</div><div class="line">        <span class="keyword">return</span> product</div><div class="line">    <span class="keyword">return</span> fact_iter(num - <span class="number">1</span>, num * product)</div></pre></td></tr></table></figure></p>
<p>可以看到 <code>return fact_iter(num - 1, num * product)</code>仅返回递归函数本身，<strong>num - 1</strong>和<strong>num * product</strong> 在函数调用前就会被计算，不影响函数调用。<br>fact(5)对应的<strong>fact_iter(5, 1)</strong>的调用如下：<br>===&gt; fact_iter(5, 1)<br>===&gt; fact_iter(4, 5)<br>===&gt; fact_iter(3, 20)<br>===&gt; fact_iter(2, 60)<br>===&gt; fact_iter(1, 120)<br>===&gt; 120</p>
<hr>
<p><strong>练习</strong><br>汉诺塔的移动可以用递归函数非常简单地实现。<br>请编写move(n, a, b, c)函数，它接收参数n，表示3个柱子A、B、C中第1个柱子A的盘子数量，然后打印出把所有盘子从A借助B移动到C的方法，例如：</p>
<p>要理解递归首先你得理解递归。<br>递归题就是找感觉，要有要把大象装冰箱总共分几步？这样的思维方式，<br>一但去抠细节你就中计了。<br>汉诺塔问题有三根柱子，我给它们分别命名为起始柱src，临时柱tmp，目的柱dst<br>盘子一共分两种情况：<br>1.只有1个盘子<br>这种情况下，直接从起始柱src 移动到 目的柱dst ,完成任务。<br>2.有1个以上的盘子<br>假如有n个盘子在起始柱，</p>
<ol>
<li>首先把第n个盘子上方的n-1个盘子搬到临时柱。</li>
<li>然后把第n个盘子从起始柱移动到目的柱</li>
<li>最后把n-1个盘子从临时柱搬到目的柱 任务完成<br>知道这些就够了，千万别XJB去想细节！！！<br>知道这些就够了，千万别XJB去想细节！！！<br>知道这些就够了，千万别XJB去想细节！！！<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(from,to)</span>:</span> <span class="comment">#将盘子从from移动到to，动画效果需要脑补</span></div><div class="line">    print(<span class="keyword">from</span>,<span class="string">'-&gt;'</span>,to)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hanoi</span><span class="params">(n,src,tmp,dst)</span>:</span><span class="comment">#将n个盘子从src搬到dst</span></div><div class="line">    <span class="keyword">if</span> n == <span class="number">1</span>: <span class="comment">#只有一个盘子的情况</span></div><div class="line">        move(src,dst)</div><div class="line">    <span class="keyword">else</span>: <span class="comment">#有一个以上盘子的情况</span></div><div class="line">        hanoi(n<span class="number">-1</span>,src,dst,tmp) <span class="comment">#将上方的n-1个盘子从src搬到tmp</span></div><div class="line">        move(src,dst) <span class="comment">#将第n个盘子从src轻松愉快地移动到dst</span></div><div class="line">        hanoi(n<span class="number">-1</span>,tmp,src,dst) <span class="comment">#擦屁股，将tmp上的n-1个盘子搬到dst上</span></div><div class="line"></div><div class="line">hanoi(<span class="number">3</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>)</div></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h3><h4 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h4><p><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431756919644a792ee4ead724ef7afab3f7f771b04f5000" target="_blank" rel="external">http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431756919644a792ee4ead724ef7afab3f7f771b04f5000</a></p>
<hr>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;h1 id=&quot;学习廖雪峰老师的博客整理的一些笔记，目前还很凌乱，很惭愧，还没有
    
    </summary>
    
      <category term="Python" scheme="https://www.leolan.top/categories/Python/"/>
    
    
      <category term="Python入门" scheme="https://www.leolan.top/tags/Python%E5%85%A5%E9%97%A8/"/>
    
  </entry>
  
</feed>
